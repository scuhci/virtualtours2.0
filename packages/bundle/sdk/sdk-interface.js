!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var o=t();for(var a in o)("object"==typeof exports?exports:e)[a]=o[a]}}(this,(function(){return(()=>{"use strict";var e={403:function(e,t){function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var a,n,r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,o=1,a=arguments.length;o<a;o++)for(var n in t=arguments[o])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.Request=t.RequestQueue=t.RequestStatus=t.RequestPriority=void 0,function(e){e[e.LOW=0]="LOW",e[e.MEDIUM=1]="MEDIUM",e[e.HIGH=2]="HIGH",e[e.HIGHEST=3]="HIGHEST"}(a=t.RequestPriority||(t.RequestPriority={})),function(e){e[e.PENDING=0]="PENDING",e[e.SENDING=1]="SENDING",e[e.FAILED=2]="FAILED",e[e.DONE=3]="DONE"}(n=t.RequestStatus||(t.RequestStatus={}));var s=new WeakMap;var i=function(){function e(e){var t=void 0===e?{}:e,o=t.retries,a=void 0===o?0:o,n=t.concurrency,r=void 0===n?6:n;this.totalBytesDownloaded=0,this.queue=[],this.retries=a,this.concurrency=r}return e.prototype.get=function(e,t){return this.request("GET",e,t)},e.prototype.head=function(e,t){return this.request("HEAD",e,t)},e.prototype.options=function(e,t){return this.request("OPTIONS",e,t)},e.prototype.post=function(e,t){return this.request("POST",e,t)},e.prototype.put=function(e,t){return this.request("PUT",e,t)},e.prototype.patch=function(e,t){return this.request("PATCH",e,t)},e.prototype.delete=function(e,t){return this.request("DELETE",e,t)},e.prototype.request=function(e,t,o){var a=this,r=new c(e,t,o);if(null==o?void 0:o.signal){var i=function(){a.queue.includes(r)&&(r.status===n.SENDING&&r.abort(),a.dequeue(r),r.onFail(new DOMException("Aborted","AbortError")))};o.signal.addEventListener("abort",i),s.set(r,(function(){o.signal.removeEventListener("abort",i),s.delete(r)}))}return this.enqueue(r),r.promise},e.prototype.update=function(){for(var e;e=this.getNextPendingRequest();)this.sendRequest(e);for(;e=this.getNextOverflowingGet();)e.abort(),e.status=n.PENDING;this.updateTimeout=null},e.prototype.enqueue=function(e){var t=this,o=0;for(o=0;o<this.queue.length;o++){if(this.queue[o].priority<e.priority)break}this.queue.splice(o,0,e),this.updateTimeout||(this.updateTimeout=window.setTimeout((function(){t.update()}),1))},e.prototype.dequeue=function(e){var t;null===(t=s.get(e))||void 0===t||t();var o=this.queue.indexOf(e);if(-1===o)throw new Error("Can't dequeue request not in queue");this.queue.splice(o,1),this.update()},e.prototype.getNextPendingRequest=function(){for(var e=0;e<this.queue.length&&e<this.concurrency;e++){var t=this.queue[e];if(t.status===n.PENDING)return t}return null},e.prototype.getNextOverflowingGet=function(){for(var e=this.concurrency;e<this.queue.length;e++){var t=this.queue[e];if(t.status===n.SENDING&&t.priority!==a.HIGHEST&&"GET"===t.method)return t}return null},e.prototype.shouldRetryStatusCode=function(t){return!e.doNotRetryStatusCodes[t]},e.prototype.sendRequest=function(e){var t=this;e.status=n.SENDING,e.send().then((function(o){e.status=n.DONE,t.dequeue(e),e.contentLength&&e.contentLength>0&&(t.totalBytesDownloaded+=Number(e.contentLength)),e.onDone(o)})).catch((function(a){var r=null!==e.maxRetries?e.maxRetries:t.retries,s=e.sendAttempts<r;if("object"===o(a)){var i=a.status_code||0;s=s&&t.shouldRetryStatusCode(i)}s?(e.status=n.PENDING,t.update(),console.warn("Retried ".concat(e.url)),console.warn(a)):(e.status=n.FAILED,t.dequeue(e),console.warn("Failed ".concat(e.url)),e.onFail(a))}))},e.doNotRetryStatusCodes={400:!0,401:!0,403:!0,404:!0,405:!0,406:!0,410:!0,411:!0,414:!0,415:!0,421:!0,431:!0,451:!0},e}();t.RequestQueue=i;var c=function(){function e(e,t,o){void 0===o&&(o={});var r=this;this.sendAttempts=0,this.status=n.PENDING,this.contentLength=0,this.url=t,this.method=e,this.auth=o.auth||null,this.withCredentials=o.withCredentials||!1,this.priority=o.priority||a.MEDIUM,this.responseType=o.responseType||null,this.body=o.body||null,this.headers=o.headers||{},this.maxRetries=o.maxRetries||null,this.onProgress=o.onProgress,this.promise=new Promise((function(e,t){r.onDone=e,r.onFail=t}))}return e.prototype.send=function(){var e=this,t=this.xhr=function(e,t,o){var a;if("undefined"!=typeof XMLHttpRequest)(a=new XMLHttpRequest).withCredentials=o;else{if("undefined"==typeof XDomainRequest)throw new Error("No XMLHTTPRequest or XDomainRequest... are you trying to run me in node? :(");a=new XDomainRequest}return a.open(e,t,!0),a}(this.method,this.url,this.withCredentials);if(this.responseType)if("arraybuffer"===this.responseType||"text"===this.responseType||"json"===this.responseType||"blob"===this.responseType)t.responseType=this.responseType;else{if("image"!==this.responseType)throw new Error('reponseType can only be one of "arraybuffer", "text", "json", "blob", "image"');t.responseType="blob"}for(var a in"json"===this.responseType&&t.setRequestHeader("Accept","application/json"),this.auth&&"string"==typeof this.auth&&t.setRequestHeader("Authorization",this.auth),this.headers)t.setRequestHeader(a,this.headers[a]);return this.body&&"object"===o(this.body)&&(this.body instanceof FormData||(this.body=JSON.stringify(this.body),t.setRequestHeader("Content-Type","application/json"))),this.onProgress&&(t.onprogress=this.onProgress),new Promise((function(o,a){t.onreadystatechange=function(n){if(4===t.readyState){if(200===t.status||201===t.status||204===t.status)return e.parseResponse(e.xhr).then((function(e){o(e)}));if(0!==t.status)return e.parseResponse(e.xhr).then((function(e){a(r({status_code:t.status},e))})).catch((function(){a({status_code:t.status})}))}},t.onerror=function(e){a(e)},t.send(e.body),e.sendAttempts++}))},e.prototype.parseResponse=function(e){var t=this;return new Promise((function(a,n){try{var r=e.response;if(t.contentLength=e.getResponseHeader("Content-Length"),"json"===t.responseType&&"object"!==o(r))a(JSON.parse(e.responseText));else if(200!==e.status&&201!==e.status&&204!==e.status||"image"!==t.responseType)a(r);else{var s=URL.createObjectURL(r);(r=new Image).src=s,r.crossOrigin="Anonymous",r.onload=function(){URL.revokeObjectURL(s),a(r)}}}catch(e){n({error:"Payload was not valid JSON"})}}))},e.prototype.abort=function(){if(null===this.xhr)throw new Error("Cannot abort unsent Request");this.xhr.abort()},e}();t.Request=c}},t={};function o(a){var n=t[a];if(void 0!==n)return n.exports;var r=t[a]={exports:{}};return e[a].call(r.exports,r,r.exports,o),r.exports}o.d=(e,t)=>{for(var a in t)o.o(t,a)&&!o.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var a={};return(()=>{var e,t,n,r,s,i,c;o.r(a),o.d(a,{IdOption:()=>r,setup:()=>Qo}),function(e){e.FORWARD="FORWARD",e.LEFT="LEFT",e.RIGHT="RIGHT",e.BACK="BACK",e.UP="UP",e.DOWN="DOWN"}(e||(e={}));class DirectionConverter{constructor(t){this.directionMap={[e.FORWARD]:t.FORWARD.clone(),[e.LEFT]:t.LEFT.clone(),[e.RIGHT]:t.RIGHT.clone(),[e.BACK]:t.BACK.clone(),[e.UP]:t.UP.clone(),[e.DOWN]:t.DOWN.clone()}}toVector(e){return this.directionMap[e]}}!function(e){e.INSIDE="mode.inside",e.OUTSIDE="mode.outside",e.DOLLHOUSE="mode.dollhouse",e.FLOORPLAN="mode.floorplan",e.TRANSITIONING="mode.transitioning"}(t||(t={}));class ViewmodeConverter{constructor(e){this.CwfViewmode=e}toSdk(e,o){switch(e){case this.CwfViewmode.Panorama:return o?t.INSIDE:t.OUTSIDE;case this.CwfViewmode.Dollhouse:return t.DOLLHOUSE;case this.CwfViewmode.Floorplan:return t.FLOORPLAN;case this.CwfViewmode.Transition:return t.TRANSITIONING;case this.CwfViewmode.Outdoor:return t.OUTSIDE;default:return t.INSIDE}}fromSdk(e){switch(e){case t.INSIDE:case t.OUTSIDE:return this.CwfViewmode.Panorama;case t.DOLLHOUSE:return this.CwfViewmode.Dollhouse;case t.FLOORPLAN:return this.CwfViewmode.Floorplan;case t.TRANSITIONING:return this.CwfViewmode.Transition}}}class CommandModeConverter{constructor(e){this.CommandMode=e}toSdk(e){switch(e){case this.CommandMode.INSIDE:return t.INSIDE;case this.CommandMode.DOLLHOUSE:return t.DOLLHOUSE;case this.CommandMode.FLOORPLAN:return t.FLOORPLAN;case this.CommandMode.TRANSITIONING:return t.TRANSITIONING;case this.CommandMode.OUTSIDE:return t.OUTSIDE;default:return t.INSIDE}}fromSdk(e){switch(e){case t.INSIDE:return this.CommandMode.INSIDE;case t.OUTSIDE:return this.CommandMode.OUTSIDE;case t.DOLLHOUSE:return this.CommandMode.DOLLHOUSE;case t.FLOORPLAN:return this.CommandMode.FLOORPLAN;case t.TRANSITIONING:return this.CommandMode.TRANSITIONING}}}!function(e){e.INSTANT="transition.instant",e.FLY="transition.fly",e.FADEOUT="transition.fade",e.MOVEFADE="transition.movefade"}(n||(n={}));class CameraTransitionConverter{constructor(e){this.toSdkTransitionMap={[e.Interpolate]:n.FLY,[e.FadeToBlack]:n.FADEOUT,[e.Instant]:n.INSTANT,[e.MoveToBlack]:n.MOVEFADE},this.fromSdkTransitionMap={[n.FLY]:e.Interpolate,[n.FADEOUT]:e.FadeToBlack,[n.INSTANT]:e.Instant,[n.MOVEFADE]:e.MoveToBlack}}toSdkTransition(e){return this.toSdkTransitionMap[e]}fromSdkTransition(e){return this.fromSdkTransitionMap[e]}}class Conversion{constructor(e){this.THREE=e,this.tempEuler=new e.Euler}quaternionToRotation(e,t){const o=this.tempEuler.setFromQuaternion(e,Conversion.eulerOrder),a=t||{};return a.x=this.THREE.MathUtils.radToDeg(o.x),a.y=this.THREE.MathUtils.radToDeg(o.y),a.z=this.THREE.MathUtils.radToDeg(o.z),a}rotationToQuaternion(e,t){const o=t||new this.THREE.Quaternion;return this.tempEuler.x=this.THREE.MathUtils.degToRad(e.x),this.tempEuler.y=this.THREE.MathUtils.degToRad(e.y),this.tempEuler.z=this.THREE.MathUtils.degToRad(e.z||0),this.tempEuler.order=Conversion.eulerOrder,o.setFromEuler(this.tempEuler)}}Conversion.eulerOrder="YXZ";class SweepUtils{constructor(e){this.CwfSweepAlignmentType=e}isSweepAligned(e,t){if(!e||!t)return!1;const o=t&&e.getSweep(t);return!!o&&o.alignmentType===this.CwfSweepAlignmentType.ALIGNED}isCurrentSweepAligned(e){return this.isSweepAligned(e,e.currentSweep)}}!function(e){e.LEGACY="legacy",e.API="api"}(r||(r={}));class LegacySweepIdMap{constructor(e){this.sweepData=e}getIdForSweep(e){return e.uuid}getSweepForId(e){return this.sweepData.getSweepByUuid(e)}getIdFromCwfId(e){const t=this.sweepData.getSweep(e);return this.getIdForSweep(t)}}class SweepIdMap{constructor(e){this.sweepData=e}getIdForSweep(e){return e.id}getSweepForId(e){return this.sweepData.getSweep(e)}getIdFromCwfId(e){const t=this.sweepData.getSweep(e);return this.getIdForSweep(t)}}class LegacyFloorIdMap{constructor(e){this.floorData=e}getIdForFloor(e){return String(e.index)}getFloorForId(e){return this.floorData.getFloorAtIndex(parseInt(e,10))}getIdFromCwfId(e){const t=this.floorData.getFloor(e);return this.getIdForFloor(t)}}class FloorIdMap{constructor(e){this.floorData=e}getIdForFloor(e){return e.id}getFloorForId(e){return this.floorData.getFloor(e)}getIdFromCwfId(e){const t=this.floorData.getFloor(e);return this.getIdForFloor(t)}}class LegacyRoomIdMap{constructor(e,t){this.roomData=e,this.floorData=t}getIdForRoom(e){const t=this.floorData.getFloor(e.floorId);return t?String((t.index<<16)+e.meshSubgroup):""}getRoomForId(e){return this.roomData.getByMeshSubgroup(65535&parseInt(e,10))}getIdFromCwfId(e){const t=this.roomData.get(e);return this.getIdForRoom(t)}}class RoomIdMap{constructor(e){this.roomData=e}getIdForRoom(e){return e.id}getRoomForId(e){return this.roomData.get(e)}getIdFromCwfId(e){const t=this.roomData.get(e);return this.getIdForRoom(t)}}!function(e){e.PHASE_CHANGE="application.phasechange",e.APP_CHANGE="application.appchange"}(s||(s={})),function(e){e.UNKNOWN="application.unknown",e.WEBVR="application.webvr",e.SHOWCASE="application.showcase",e.WORKSHOP="application.workshop"}(i||(i={})),function(e){e.UNINITIALIZED="appphase.uninitialized",e.WAITING="appphase.waiting",e.LOADING="appphase.loading",e.STARTING="appphase.starting",e.PLAYING="appphase.playing",e.ERROR="appphase.error"}(c||(c={}));class AppPhaseConverter{constructor(e){this.toSdkPhaseMap={[e.UNINITIALIZED]:c.UNINITIALIZED,[e.WAITING]:c.WAITING,[e.LOADING]:c.LOADING,[e.STARTING]:c.STARTING,[e.PLAYING]:c.PLAYING,[e.ERROR]:c.ERROR},this.fromSdkPhaseMap={[c.UNINITIALIZED]:e.UNINITIALIZED,[c.WAITING]:e.WAITING,[c.LOADING]:e.LOADING,[c.STARTING]:e.STARTING,[c.PLAYING]:e.PLAYING,[c.ERROR]:e.ERROR}}toSdkAppPhase(e){return this.toSdkPhaseMap[e]}fromSdkAppPhase(e){return this.fromSdkPhaseMap[e]}}class ApplicationConverter{constructor(e){this.toSdkApplicationMap={[e.SHOWCASE]:i.SHOWCASE,[e.WORKSHOP]:i.WORKSHOP,[e.WEBVR]:i.WEBVR,[e.UNKNOWN]:i.UNKNOWN},this.fromSdkApplicationMap={[i.SHOWCASE]:e.SHOWCASE,[i.WORKSHOP]:e.WORKSHOP,[i.WEBVR]:e.WEBVR,[i.UNKNOWN]:e.UNKNOWN}}toSdkApplication(e){return this.toSdkApplicationMap[e]}fromSdkApplication(e){return this.fromSdkApplicationMap[e]}}class SdkObservable{constructor(e,t,o){this.dependencies=e,this.subscriptionFactory=t,this.observers=new Set,this.currentData=o.create(),this.freshDataCache=o.create()}static async create(e,t,o){const a=await e.getDependencies();return new SdkObservable(a,t,o)}getData(){return this.currentData.data}subscribe(e){return this.addObserver(e),new class ObserverSubscription{constructor(e){this.sdkObservable=e,this.renew()}renew(){this.sdkObservable.addObserver(e)}cancel(){this.sdkObservable.removeObserver(e)}}(this)}addObserver(e){if(!this.observers.has(e)){class SdkObservableFacade{constructor(e){this.observable=e}onChanged(){this.observable.onChanged()}}this.observers.add(e),1===this.observers.size&&(this.currentData.update(...this.dependencies),this.changeSubscription=this.subscriptionFactory.create(new SdkObservableFacade(this),...this.dependencies)),e.dirty=!0}}removeObserver(e){0!==this.observers.size&&(this.observers.delete(e),0===this.observers.size&&this.changeSubscription.cancel())}onChanged(){if(this.freshDataCache.update(...this.dependencies),!this.currentData.equals(this.freshDataCache)){this.currentData.copy(this.freshDataCache);for(const e of this.observers)e.dirty=!0}}}class ClassFactory{constructor(e,...t){this.ctor=e,this.args=t}create(...e){return new this.ctor(...this.args,...e)}}const d=e=>"propertyObservers"===e||"changeObservers"===e||"isObservable"===e||"childChangeFunctions"===e||"isObservableProxy"===e||"diffRoot"===e||"elementChangedHandlers"===e||"knownKeysMap"===e||"knownKeysList"===e||"isVector2"===e||"isVector3"===e||"isQuaternion"===e||"onPropertyChanged"===e||"removeOnPropertyChanged"===e||"onChanged"===e||"target"===e,u=(e,t=[])=>{if(void 0!==e){if(t.includes(e))return Array.isArray(e)||ArrayBuffer.isView(e)?[]:{};if(e instanceof Date)return new Date(e);if(null===e)return null;if(e.deepCopy)return e.deepCopy();if(e.isQuaternion)return{x:e.x,y:e.y,z:e.z,w:e.w};if("object"==typeof e){const o=Array.isArray(e)||ArrayBuffer.isView(e)?[]:{};for(const a in e){if(d(a))continue;const n=e[a];n instanceof Date?o[a]=new Date(n):"function"!=typeof n&&(t.push(e),o[a]="object"==typeof n?u(n,t):n,t.pop())}return o}return e}},l=(e,t)=>{if(null===e||"object"!=typeof e)return e!==t;if(!t)return!0;for(const o in t)if(!(o in e))return!0;for(const o in e)if(l(e[o],t[o]))return!0;return!1};class AppStateSubFactory{create(e,t){return t.onChanged((()=>e.onChanged()))}}class AppStateObservable{constructor(e,t){this._data={phase:c.UNINITIALIZED,phaseTimes:{},application:i.SHOWCASE},this.AppPhase=e.AppPhase,this.appPhaseConverter=t.appPhaseConverter,this.applicationConverter=t.applicationConverter}get data(){return this._data}equals(e){return!l(this,e)}copy(e){this._data.phase=e.data.phase,function(e,t,...o){for(const a of o)e[a]=t[a]}(this.data.phaseTimes,e.data.phaseTimes),this._data.application=e.data.application}update(e){this._data.phase=this.appPhaseConverter.toSdkAppPhase(e.phase),this._data.application=this.applicationConverter.toSdkApplication(e.application),this._data.phaseTimes[c.WAITING]=e.phaseTimes[this.AppPhase.WAITING],this._data.phaseTimes[c.LOADING]=e.phaseTimes[this.AppPhase.LOADING],this._data.phaseTimes[c.PLAYING]=e.phaseTimes[this.AppPhase.PLAYING],this._data.phaseTimes[c.STARTING]=e.phaseTimes[this.AppPhase.STARTING],this._data.phaseTimes[c.UNINITIALIZED]=e.phaseTimes[this.AppPhase.UNINITIALIZED],this._data.phaseTimes[c.ERROR]=e.phaseTimes[this.AppPhase.ERROR]}}class Command_Command{}class GetAppStateCommand extends Command_Command{constructor(){super(),this.id="GET_APP_STATE"}}class GetAppPhaseTimesCommand extends Command_Command{constructor(){super(),this.id="GET_APP_PHASE_TIMES"}}var p=o(403);const h=window.navigationStart||Date.now();var m;!function(e){e[e.ERROR=0]="ERROR",e[e.WARN=1]="WARN",e[e.INFO=2]="INFO",e[e.DEBUG=3]="DEBUG"}(m||(m={}));class Logger{constructor(e){this.timers={},this.handlers={[m.DEBUG]:console.debug,[m.INFO]:console.info,[m.WARN]:console.warn,[m.ERROR]:console.error};const t=e.split(new RegExp("/|\\\\"));this.prefix="["+t[t.length-1].replace(".js","")+"]"}message(e){if(Logger.level>=e&&console){return(this.handlers[e]?this.handlers[e]:console.log).bind(console,this.getPrefix())}return()=>{}}get debug(){return this.message(m.DEBUG)}get debugWarn(){return this.message(Logger.level>=m.DEBUG?m.WARN:m.DEBUG)}get info(){return this.message(m.INFO)}get warn(){return this.message(m.WARN)}get error(){return this.message(m.ERROR)}time(e){Logger.level>=m.DEBUG&&(this.timers[e]=Date.now())}timeEnd(e){if(Logger.level>=m.DEBUG){const t=this.timers[e];if(!t)return;const o=(Date.now()-t)/1e3;this.debug(e,o+"s")}}getPrefix(){const e=(Date.now()-h)/1e3+"s";return`${this.prefix} ${e}`}}Logger.level=m.INFO;const g=new Logger("sdk command");class SdkCommand{constructor(e){this._executor=e}static async create(e,t){const o=await e.getDependencies();return new SdkCommand(t.create(...o))}get executor(){return this._executor}exec(e,t,o){const a=this.executor.validateInput(e,o);this.executor.exec(a,t,o)}}function f(e,t,o){return`'${e}' is expected to be a(n) ${t}; got '${JSON.stringify(o)}'`}function w(e,t,o){class PromiseReturn{constructor(e,t){this.resolve=e,this.reject=t}return(e){this.resolve(e)}throw(e){this.reject(e)}}return new Promise((function(a,n){e.exec(t,new PromiseReturn(a,n),o)}))}class DeprecatedDecorator{constructor(e,t,...o){this.deprecationWarning=t,this.executor=e.create(...o)}validateInput(e,t){return g.warn(this.deprecationWarning),this.executor.validateInput(e,t)}exec(e,t,o){this.executor.exec(e,t,o)}}function y(e){return!!e&&"string"==typeof e}function T(e){return"string"==typeof e}const I=new Logger("asset.registerTexture");class RegisterTexture{constructor(e,t,o){this.THREE=e,this.loadImage=t,this.scopedTextures=o,this.svgLoader=new SvgLoader(new p.RequestQueue)}validateInput(e,t){const{textureId:o,textureSrc:a}=e;if(!y(o))throw Error(`textureId ${o} is not a valid string`);if(!y(a))throw Error(`textureSrc ${a} is not a valid string`);const n=this.scopedTextures.get(t.applicationKey);if(n){if(n.map[o])throw Error(o+" already has a registered texture")}return{textureId:o,textureSrc:a}}async exec(e,t,o){const{textureId:a,textureSrc:n}=e,r=this.scopedTextures.get(o.applicationKey)||{imagePromise:{},map:{}};this.scopedTextures.set(o.applicationKey,r);const s=new Promise(((e,t)=>{const o=".svg";if(n.indexOf(o,n.length-o.length)>-1)this.svgLoader.load(n).then((t=>{const o=new this.THREE.Texture(t);o.needsUpdate=!0,r.map[a]=o,e(o.image)}));else{const o=this.loadImage(n,(()=>{r.map[a]=o,e(o.image)}),(()=>{t("Failed to load "+n)}))}}));r.imagePromise[a]=s;try{await s}catch(e){return delete r.imagePromise[a],void t.throw(e)}t.return()}}class SvgLoader{constructor(e){this.queue=e}async load(e){const t=await this.queue.get(e,{responseType:"text"}),o=document.createElement("div");o.innerHTML=t;const a=o.querySelector("svg");if(!a)throw Error("Failed trying to load "+e+"as an svg.");const n=a.getAttribute("width"),r=a.getAttribute("height");return n||r?(r&&!n&&(I.warn(e,"does not have a defined width. Defaulting width equal to height"),a.setAttribute("width",r)),n&&!r&&(I.warn(e,"does not have a defined height. Defaulting height equal to width"),a.setAttribute("height",n))):(I.warn(e,"does not have a defined size. Defaulting to a 128x128 resolution"),a.setAttribute("width",SvgLoader.defaultResolution),a.setAttribute("height",SvgLoader.defaultResolution)),new Promise((e=>{const t=new Image;t.onload=()=>e(t),t.src=URL.createObjectURL(new Blob([a.outerHTML],{type:"image/svg+xml"}))}))}}SvgLoader.defaultResolution="128";class DependencyFetcher{constructor(...e){this.dependencies=e}async getDependencies(){return Promise.all(this.dependencies)}static extend(e,...t){return new DependencyFetcher(...e.dependencies,...t)}static combine(e,t){return new DependencyFetcher(...e.dependencies,...t.dependencies)}}function E(e,t,o,a){return{registerTexture:function(e,t,o,a){const n=SdkCommand.create(a,new ClassFactory(RegisterTexture,t,o.loadImage));return e.addAsyncCommandToInterface({namespace:"Asset",name:"registerTexture",args:["textureId","textureSrc"]},n),n}(e,t,o,new DependencyFetcher(a.iconMaps))}}class GetPoseCommand extends Command_Command{constructor(){super(),this.id="GET_POSE"}}const C=40*Math.PI/180/1e3;class LookAtScreenCoordsCommand extends Command_Command{constructor(e){super(),this.payload=e}}var S;!function(e){e.MOVE="camera.move"}(S||(S={}));const v=new Logger("broadcast.move");function b(e,t){return Object.values(e).includes(t)}class MoveDirectionCommand extends Command_Command{constructor(e){super(),this.id="MOVE_DIRECTION",this.payload=e}}class PanCommand extends Command_Command{constructor(e){super(),this.id="PAN",this.payload={x:e.x,z:e.z}}}class AggregateSubscription{constructor(...e){this.subs=e}renew(){for(const e of this.subs)e.renew()}cancel(){for(const e of this.subs)e.cancel()}}function D(e,t){e.x=t.x,e.y=t.y}function A(e,t){D(e,t),e.z=t.z}class BaseException_BaseException extends Error{constructor(e,t){var o;super(e instanceof Error?e.message:e),this.name="BaseException",t&&(this.code=t),e instanceof Error&&(this.originalError=e,(o=e)&&o instanceof Error&&o.isMock&&(this.isMock=!0))}}class ArraySizeMismatchException extends BaseException_BaseException{constructor(){super("Cannot copy into an array of a different size"),this.name="ArraySizeMismatch"}}const O=(e,t,o=1e-5)=>Math.abs(e-t)<=o,M=(e,t,o=1e-5)=>O(e.x,t.x,o)&&O(e.y,t.y,o),N=(e,t,o=1e-5)=>M(e,t,o)&&O(e.z,t.z,o);class PoseSubFactory{create(e,t,o,a){const n=()=>e.onChanged();return new AggregateSubscription(t.onChanged(n),o.onChanged(n),a.onChanged(n))}}class ObservablePose{constructor(e,o){this._data={position:{x:0,y:0,z:0},rotation:{x:0,y:0},projection:new Float32Array(16),sweep:"",mode:t.TRANSITIONING},this.THREE=e,this.viewmodeConverter=o,this.tempEuler=new e.Euler}get data(){return this._data}equals(e){const t=1e-5;return N(e._data.position,this._data.position,t)&&M(e._data.rotation,this._data.rotation,t)&&((e,t,o=1e-5)=>e.length===t.length&&!Array.prototype.some.call(e,((e,a)=>!O(e,t[a],o))))(e._data.projection,this._data.projection,t)&&e._data.sweep===this._data.sweep&&e._data.mode===this._data.mode}update(e,t,o,a){const n=this.tempEuler.setFromQuaternion(e.pose.rotation,"YXZ"),r=t.currentSweep&&t.isSweepUnaligned(t.currentSweep);A(this._data.position,e.pose.position),this._data.rotation.x=this.THREE.MathUtils.radToDeg(n.x),this._data.rotation.y=this.THREE.MathUtils.radToDeg(n.y),this._data.projection=Float32Array.from(e.pose.projection.asThreeMatrix4().transpose().elements),this._data.sweep=t.currentSweepObject?a.getIdForSweep(t.currentSweepObject):"",this._data.mode=this.viewmodeConverter.toSdk(o.currentMode,!r)}copy(e){A(this._data.position,e.data.position),D(this._data.rotation,e.data.rotation),function(e,t){if(e.byteLength!==t.byteLength)throw new ArraySizeMismatchException;const o=t.length;for(let a=0;a<o;++a)e[a]=t[a]}(this._data.projection,e.data.projection),this._data.sweep=e.data.sweep,this._data.mode=e.data.mode}}class RotateCommand extends Command_Command{constructor(e){super(),this.id="ROTATE",this.payload={xAngle:e.xAngle,yAngle:e.yAngle,zAngle:e.zAngle,rotationSpeed:e.rotationSpeed}}}function R(e,t,o){const a=new e.Euler,n=new e.Euler;return async function(e,r,s,i){if(s.currentMode!==t.Panorama)throw Error("Camera.setRotation is only available in Panorama mode");const c=i.xAngle%(.5*Math.PI),d=i.yAngle%(2*Math.PI),u=e.pose.rotation;a.setFromQuaternion(u,"YXZ");let l=d-a.y;return Math.abs(l)>Math.PI&&(l-=2*Math.sign(l)*Math.PI),n.set(c-a.x,l,0,"YXZ"),n.y%=2*Math.PI,o(r,{xAngle:-n.y,yAngle:n.x,zAngle:0,rotationSpeed:i.rotationSpeed})}}class SetOrientationCommand extends RotateCommand{}const x=.7,P=3,F=function(e,t,o){return Math.max(t,Math.min(e,o))};const L=new Logger("command.zoom");class ZoomToExecutor{constructor(e,t,o,a){this.cameraData=o,this.viewmodeData=a,this.Viewmode=e.Viewmode,this.ZoomSetCommand=e.ZoomSetCommand,this.issueCommand=t.issueCommand}validateInput(e){const t=e.zoomPct-0;if(isNaN(t))throw Error(t+" is not a valid zoom level");return t<x&&P<t&&(e.zoomPct=F(t,x,P),L.warn(t,`is outside the valid zoom range of [${x}, ${P}]`)),e}async exec(e,t,o){k(this.Viewmode,this.viewmodeData.currentMode),await this.issueCommand(new this.ZoomSetCommand(e.zoomPct)),t.return(this.cameraData.zoom())}}class ZoomByExecutor{constructor(e,t,o,a){this.cameraData=o,this.viewmodeData=a,this.Viewmode=e.Viewmode,this.ZoomInCommand=e.ZoomInCommand,this.issueCommand=t.issueCommand}validateInput(e){const t=e.zoomDelta-0;if(isNaN(t))throw Error(t+" is not a valid zoom delta");return e.zoomDelta=t||0,e}async exec(e,t,o){k(this.Viewmode,this.viewmodeData.currentMode),await this.issueCommand(new this.ZoomInCommand(e.zoomDelta)),t.return(this.cameraData.zoom())}}class ZoomResetExecutor{constructor(e,t,o,a){this.viewmodeData=a,this.Viewmode=e.Viewmode,this.ZoomResetCommand=e.ZoomResetCommand,this.issueCommand=t.issueCommand}validateInput(e){return e}async exec(e,t,o){k(this.Viewmode,this.viewmodeData.currentMode),await this.issueCommand(new this.ZoomResetCommand),t.return()}}function k(e,t){if(t!==e.Panorama)throw Error("Zoom controls are currently only supported in Panorama mode")}class ZoomSubFactory{create(e,t){return t.onChanged((()=>e.onChanged()))}}class ZoomObservableData{constructor(e){this._data={level:1}}get data(){return this._data}equals(e){return this._data.level===e.data.level}copy(e){this._data.level=e.data.level}update(e,t){t.isInside()&&(this._data.level=e.zoom())}}function _(e,t){const o=new e.Euler;return function(a,n,r,s,i){const c=o.setFromQuaternion(n.pose.rotation,"YXZ"),d=r.currentSweep&&r.isSweepUnaligned(r.currentSweep);return a.position.x=n.pose.position.x,a.position.y=n.pose.position.y,a.position.z=n.pose.position.z,a.rotation.x=e.MathUtils.radToDeg(c.x),a.rotation.y=e.MathUtils.radToDeg(c.y),a.projection=Float32Array.from(n.pose.projection.asThreeMatrix4().transpose().elements),a.sweep=r.currentSweepObject?i.getIdForSweep(r.currentSweepObject):"",a.mode=t.toSdk(s.currentMode,!d),a}}class FloorSubFactory{constructor(){this.wasInTransition=!1,this.currentFloor=""}create(e,t,o,a){return new AggregateSubscription(t.makeFloorChangeSubscription((()=>this.throttleCurrentFloorChanges(e,t))),a.onChanged((()=>this.throttleCameraTranstionChanges(e,a,o))),o.onChanged((()=>this.throttleCameraTranstionChanges(e,a,o))))}throttleCameraTranstionChanges(e,t,o){const a=t.transition.active||o.transition.active;a!==this.wasInTransition&&(this.wasInTransition=a,e.onChanged())}throttleCurrentFloorChanges(e,t){const o=t.currentFloorId;o!==this.currentFloor&&(this.currentFloor=o,e.onChanged())}}class CurrentFloorObservableData{constructor(e){this._data={id:void 0,sequence:void 0,name:""},this.SweepAlignmentType=e.SweepAlignmentType,this.SweepPlacementType=e.SweepPlacementType}get data(){return this._data}equals(e){const t=this.data,o=e.data;return t.id===o.id&&t.sequence===o.sequence&&t.name===o.name}copy(e){this._data.id=e.data.id,this._data.sequence=e.data.sequence,this._data.name=e.data.name}update(e,t,o,a){const n=e.currentFloor,r=t.currentSweep&&t.getSweep(t.currentSweep);o.transition.active&&!t.transitionActive||function(){if(t.transitionActive&&t.transition.to&&t.transition.from){const e=t.getSweep(t.transition.to),o=t.getSweep(t.transition.from);return e.floorId!==o.floorId}return!1}()?(this._data.id="",this._data.sequence=void 0,this._data.name=""):r&&r.alignmentType===this.SweepAlignmentType.UNALIGNED&&r.placementType===this.SweepPlacementType.UNPLACED?(this._data.id=void 0,this._data.sequence=void 0,this._data.name=""):n?(this._data.id=a.getIdFromCwfId(n.id),this._data.sequence=n.index,this._data.name=n.name):(this._data.id="",this._data.sequence=-1,this._data.name="all")}}var V;!function(e){e.CHANGE_START="floors.changestart",e.CHANGE_END="floors.changeend"}(V||(V={}));class SdkCollection{constructor(e,t,o){this.dependencies=e,this.subscriptionFactory=t,this.dataFactory=o,this.dirty=!0,this.observers=new Set,this.currentData=o.create(...e);this.changeSubscription=this.subscriptionFactory.create(new class DirtinessObserver{constructor(e){this.collection=e}onChanged(){this.collection.dirty=!0;for(const e of this.collection.observers)e.onChanged()}}(this),...this.dependencies),this.changeSubscription.cancel()}static async create(e,t,o){const a=await e.getDependencies();return new SdkCollection(a,t,o)}getData(){return this.currentData.data}subscribe(e){const t=this.dependencies;const o=new class CollectionChangeObserver{constructor(e){this.sdkCollection=e,this.needsUpdate=!0,this.diffRecord={added:new Map,removed:new Map,updated:new Map},this.dataView=e.dataFactory.create(...t)}get dirty(){return this.needsUpdate}readDiff(){const{added:e,removed:t,updated:o}=this.diffRecord;if(e.clear(),t.clear(),o.clear(),!this.dirty)return this.diffRecord;this.sdkCollection.update();const a=this.sdkCollection.currentData;for(const t in a.data)this.dataView.data.hasOwnProperty(t)?this.dataView.isItemEqual(a,t)||o.set(t,a.data[t]):e.set(t,a.data[t]);for(const e in this.dataView.data)a.data.hasOwnProperty(e)||t.set(e,this.dataView.data[e]);return this.dataView.update(),this.needsUpdate=!1,this.diffRecord}onChanged(){this.needsUpdate=!0}renew(){this.sdkCollection.addObserver(this)}cancel(){this.sdkCollection.removeObserver(this)}}(this);return this.addObserver(o),o}update(){this.dirty&&(this.currentData.update(),this.dirty=!1)}addObserver(e){0===this.observers.size&&(this.changeSubscription.renew(),this.dirty=!0),this.observers.add(e)}removeObserver(e){this.observers.delete(e),0===this.observers.size&&(this.changeSubscription.cancel(),this.currentData.clear())}}class collection_data_FloorSubFactory{create(e,t){return t.onChanged((()=>e.onChanged()))}}class FloorDataCollection{constructor(e,t){this.floorData=e,this.floorIdMap=t,this._data={}}get data(){return this._data}isItemEqual(e,t){const o=this.data[t],a=e.data[t];return o.id===a.id&&o.name===a.name&&o.sequence===a.sequence}update(){for(const e of this.floorData.getCollection()){const t=this.floorIdMap.getIdFromCwfId(e.id),o=this._data[t]||{};o.id=t,o.sequence=e.index,o.name=e.name,this._data[t]=o}for(const e in this.data){this.floorIdMap.getFloorForId(e)||delete this._data[e]}}clear(){this._data={}}}class GetFloorsDataCommand extends Command_Command{constructor(){super(...arguments),this.id="GET_FLOORS_DATA"}}async function U(e){try{const{currentFloor:t,totalFloors:o}=e,a=e.getFloorNames();return{currentFloor:t?t.index:-1,floorNames:a,totalFloors:o}}catch(e){throw Error("no floors currently loaded")}}class ChangeFloorCommand extends Command_Command{constructor(e){super(),this.id="MOVE_TO_FLOOR",this.payload=e}}class ShowAllFloorsExecutor{constructor(e,t,o){this.floorsViewData=o,this.issueCommand=t.issueCommand,this.ShowAllFloorsCommand=e.ShowAllFloorsCommand}validateInput(e){return e}async exec(e,t,o){try{await this.issueCommand(new this.ShowAllFloorsCommand({moveCamera:!0}));const e=this.floorsViewData.currentFloor;t.return(e?e.index:-1)}catch(e){t.throw("Could not show all floors")}}}class LabelGetCommand extends Command_Command{constructor(){super(...arguments),this.id="LABEL_GET"}}var G,H,B,z,j,q,W,$,K,X,Y,Z,Q,J,ee,te,oe,ae,ne,re;function se(e,t){return function(o,a,n,r){const s=n.getCollection(),i=[],c=new e.Vector2;for(const n of s){t(o,n.position,c);const{id:s,index:d}=a.getFloor(n.floorId),l=r.getIdFromCwfId(s),p=u(n);i.push(Object.assign(Object.assign({},p),{position:(new e.Vector3).copy(n.position),screenPosition:c,floor:d,floorInfo:{id:l,sequence:d}}))}return i}}!function(e){e.POSITION_UPDATED="label.positionupdated"}(G||(G={}));class LabelSubFactory{create(e,t){return t.onChanged((()=>e.onChanged()))}}class LabelCurrentCollection{constructor(e,t,o){this.labelData=e,this.floorsData=t,this.floorIdMap=o,this._data={}}get data(){return this._data}isItemEqual(e,t){return!l(this.data[t],e.data[t])}update(){var e;for(const t of this.labelData.getCollection()){const o=null!==(e=this.data[t.sid])&&void 0!==e?e:{};o.position=t.position,o.sid=t.sid,o.text=t.text,o.visible=t.visible;const a=this.floorsData.getFloor(t.floorId);o.floorInfo={id:this.floorIdMap.getIdFromCwfId(a.id),sequence:a.index},this.data[o.sid]=o}for(const e in this.data){this.labelData.getLabel(e)||delete this.data[e]}}clear(){this._data={}}}class CreateLinkExecutor{constructor(e){this.deepLinker=e}validateInput(e){return e}exec(e,t,o){const a=this.deepLinker.creator.createLink();t.return(decodeURIComponent(a.href))}}class CreateDeepLinkExecutor{constructor(e){this.deepLinker=e}validateInput(e){return e}exec(e,t,o){const a=this.deepLinker.creator.createDeepLink();t.return(decodeURIComponent(a.href))}}function ie(e){return!!e&&"object"==typeof e}function ce(e){return"boolean"==typeof e}function de(e,t,o,a){switch(e){case W.OpenPolicy.DEFAULT:o.handler.resetPolicy(t);break;case W.OpenPolicy.NEW_WINDOW:o.handler.setPolicy(t,o.handler.HandlingPolicy.NEW_WINDOW);break;case W.OpenPolicy.SAME_FRAME:o.handler.setPolicy(t,o.handler.HandlingPolicy.IN_FRAME);break;case W.OpenPolicy.CURRENT_WINDOW:o.handler.setPolicy(t,o.handler.HandlingPolicy.CUSTOM,(e=>{a.sendPrivateMessage("open link",{href:e})}))}}!function(e){let t,o,a;!function(e){e.PHASE_CHANGE="application.phasechange"}(t=e.Event||(e.Event={})),function(e){e.UNINITIALIZED="appphase.uninitialized",e.WAITING="appphase.waiting",e.LOADING="appphase.loading",e.STARTING="appphase.starting",e.PLAYING="appphase.playing",e.ERROR="appphase.error"}(o=e.Phase||(e.Phase={})),function(e){e.SHOWCASE="application.showcase"}(a=e.Application||(e.Application={}))}(H||(H={})),function(e){let t,o;!function(e){e.MOVE="camera.move"}(t=e.Event||(e.Event={})),function(e){e.FORWARD="FORWARD",e.LEFT="LEFT",e.RIGHT="RIGHT",e.BACK="BACK",e.UP="UP",e.DOWN="DOWN"}(o=e.Direction||(e.Direction={}))}(B||(B={})),function(e){let t;!function(e){e.CHANGE_START="floors.changestart",e.CHANGE_END="floors.changeend"}(t=e.Event||(e.Event={}))}(z||(z={})),function(e){let t;!function(e){e.SUCCESS="astar.status.success",e.NO_PATH="astar.status.no_path",e.TIMEOUT="astar.status.timeout",e.NO_START_VERTEX="astar.status.no_start",e.NO_END_VERTEX="astar.status.no_end"}(t=e.AStarStatus||(e.AStarStatus={}))}(j||(j={})),function(e){let t;!function(e){e.POSITION_UPDATED="label.positionupdated"}(t=e.Event||(e.Event={}))}(q||(q={})),function(e){let t,o;!function(e){e.WINDOW="link.creationpolicy.window",e.REFERRER="link.creationpolicy.referrer",e.MATTERPORT="link.creationpolicy.matterport"}(t=e.CreationPolicy||(e.CreationPolicy={})),function(e){e.DEFAULT="link.openpolicy.deafult",e.NEW_WINDOW="link.openpolicy.newwindow",e.SAME_FRAME="link.openpolicy.sameframe",e.CURRENT_WINDOW="link.openpolicy.current"}(o=e.OpenPolicy||(e.OpenPolicy={}))}(W||(W={})),function(e){let t,o,a,n,r;!function(e){e.INSTANT="transition.instant",e.FLY="transition.fly",e.FADEOUT="transition.fade"}(t=e.Transition||(e.Transition={})),function(e){e.NAVIGATION="tag.link.nav",e.MODEL="tag.link.model",e.EXT_LINK="tag.link.ext"}(o=e.LinkType||(e.LinkType={})),function(e){e.NONE="tag.chunk.none",e.TEXT="tag.chunk.text",e.LINK="tag.chunk.link"}(a=e.DescriptionChunkType||(e.DescriptionChunkType={})),function(e){e.HOVER="tag.hover",e.CLICK="tag.click",e.LINK_OPEN="tag.linkopen"}(n=e.Event||(e.Event={})),function(e){e.NONE="mattertag.media.none",e.PHOTO="mattertag.media.photo",e.VIDEO="mattertag.media.video",e.RICH="mattertag.media.rich"}(r=e.MediaType||(e.MediaType={}))}($||($={})),function(e){let t,o,a;!function(e){e.INSIDE="mode.inside",e.OUTSIDE="mode.outside",e.DOLLHOUSE="mode.dollhouse",e.FLOORPLAN="mode.floorplan",e.TRANSITIONING="mode.transitioning"}(t=e.Mode||(e.Mode={})),function(e){e.CHANGE_START="viewmode.changestart",e.CHANGE_END="viewmode.changeend"}(o=e.Event||(e.Event={})),function(e){e.INSTANT="transition.instant",e.FLY="transition.fly",e.FADEOUT="transition.fade"}(a=e.TransitionType||(e.TransitionType={}))}(K||(K={})),function(e){let t;!function(e){e.MODEL_LOADED="model.loaded"}(t=e.Event||(e.Event={}))}(X||(X={})),function(e){let t;!function(e){e.NONE="intersectedobject.none",e.MODEL="intersectedobject.model",e.TAG="intersectedobject.tag",e.SWEEP="intersectedobject.sweep",e.UNKNOWN="intersectedobject.unknown"}(t=e.Colliders||(e.Colliders={}))}(Y||(Y={})),function(e){let t,o,a;!function(e){e.OBJ_LOADER="mp.objLoader",e.FBX_LOADER="mp.fbxLoader",e.DAE_LOADER="mp.daeLoader",e.GLTF_LOADER="mp.gltfLoader",e.SCROLLING_TUBE="mp.scrollingTube",e.TRANSFORM_CONTROLS="mp.transformControls",e.LIGHTS_COMPONENT="mp.lights",e.POINT_LIGHT="mp.pointLight",e.DIRECTIONAL_LIGHT="mp.directionalLight",e.AMBIENT_LIGHT="mp.ambientLight",e.CAMERA="mp.camera",e.INPUT="mp.input",e.XR="mp.xr"}(t=e.ComponentType||(e.ComponentType={})),function(e){e.CLICK="INTERACTION.CLICK",e.HOVER="INTERACTION.HOVER",e.DRAG="INTERACTION.DRAG",e.DRAG_BEGIN="INTERACTION.DRAG_BEGIN",e.DRAG_END="INTERACTION.DRAG_END",e.POINTER_MOVE="INTERACTION.POINTER_MOVE",e.POINTER_BUTTON="INTERACTION.POINTER_BUTTON",e.SCROLL="INTERACTION.SCROLL",e.KEY="INTERACTION.KEY",e.LONG_PRESS_START="INTERACTION.LONG_PRESS_START",e.LONG_PRESS_END="INTERACTION.LONG_PRESS_END",e.MULTI_SWIPE="INTERACTION.MULTI_SWIPE",e.MULTI_SWIPE_END="INTERACTION.MULTI_SWIPE_END",e.PINCH="INTERACTION.PINCH",e.PINCH_END="INTERACTION.PINCH_END",e.ROTATE="INTERACTION.ROTATE",e.ROTATE_END="INTERACTION.ROTATE_END"}(o=e.InteractionType||(e.InteractionType={})),function(e){e.INPUT="input",e.OUTPUT="output",e.EVENT="event",e.EMIT="emit"}(a=e.PathType||(e.PathType={}))}(Z||(Z={})),function(e){let t,o;!function(e){e.CAMERA="sensor.sensortype.camera"}(t=e.SensorType||(e.SensorType={})),function(e){e.SPHERE="sensor.sourcetype.sphere",e.BOX="sensor.sourcetype.box",e.CYLINDER="sensor.sourcetype.cylinder"}(o=e.SourceType||(e.SourceType={}))}(Q||(Q={})),function(e){let t,o,a,n;!function(e){e.ENTER="sweep.enter",e.EXIT="sweep.exit"}(t=e.Event||(e.Event={})),function(e){e.INSTANT="transition.instant",e.FLY="transition.fly",e.FADEOUT="transition.fade"}(o=e.Transition||(e.Transition={})),function(e){e.ALIGNED="aligned",e.UNALIGNED="unaligned"}(a=e.Alignment||(e.Alignment={})),function(e){e.UNPLACED="unplaced",e.AUTO="auto",e.MANUAL="manual"}(n=e.Placement||(e.Placement={}))}(J||(J={})),function(e){let t;!function(e){e.UNKNOWN="tag.attachment.unknown",e.APPLICATION="tag.attachment.application",e.AUDIO="tag.attachment.audio",e.IMAGE="tag.attachment.image",e.MODEL="tag.attachment.model",e.PDF="tag.attachment.pdf",e.RICH="tag.attachment.rich",e.TEXT="tag.attachment.text",e.VIDEO="tag.attachment.video",e.ZIP="tag.attachment.zip",e.SANDBOX="tag.attachment.sandbox"}(t=e.AttachmentType||(e.AttachmentType={}))}(ee||(ee={})),function(e){let t,o;!function(e){e.STARTED="tour.started",e.STOPPED="tour.stopped",e.ENDED="tour.ended",e.STEPPED="tour.stepped"}(t=e.Event||(e.Event={})),function(e){e.INACTIVE="tour.inactive",e.ACTIVE="tour.active",e.STOP_SCHEDULED="tour.stopscheduled"}(o=e.PlayState||(e.PlayState={}))}(te||(te={}));class ModelLinkPolicyExecutor{constructor(e,t){this.sdk=e,this.deepLinker=t}validateInput(e){if(!b(W.OpenPolicy,e.policy))throw Error(`Link.setModelLinkPolicy: ${e.policy} is not a valid Link.OpenPolicy`);if(!y(e.baseHref))throw Error("Link.setModelLinkPolicy: could not determine window.location");const t=ie(e.options)?e.options.templateHref:void 0;if(void 0!==t&&!y(t)||y(t)&&new URL(e.baseHref).origin!==new URL(t).origin)throw Error("Link.setModelLinkPolicy: setting the policy to a different domain is not supported");return{policy:e.policy,baseHref:e.baseHref,options:{templateHref:t}}}exec(e,t,o){const a=e.options.templateHref;e.policy!==W.OpenPolicy.NEW_WINDOW&&e.policy!==W.OpenPolicy.CURRENT_WINDOW||!a?de(e.policy,this.deepLinker.LinkType.MODEL,this.deepLinker,this.sdk):this.deepLinker.handler.setPolicy(this.deepLinker.LinkType.MODEL,this.deepLinker.handler.HandlingPolicy.CUSTOM,(t=>{const o=new URLSearchParams(window.location.search),n=new URL(ue(a,o)),r=new URLSearchParams(t);n.searchParams.set("m",r.get("m")||r.get("model")||""),this.sdk.sendPrivateMessage("open link",{newWindow:e.policy===W.OpenPolicy.NEW_WINDOW,href:decodeURIComponent(n.href)})})),t.return()}}class NavigationLinkPolicyExecutor{constructor(e,t){this.sdk=e,this.deepLinker=t}validateInput(e){if(!b(W.OpenPolicy,e.policy))throw Error(`${e.policy} is not a valid Link.OpenPolicy`);if(!y(e.baseHref))throw Error("Link.setNavigationLinkPolicy: could not determine window.location");const t=ie(e.options)?e.options.templateHref:void 0;if(void 0!==t&&!y(t)||y(t)&&new URL(e.baseHref).origin!==new URL(t).origin)throw Error("Link.setNavigationLinkPolicy: setting the policy to a different domain is not supported");return{policy:e.policy,baseHref:e.baseHref,options:{templateHref:t}}}exec(e,t,o){const a=e.options.templateHref;e.policy!==W.OpenPolicy.NEW_WINDOW&&e.policy!==W.OpenPolicy.CURRENT_WINDOW||!a?de(e.policy,this.deepLinker.LinkType.NAVIGATION,this.deepLinker,this.sdk):this.deepLinker.handler.setPolicy(this.deepLinker.LinkType.NAVIGATION,this.deepLinker.handler.HandlingPolicy.CUSTOM,(t=>{const o=new URLSearchParams(window.location.search),n=new URL(ue(a,o)),r=new URLSearchParams(t);!function(e,t){const[o,a,n,r,s,i,c]=[t.get("sm"),t.get("sp"),t.get("sq"),t.get("sr"),t.get("ss"),t.get("sz"),t.get("start")];y(o)&&e.set("sm",o);y(a)&&e.set("sp",a);y(n)&&e.set("sq",n);y(r)&&e.set("sr",r);y(s)&&e.set("ss",s);y(i)&&e.set("sz",i);y(c)&&e.set("start",c)}(n.searchParams,r),n.searchParams.set("m",r.get("m")||r.get("model")||""),this.sdk.sendPrivateMessage("open link",{newWindow:e.policy===W.OpenPolicy.NEW_WINDOW,href:decodeURIComponent(n.href)})})),t.return()}}class SameOriginLinkPolicyExecutor{constructor(e,t){this.sdk=e,this.deepLinker=t}validateInput(e){if(!b(W.OpenPolicy,e.policy))throw Error(`${e.policy} is not a valid Link.OpenPolicy`);return{policy:e.policy}}exec(e,t,o){de(e.policy,this.deepLinker.LinkType.SAME_ORIGIN,this.deepLinker,this.sdk),t.return()}}class ExternalLinkPolicyExecutor{constructor(e,t){this.sdk=e,this.deepLinker=t}validateInput(e){const{openInNewWindow:t}=e;if(!ce(t))throw Error(`${e.openInNewWindow} is expected to strictly be a boolean to avoid confusion about truth-y and false-y values.`);return{openInNewWindow:t}}exec(e,t,o){e.openInNewWindow?this.deepLinker.handler.setPolicy(this.deepLinker.LinkType.EXTERNAL,this.deepLinker.handler.HandlingPolicy.NEW_WINDOW):this.deepLinker.handler.setPolicy(this.deepLinker.LinkType.EXTERNAL,this.deepLinker.handler.HandlingPolicy.CUSTOM,(e=>{this.sdk.sendPrivateMessage("open link",{href:e})})),t.return()}}function ue(e,t){const o=/\$\{([a-zA-Z]+)\}/,a=new URL(e);let n,r=decodeURI(a.pathname);for(;n=r.match(o);){const e=t.get(n[1]);r=r.replace(n[0],`${e}`)}for(a.pathname=r;n=a.search.match(o);){const e=t.get(n[1]);a.search=null!==e||""===e?a.search.replace(n[0],`${n[1]}=${e}`):a.search.replace(n[0],`${n[1]}`)}return a.href}function le(e,t){return!!Array.isArray(e)&&e.every(t)}class SetSharePolicyExecutor{constructor(e){this.deepLinks=e}validateInput(e){const{policy:t,baseHref:o}=e;if(!b(W.CreationPolicy,t))throw Error(`Link.setShareLinkPolicy: ${e.policy} is not a valid Link.ShareLinkPolicy`);if(!y(o))throw Error("Link.setShareLinkPolicy: Could not determine window.location");const a=ie(e.options)&&e.options.includeParams?e.options.includeParams:[];if(!le(a,y))throw Error("Link.setShareLinkPolicy: 'includeParams' expects an array of strings");return{policy:t,baseHref:this.validateBaseHref(t,o),options:{includeParams:a}}}validateBaseHref(e,t){const o=/^https:\/\/([a-z0-9\-]*\.)*(matterport\.com|matterportvr\.cn)$/,a=/^https:\/\/static\.(matterport\.com|matterportvr\.cn)$/;return{[W.CreationPolicy.MATTERPORT]:function(){if(window.location.origin.match(o)&&!window.location.origin.match(a))return window.location.href;const e=decodeURIComponent(new URLSearchParams(window.location.search.toLowerCase()).get("apihost")||"");return e.match(o)?e+"/show/":"https://my.matterport.com/show/"},[W.CreationPolicy.REFERRER]:function(){return t},[W.CreationPolicy.WINDOW]:function(){return window.location.href}}[e]()}exec(e,t,o){this.deepLinks.creator.setDefaultBaseHref(e.baseHref,e.options.includeParams),t.return()}}!function(e){e.HOVER="tag.hover",e.CLICK="tag.click",e.LINK_OPEN="tag.linkopen"}(oe||(oe={})),function(e){e.NONE="mattertag.media.none",e.PHOTO="mattertag.media.photo",e.VIDEO="mattertag.media.video",e.RICH="mattertag.media.rich"}(ae||(ae={})),function(e){e.NONE="tag.chunk.none",e.TEXT="tag.chunk.text",e.LINK="tag.chunk.link"}(ne||(ne={})),function(e){e.NAVIGATION="tag.link.nav",e.MODEL="tag.link.model",e.EXT_LINK="tag.link.ext"}(re||(re={}));class MediaConverter{constructor(e,t){this.toSdkMediaMap={[e.PHOTO]:ae.PHOTO,[e.VIDEO]:ae.VIDEO,[e.RICH]:ae.RICH},this.toSdkMediaFromChunk={[t.error]:ae.NONE,[t.link]:ae.NONE,[t.none]:ae.NONE,[t.photo]:ae.PHOTO,[t.rich]:ae.RICH,[t.text]:ae.NONE,[t.video]:ae.VIDEO}}toSdkMedia(e){return this.toSdkMediaMap[e]}fromTagChunkType(e){return this.toSdkMediaFromChunk[e]}}class ChunkTypeConverter{constructor(e){this.toSdkChunkTypeMap={[e.error]:ne.NONE,[e.link]:ne.LINK,[e.none]:ne.NONE,[e.photo]:ne.NONE,[e.rich]:ne.NONE,[e.text]:ne.TEXT,[e.video]:ne.NONE}}toSdkChunkType(e){return this.toSdkChunkTypeMap[e]}}class LinkTypeConverter{constructor(e){this.toSdkLinkTypeMap={[e.NAVIGATION]:re.NAVIGATION,[e.MODEL]:re.MODEL,[e.EXT_LINK]:re.EXT_LINK}}toSdkLinkType(e){return this.toSdkLinkTypeMap[e]}}function pe(e){return"number"==typeof e&&!isNaN(e)}function he(e){return e-0}function me(e,t,o){return Math.max(t,Math.min(e,o))}function ge(e,t,o){return t<=e&&e<=o}function fe(e){if(e&&"object"==typeof e&&"x"in e&&"y"in e&&"z"in e){const t=e;return pe(t.x)&&pe(t.y)&&pe(t.z)}return!1}function we(e){if(e&&"object"==typeof e&&"r"in e&&"g"in e&&"b"in e){const t=e;return pe(t.r)&&pe(t.g)&&pe(t.b)}return!1}function ye(e,t){return!!we(e)&&(!ge(e.r,0,1)&&t&&t.warn("The color provided should have an r value be in the range of [0, 1]"),!ge(e.g,0,1)&&t&&t.warn("The color provided should have an g value be in the range of [0, 1]"),!ge(e.b,0,1)&&t&&t.warn("The color provided should have an b value be in the range of [0, 1]"),(o=e).r=me(o.r,0,1),o.g=me(o.g,0,1),o.b=me(o.b,0,1),!0);var o}const Te=new Logger("mattertag-util");function Ie(e,t,o,a){const n=a.meshSubGroupsFromPoint(e);let r=1/0,s="";for(const t of o.rooms())if(n.includes(t.meshSubgroup)){const o=a.meshGroups.rooms.get(t.meshSubgroup),n=e.y-((null==o?void 0:o.boundingBox.min.y)||-1/0);n<r&&(r=n,s=t.floorId)}try{return t.getFloor(s).index}catch(e){return Te.debug("Unable to deduce floor index from position; defaulting to floor 0"),0}}const Ee=new Logger("mattertag.add");class BatchAddMattertagCommand extends Command_Command{constructor(e){super(),this.payload=e,this.id="BATCH_ADD_MATTERTAG"}}function Ce(e,t,o,a,n){const r={[ae.NONE]:o.TagDescriptionChunkType.none,[ae.PHOTO]:o.TagDescriptionChunkType.photo,[ae.VIDEO]:o.TagDescriptionChunkType.video,[ae.RICH]:o.TagDescriptionChunkType.rich};function s(e,a,n,s){if(!fe(e.anchorPosition))throw Error("anchorPosition is not a valid Vector3");if(!fe(e.stemVector))throw Error("stemVector is not a valid Vector3");const i=(new t.Vector3).copy(e.anchorPosition),c=(new t.Vector3).copy(e.stemVector),d=c.length();c.normalize();let u=void 0!==e.floorIndex?e.floorIndex:e.floorId;void 0===u&&(u=Ie(i,a,n,s));const l=a.getFloorAtIndex(u);if(!l)throw new Error(`Could not add Mattertag on invalid floor with index: ${u}`);const p=ye(e.color,Ee)?new t.Color(e.color.r,e.color.g,e.color.b):o.Color.MATTERTAG_BLUE,h=e.description,m=e.label,g=!e.hasOwnProperty("stemVisible")||e.stemVisible;let f;return e.media&&(f={mediaType:r[e.media.type]||o.TagDescriptionChunkType.none,mediaSrc:e.media.src||""}),new o.AddMattertagCommand({position:i,normal:c,floorId:l.id},{color:p,description:h,label:m,stemHeight:d,stemVisible:g,enabled:!0},f)}e.addCommandCreator({namespace:"Mattertag",name:"add",args:["tags"]},((e,t)=>{const o=Array.isArray(e.tags)?e.tags:[e.tags];return new BatchAddMattertagCommand({tagDescriptors:o,clientInfo:t})})),a.addBinding(BatchAddMattertagCommand,(async e=>{const[t,o,r,,i]=await n.getDependencies(),c=function(e,t,o,a){const n=[],r=e,i=r.length;n.length=i;for(let e=0;e<r.length;++e)try{n[e]=s(r[e],t,o,a)}catch(t){throw Error(`Error in tag ${e} - ${t.message}`)}return n}(e.tagDescriptors,t,o,r),d=[];d.length=c.length;for(let t=0;t<c.length;++t){const o=await a.issueCommand(c[t]);d[t]=o;const n=e.tagDescriptors[t];n.iconId&&i.exec({tagId:o,iconId:n.iconId},{return:()=>{},throw:e=>{throw Error(`There was an error updating the icon - "${e}"`)}},e.clientInfo)}return d}))}class GetMattertagDataCommand extends Command_Command{constructor(){super(...arguments),this.id="MATTERTAG_GET"}}function Se(e,t,o){function a(e){if(!e)return;return{label:e.label,type:o.toSdkLinkType(e.type),url:e.url,navigationData:e.navigationData}}const n=[];for(const o of e)n.push({type:t.toSdkChunkType(o.type),link:a(o.link),text:o.text});return n}class EditIcon{constructor(e,t,o,a,n){this.THREE=e,this.iconMap=o,this.mattertagMeshes=a,this.mattertagData=n}validateInput(e,t){const{iconId:o,tagId:a}=e;if(!y(o))throw Error(`iconId ${o} is not a valid string`);if(!y(a))throw Error(`tagId ${a} is not a valid string`);const n=this.iconMap.get(t.applicationKey);if(!n||!n.map[o]&&!n.imagePromise[o])throw Error(o+" has not been ied as valid icon id");if(!this.mattertagData.getTag(a))throw Error(a+" is not a valid tag id");return e}async exec(e,t,o){const{iconId:a,tagId:n}=e,r=this.iconMap.get(o.applicationKey);let s;try{s=await r.imagePromise[a]}catch(e){return void t.throw(e)}const i=r.map[a],c=s.naturalWidth/s.naturalHeight,d=new this.THREE.Vector3;c>1?d.set(c,1,1):d.set(1,1/c,1),this.mattertagMeshes.setOverrideMaterial(n,i,d),t.return()}}class ResetIcon{constructor(e,t,o,a,n){this.mattertagMeshes=a}validateInput(e){const{tagId:t}=e;if(!y(t))throw Error(`tagId ${t} is not a valid string`);return e}async exec(e,t,o){const{tagId:a}=e;this.mattertagMeshes.setOverrideMaterial(a,null,null),t.return()}}function ve(e){return"string"==typeof e}class TagIdInputException extends BaseException_BaseException{constructor(e){super("Expected tagId parameter to be of type string; got "+(Array.isArray(e)?"Array":typeof e))}}const be=new Logger("mattertag.edit");var De;!function(e){e.LABEL="label",e.DESCRIPTION="description",e.MEDIA="media"}(De||(De={}));class EditBillboardCommand extends Command_Command{constructor(e,t){super(),this.payload={tagId:e,properties:t}}}class EditColorCommand extends Command_Command{constructor(e,t){super(),this.payload={tagId:e,color:t}}}class EditStemCommand extends Command_Command{constructor(e,t){super(),this.payload=Object.assign({tagId:e},t)}}const Ae=new Logger("command.editOpacity");class EditOpacityExecutor{constructor(e,t){this.mattertagData=e,this.mattertagMesh=t}validateInput(e){const t=e.sid;if(!ve(t))throw new TagIdInputException(t);if(!this.mattertagData.getTag(t))throw Error(e.sid+" is not a valid Mattertag sid");if("number"!=typeof e.opacity||isNaN(e.opacity))throw Error(e.opacity+" is not a valid opacity value");let o=e.opacity;return(o<0||1<o)&&(Ae.warn(o,"is outside the valid range of [0, 1]"),o=F(o,0,1)),{sid:t,opacity:o}}exec(e,t,o){this.mattertagMesh.changeDiscOpacity(e.sid,e.opacity),t.return()}}function Oe(e,t,o){return(o=o||{}).x=e[t].x,o.y=e[t].y,o.z=e[t].z,o}function Me(e,t,o){return(o=o||{}).r=e[t].r,o.g=e[t].g,o.b=e[t].b,o}function Ne(e,t,o,a){a=a||{};try{const n=t.getFloor(e);a.id=o.getIdFromCwfId(n.id),a.sequence=n.index}catch(e){a.id="",a.sequence=-1}return a}class MattertagSubFactory{create(e,t){return t.onChanged((()=>e.onChanged()))}}class MattertagDataCollection{constructor(e,t,o,a){this.mattertagData=t,this.floorsData=o,this.floorIdMap=a,this._data={},this.mediaConverter=e.mediaConverter}get data(){return this._data}isItemEqual(e,t){return!l(this.data[t],e.data[t])}update(){for(const e of this.mattertagData.getTagList()){const t=this.mattertagData.getTag(e),o=this.floorsData.getFloor(t.floorId),a=this.data[t.sid]||{};a.sid=t.sid,a.enabled=t.enabled,a.anchorPosition=Oe(t,"anchorPosition",a.anchorPosition),a.stemVector=Oe(t,"stemVector",a.stemVector),a.stemVisible=t.stemVisible,a.label=t.label,a.description=t.description,a.media=this.getMedia(t,a.media),a.color=Me(t,"color",a.color),a.floorIndex=o?o.index:-1,a.floorInfo=a.floorInfo||{},a.floorInfo.id=this.floorIdMap.getIdFromCwfId(o.id),a.floorInfo.sequence=o.index,this.data[t.sid]=a}for(const e in this.data){this.mattertagData.getTag(e)||delete this.data[e]}}clear(){this._data={}}getMedia(e,t){const o=this.mediaConverter.toSdkMedia(e.mediaType);return(t=t||{}).src=e.mediaSrc,t.type=o||ae.NONE,t}}const Re={namespace:"Mattertag",name:"injectHTML",subRoutine:"mattertag.inject",args:["tagId","html","options"]};var xe,Pe,Fe,Le,ke,_e;!function(e){e.LOADED="inject.loaded",e.SETUP="inject.setup",e.RESOLVE="inject.resolve"}(xe||(xe={}));class IdGenerator{constructor(){this.usedIds=new Set,this.usedIds.add(0)}generate(){let e;do{e=Math.floor(1e6*Math.random())}while(this.usedIds.has(e));return this.usedIds.add(e),e}isInUse(e){return this.usedIds.has(e)}}Symbol.iterator;!function(e){e[e.POSTMESSAGE=1]="POSTMESSAGE"}(Pe||(Pe={}));class InjectionExecutor{constructor(e,t){this.mattertagData=e,this.iframeSrcDoc=t,this.idGenerator=new IdGenerator}validateInput(e){const t=e.tagId;if(!y(t))throw new TagIdInputException(t);if(!this.mattertagData.getTag(t))throw Error(e.tagId+" is not a valid tagId");if(!e.html||"string"!=typeof e.html)throw Error(e.html+" is not valid html");if(!pe(e.clientId))throw Error("Unexpected error: unable to create iframe");const o=e.options||{};let a="string"==typeof o.windowPath?o.windowPath:"";if(a&&a.split(".").filter((e=>"parent"!==e&&"opener"!==e)).length>0)throw Error(a+" is an unsupported window path");a.length>0&&"."!==a[0]&&(a="."+a);try{if(!Function("return window"+a)().postMessage)throw Error("invalid window")}catch(e){throw Error("problem finding a valid window with path: "+a)}const n={on:"on",off:"off",send:"send",tag:"tag"};o.globalVariableMap&&(y(o.globalVariableMap.on)&&(n.on=o.globalVariableMap.on),y(o.globalVariableMap.off)&&(n.off=o.globalVariableMap.off),y(o.globalVariableMap.send)&&(n.send=o.globalVariableMap.send),y(o.globalVariableMap.tag)&&(n.tag=o.globalVariableMap.tag));const r={w:0,h:0};if(o.size){const e=he(o.size.w+""),t=he(o.size.h+"");isNaN(e)||isNaN(t)||(r.w=e,r.h=t)}return{tagId:t,clientId:e.clientId,html:e.html,options:{size:r,windowPath:a,globalVariableMap:n}}}exec(e,t,o){const a=this.idGenerator.generate();const n=function(e){const t=document.createElement("iframe");return t.srcdoc=e,t.sandbox.add("allow-scripts"),t}(this.iframeSrcDoc);n.addEventListener("load",(function(){const o=n.contentWindow;t.return({messengerType:Pe.POSTMESSAGE,iframeId:a}),o.postMessage({type:xe.SETUP,id:a,targetId:e.clientId,customHTML:e.html,windowPath:e.options.windowPath,parentTag:e.tagId,globalVariableMap:e.options.globalVariableMap},"*")})),this.mattertagData.getTag(e.tagId).widgetFrame={size:{width:e.options.size.w,height:e.options.size.h},frame:new CustomFrame(n)},this.mattertagData.commit()}}class CustomFrame{constructor(e){this.iframe=e}mount(e){e.appendChild(this.iframe)}unmount(){this.iframe.parentNode&&this.iframe.parentNode.removeChild(this.iframe)}}class MattertagNavigateCommand extends Command_Command{constructor(e,t){super(),this.id="NAVIGATE_TO_MATTERTAG";const o=t;this.payload={sid:e,transition:o}}}class PreventActionExecutor{constructor(e){this.mattertagViewData=e}validateInput(e){const t=e.sid;if(!ve(t))throw new TagIdInputException(t);if(!this.mattertagViewData.mattertags.getTag(t))throw Error(e.sid+" is not a valid tag sid");const o={opening:!1,navigating:!1};if("object"==typeof e.prevent&&e.prevent){const t=e.prevent;o.opening=!!t.opening,o.navigating=!!t.navigating}return{sid:t,prevent:o}}exec(e,t,o){e.prevent.opening=!e.prevent.opening,e.prevent.navigating=!e.prevent.navigating,this.mattertagViewData.setTagCapabilities(e.sid,e.prevent),t.return()}}class BatchRemoveMattertagCommand extends Command_Command{constructor(e){super(),this.id="BATCH_REMOVE_MATTERTAG",this.payload={removeCommands:e}}}function Ve(e,t,o){const a=["",!1],n=e=>(a[0]=e.id,a[1]=e.hovering,a);o.subscribe(t.PinHoverChangeMessage,(o=>{o.pinType===t.PinType.MATTERTAG&&e.broadcast($.Event.HOVER,n,o)}));const r=[""],s=e=>(r[0]=e.id,r);o.subscribe(t.PinClickedMessage,(o=>{o.pinType===t.PinType.MATTERTAG&&e.broadcast($.Event.CLICK,s,o)}))}class MattertagOpenCommand extends Command_Command{constructor(e){super(),this.id="MATTERTAG_OPEN",this.payload={tag:e}}}class MattertagCloseCommand extends Command_Command{constructor(e){super(),this.id="MATTERTAG_CLOSE",this.payload={tag:e}}}class AdaptedAddMattertag{constructor(e,t,o,a){this.tagAdd=e,this.tagEditIcon=t,this.tagRegisterAttachment=o,this.tagAttach=a}validateInput(e,t){return{descriptors:this.tagAdd.executor.validateInput({descriptors:Array.isArray(e.descriptors)?e.descriptors:[e.descriptors]},t).descriptors}}async exec(e,t,o){const a=Array.isArray(e.descriptors)?e.descriptors:[e.descriptors],n=new Map;for(const e of a)if(e.media&&e.media.type!==$.MediaType.NONE){const[t]=await w(this.tagRegisterAttachment,{srcs:[e.media.src]},o);n.set(e.media.src,t)}const r=new AdaptedAddReturnObserver(t,[async e=>{for(let t=0;t<e.length;++t){const n=a[t];n.iconId&&await w(this.tagEditIcon,{id:e[t],iconId:n.iconId},o)}},async e=>{for(let t=0;t<e.length;++t){const r=a[t];if(r.media&&r.media.type!==$.MediaType.NONE){const a=n.get(r.media.src);a&&w(this.tagAttach,{tagId:e[t],attachmentIds:[a]},o)}}}]);this.tagAdd.executor.exec({descriptors:a},r,o)}}class AdaptedAddReturnObserver{constructor(e,t){this.returnObserver=e,this.beforeReturn=t}return(e){const t=this.beforeReturn.map((t=>t(e)));Promise.all(t).then((()=>this.returnObserver.return(e))).catch((e=>this.throw(e)))}throw(e){this.returnObserver.throw(e)}}class collection_data_MattertagSubFactory{create(e,t){return t.onChanged((()=>e.onChanged()))}}class collection_data_MattertagDataCollection{constructor(e,t,o,a){this.mattertagData=t,this.floorsData=o,this.floorIdMap=a,this._data={},this.mediaConverter=e.mediaConverter}get data(){return this._data}isItemEqual(e,t){return!l(this.data[t],e.data[t])}update(){for(const e of this.mattertagData.getTagList()){const t=this.mattertagData.getTag(e),o=this.floorsData.getFloor(t.floorId),a=this.data[t.sid]||{};a.sid=t.sid,a.enabled=t.enabled,a.anchorPosition=Oe(t,"anchorPosition",a.anchorPosition),a.stemVector=Oe(t,"stemVector",a.stemVector),a.stemVisible=t.stemVisible,a.label=t.label,a.description=t.description,a.media=this.getMedia(t,a.media),a.color=Me(t,"color",a.color),a.floorIndex=o?o.index:-1,a.floorInfo=a.floorInfo||{},a.floorInfo.id=this.floorIdMap.getIdFromCwfId(o.id),a.floorInfo.sequence=o.index,this._data[t.sid]=a}for(const e in this.data){this.mattertagData.getTag(e)||delete this._data[e]}}clear(){this._data={}}getMedia(e,t){const o=e.externalAttachments.get(0),a=o?this.mediaConverter.toSdkMedia(o.mediaType):$.MediaType.NONE,n=o&&a!==$.MediaType.NONE?o.src:"";return(t=t||{}).src=n,t.type=a,t}}!function(e){e.FILE_TOO_LARGE="oversize",e.EMPTY_FILE="empty",e.OVER_QUOTA="overQuota",e.UPLOAD_FAILED="failed",e.PERMISSION_DENIED="permission"}(Fe||(Fe={})),function(e){e.EMBED_FAIL="embedFail",e.EMBED_SUCCESS="success"}(Le||(Le={})),function(e){e.IMAGE="image",e.PDF="pdf",e.VIDEO="video",e.RICH="rich",e.ZIP="zip",e.TEXT="text",e.AUDIO="audio",e.MODEL="model",e.APPLICATION="application"}(ke||(ke={})),function(e){e.EXTERNAL="external",e.UPLOAD="upload",e.SANDBOX="sandbox"}(_e||(_e={}));class AdaptedEditBillboard{constructor(e,t,o){this.tagEditBillboard=t,this.tagRegisterAttachment=o,[this.mattertagData,this.attachmentRegistry]=e}validateInput(e,t){if(!ie(e.properties))throw Error("Mattertag.editBillboard: editable properties is not an object");const o=this.tagEditBillboard.executor.validateInput(e,t),a=e.properties.media;if(a){if(!ie(a)||!b($.MediaType,a.type))throw Error("Mattertag.editBillboard: media was not a valid media descriptor");if(a.type!==$.MediaType.NONE){if(!y(a.src))throw Error(`Mattertag.editBillboard: media was of type "${a.type}" but has no src value`);return{id:o.id,properties:Object.assign(Object.assign({},o.properties),{media:{src:a.src,type:a.type}})}}o.properties.media={src:"",type:$.MediaType.NONE}}return o}async exec(e,t,o){const a=this.mattertagData.getTag(e.id);if(e.properties.media&&e.properties.media.type===$.MediaType.NONE)return a.fileAttachments.replace([]),a.externalAttachments.replace([]),this.mattertagData.commit(),void t.return();const[n]=e.properties.media?await w(this.tagRegisterAttachment,{srcs:[e.properties.media.src]},o):[void 0],r=this.attachmentRegistry;const s=this.mattertagData;this.tagEditBillboard.executor.exec(e,{return(){if(e.properties.media){const e=function(e){if(e)return r.get(o.applicationKey,e)}(n);e?(a.fileAttachments.replace([]),a.externalAttachments.replace([]),a.sandboxAttachments.replace([]),e.category===_e.UPLOAD?a.fileAttachments.replace([e]):e.category===_e.EXTERNAL?a.externalAttachments.replace([e]):e.category===_e.SANDBOX&&a.sandboxAttachments.replace([e]),a.externalAttachments.replace([e])):a.externalAttachments.splice(0,1)}s.commit(),t.return()},throw(e){t.throw(e)}},o)}}function Ue(e,t,o){function a(e){if(!e)return;return{label:e.label,type:o.toSdkLinkType(e.type),url:e.url,navigationData:e.navigationData}}const n=[];for(const o of e)n.push({type:t.toSdkChunkType(o.type),link:a(o.link),text:o.text});return n}class GetDataExecutor{constructor(e,t,o,a){this.commands=e,this.tagData=t,this.floorData=o,this.floorIdMap=a}validateInput(e,t){return e}exec(e,t,o){const a=function(e,t,o,a){const n=[];return e.iterate((e=>{const{id:r,index:s}=t.getFloor(e.floorId),i=o.getIdFromCwfId(r),c=e.externalAttachments.get(0),d=c?a.mediaConverter.toSdkMedia(c.mediaType):$.MediaType.NONE,u=c&&d===$.MediaType.NONE?c.src:"";n.push({sid:e.sid,label:e.label,description:e.description,parsedDescription:Ue(e.parsedDescription,a.chunkTypeConverter,a.linkTypeConverter),mediaSrc:u,mediaType:d,media:{type:d,src:u},anchorPosition:{x:e.anchorPosition.x,y:e.anchorPosition.y,z:e.anchorPosition.z},anchorNormal:{x:e.anchorNormal.x,y:e.anchorNormal.y,z:e.anchorNormal.z},color:{r:e.color.r,g:e.color.g,b:e.color.b},enabled:e.enabled,floorId:s,floorIndex:s,floorInfo:{id:i,sequence:s},stemVector:{x:e.stemVector.x,y:e.stemVector.y,z:e.stemVector.z},stemHeight:e.stemHeight,stemVisible:e.stemVisible})})),n}(this.tagData,this.floorData,this.floorIdMap,this.commands);t.return(a)}}class OpenDeferred{constructor(){this.base=new Promise(((e,t)=>{this.resolver=e,this.rejecter=t})),this._promise=new OpenPromise(this.base,this),this.progressCallbacks=[]}then(e,t){return this.base.then(e,t)}catch(e){return this.base.catch(e)}resolve(e){return this.resolver(e),this}reject(e){return this.rejecter(e),this}notify(e){for(const t of this.progressCallbacks)t(e)}progress(e){return this.progressCallbacks.push(e),this}promise(){return this._promise}nativePromise(){return this.base}static resolve(){const e=new OpenDeferred;return e.resolve(),e.promise()}static reject(e){const t=new OpenDeferred;return t.reject(e),t.promise()}static all(e){const t=[];for(const o of e)o.nativePromise?t.push(o.nativePromise()):t.push(o);const o=new OpenDeferred;return Promise.all(t).then((e=>o.resolve(e)),(e=>o.reject(e))),o.promise()}}class OpenPromise{constructor(e,t){this.basePromise=e,this.baseDeferred=t}then(e,t){return this.baseDeferred.then(e,t),this}catch(e){return this.baseDeferred.catch(e),this}progress(e){return this.baseDeferred.progress(e),this}nativePromise(){return this.basePromise}}const Ge=new Logger("expiring-resource"),He=new WeakMap;class ExpiringResource{constructor(e,t){this.value=e,this.validUntil=t}refreshFrom(e){this.value=e.value,this.validUntil=e.validUntil;const t=He.get(this);t&&(t.resolve(),He.delete(this))}async get(){if(this.validUntil&&this.onStale){const e=Date.now();if(e+6e4+1e4>this.validUntil.getTime()){let t=He.get(this);t||(t=new OpenDeferred,He.set(this,t),this.onStale()),e+6e4+1e3>this.validUntil.getTime()&&(Ge.info("Stale resource, waiting for refresh"),await t.nativePromise(),Ge.info("Refreshed resource"))}}return this.value}getCurrentValue(){return this.value}}function Be(e=11){let t="";const o="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let a=0;a<e;a++)t+=o.charAt(Math.floor(Math.random()*o.length));return t}var ze,je,qe,We,$e,Ke,Xe,Ye,Ze,Qe,Je,et,tt,ot,at,nt,rt,st,it,ct,dt,ut,lt,pt,ht,mt,gt,ft,wt,yt,Tt,It,Et,Ct,St,vt,bt,Dt,At,Ot,Mt,Nt,Rt,xt,Pt,Ft,Lt,kt,_t,Vt,Ut,Gt,Ht,Bt,zt,jt,qt,Wt,$t,Kt,Xt,Yt,Zt,Qt,Jt,eo,to,oo,ao,no,ro;!function(e){e.EMPTY="empty",e.PARSED="parsed",e.RAW="raw",e.VERIFIED="verified"}(ze||(ze={})),function(e){e.FULL="full",e.NONE="none",e.PARTIAL="partial"}(je||(je={})),function(e){e.IMPRESSION="impression",e.MODELLOADED="modelLoaded"}(qe||(qe={})),function(e){e.LAST7DAYS="last7Days",e.LAST30DAYS="last30Days",e.LIFETIME="lifetime"}(We||(We={})),function(e){e.LZMA="lzma",e.NONE="none"}($e||($e={})),function(e){e.AVAILABLE="available",e.LOCKED="locked",e.UNAVAILABLE="unavailable"}(Ke||(Ke={})),function(e){e.EXTERNAL="external",e.UPLOAD="upload"}(Xe||(Xe={})),function(e){e.IMAGE="image",e.PDF="pdf",e.RICH="rich",e.VIDEO="video",e.ZIP="zip"}(Ye||(Ye={})),function(e){e.DELETED="deleted",e.PROVISIONED="provisioned",e.TRASHED="trashed"}(Ze||(Ze={})),function(e){e.LOCKED="locked",e.UNAVAILABLE="unavailable",e.UNLOCKED="unlocked"}(Qe||(Qe={})),function(e){e.COMPLETED="completed",e.FAILED="failed",e.INPROGRESS="inprogress",e.ORDERED="ordered",e.PLACED="placed",e.PREVIEWABLE="previewable"}(Je||(Je={})),function(e){e.DOLLHOUSE="dollhouse",e.FLOORPLAN="floorplan",e.OUTDOOR="outdoor",e.PANORAMA="panorama",e.TRANSITION="transition",e.UNKNOWN="unknown"}(et||(et={})),function(e){e.WALL="wall",e.WINDOW="window"}(tt||(tt={})),function(e){e.HANDHELD="handheld",e.OTHER="other",e.PRO="pro",e.SPHERICAL="spherical"}(ot||(ot={})),function(e){e.DUPLICATE="duplicate",e.FAIL="fail",e.REPLACE="replace",e.SKIP="skip"}(at||(at={})),function(e){e.CREATED="created",e.MODIFIED="modified"}(nt||(nt={})),function(e){e.FAST="fast",e.NORMAL="normal",e.URGENT="urgent"}(rt||(rt={})),function(e){e.KILOMETERS="kilometers",e.MILES="miles"}(st||(st={})),function(e){e.MATTERTAGS="Mattertags",e.NOTECOMMENTS="NoteComments",e.NOTES="Notes"}(it||(it={})),function(e){e.BLOCKED="blocked",e.DISABLED="disabled",e.GATED="gated",e.UNLOCKED="unlocked"}(ct||(ct={})),function(e){e.MAY="may",e.MUST="must",e.MUST_NOT="must_not"}(dt||(dt={})),function(e){e.ALPHA="alpha",e.COLORED_ROOMS="colored_rooms",e.MEASUREMENTS="measurements",e.PHOTOGRAMY="photogramy",e.SCHEMATIC="schematic"}(ut||(ut={})),function(e){e.REEL="reel",e.STORY="story"}(lt||(lt={})),function(e){e.COMPLETED="completed",e.CREATED="created",e.FAILED="failed",e.INPROGRESS="inprogress"}(pt||(pt={})),function(e){e.ANCHORLOCATION="AnchorLocation",e.HIGHLIGHTREEL="HighlightReel",e.LABEL="Label",e.MATTERTAG="Mattertag",e.MEASUREMENTPATH="MeasurementPath",e.MODELFLOOR="ModelFloor",e.MODELROOM="ModelRoom",e.NOTE="Note",e.OBJECTANNOTATION="ObjectAnnotation",e.ORDEREDLIST="OrderedList",e.PANORAMICIMAGELOCATION="PanoramicImageLocation",e.PHOTO="Photo"}(ht||(ht={})),function(e){e.SHOWCASE="showcase"}(mt||(mt={})),function(e){e.PHOTO="photo",e.RICH="rich",e.VIDEO="video"}(gt||(gt={})),function(e){e.LINETYPE_2D="linetype_2D",e.LINETYPE_3D="linetype_3D"}(ft||(ft={})),function(e){e.DISABLED="disabled",e.MEASURE="measure",e.MEASUREANDVIEW="measureAndView"}(wt||(wt={})),function(e){e.FLOORS="floors",e.HIGHLIGHTREEL="highlightReel",e.IMAGE="image",e.LABELS="labels",e.MATTERTAGS="mattertags",e.MEASUREMENTPATHS="measurementPaths",e.ORDEREDLISTS="orderedLists",e.PLAYEROPTIONS="playerOptions",e.SWEEPS="sweeps"}(yt||(yt={})),function(e){e.FULL="full",e.PUBLIC="public",e.VIEWER="viewer"}(Tt||(Tt={})),function(e){e.BLACK="black",e.GREY="grey",e.WHITE="white"}(It||(It={})),function(e){e.DEFAULT="default",e.MLS="mls",e.UNBRANDED="unbranded"}(Et||(Et={})),function(e){e.BUNDLE_COMPLETED="bundle_completed",e.BUNDLE_REQUESTED="bundle_requested",e.DELETED="deleted",e.INSERTED="inserted",e.PROCESSED="processed",e.REPLACED="replaced",e.UPDATED="updated",e.UPLOADED="uploaded"}(Ct||(Ct={})),function(e){e.ID="id",e.INTERNALID="internalId",e.MLSID="mlsId"}(St||(St={})),function(e){e.DEFAULT="default",e.VR="vr"}(vt||(vt={})),function(e){e.ADDRESS="address",e.CAMERA="camera",e.CAMERAMANUFACTURER="cameraManufacturer",e.CAMERAMODEL="cameraModel",e.EXTENSIONTAG="extensiontag",e.GEODISTANCE="geoDistance",e.GEOREGION="geoRegion",e.ID="id",e.NAME="name",e.STANDARD="standard",e.SUMMARY="summary"}(bt||(bt={})),function(e){e.CREATED="created",e.LAST7IMPRESSIONSEVENTCOUNT="last7ImpressionsEventCount",e.LAST7MODELSLOADEDEVENTCOUNT="last7ModelsLoadedEventCount",e.LAST7MODELSLOADEDUSERCOUNT="last7ModelsLoadedUserCount",e.LAST30IMPRESSIONSEVENTCOUNT="last30ImpressionsEventCount",e.LAST30MODELSLOADEDEVENTCOUNT="last30ModelsLoadedEventCount",e.LAST30MODELSLOADEDUSERCOUNT="last30ModelsLoadedUserCount",e.LIFETIMEIMPRESSIONSEVENTCOUNT="lifetimeImpressionsEventCount",e.LIFETIMEMODELSLOADEDEVENTCOUNT="lifetimeModelsLoadedEventCount",e.LIFETIMEMODELSLOADEDUSERCOUNT="lifetimeModelsLoadedUserCount",e.MODIFIED="modified",e.SCORE="score"}(Dt||(Dt={})),function(e){e.COPY="copy",e.EDITED="edited",e.ORIGINAL="original",e.UNKNOWN="unknown"}(At||(At={})),function(e){e.ACTIVATING="activating",e.ACTIVATION_PENDING="activation_pending",e.ACTIVE="active",e.FAILED="failed",e.INACTIVATING="inactivating",e.INACTIVATION_PENDING="inactivation_pending",e.INACTIVE="inactive",e.PROCESSING="processing",e.STAGING="staging"}(Ot||(Ot={})),function(e){e.ACTIVE="active",e.INACTIVE="inactive"}(Mt||(Mt={})),function(e){e.PRIVATE="private",e.PUBLIC="public"}(Nt||(Nt={})),function(e){e.SERIAL="serial"}(Rt||(Rt={})),function(e){e.AUTO="auto",e.LEFT="left",e.RIGHT="right"}(xt||(xt={})),function(e){e.AUTO="auto",e.MANUAL="manual",e.UNPLACED="unplaced"}(Pt||(Pt={})),function(e){e.UPLOAD="upload",e.VISION="vision"}(Ft||(Ft={})),function(e){e.CYLINDRICAL="cylindrical",e.EQUIRECTANGULAR="equirectangular",e.SKYBOX="skybox"}(Lt||(Lt={})),function(e){e.COMMENT="comment",e.MATTERTAG="mattertag"}(kt||(kt={})),function(e){e.SNAPSHOT="snapshot",e.TOUR="tour"}(_t||(_t={})),function(e){e.USER="user",e.VISION="vision"}(Vt||(Vt={})),function(e){e.ICON="icon",e.ORIGINAL="original",e.PRESENTATION="presentation",e.PREVIEW="preview",e.THUMBNAIL="thumbnail",e.WEB="web"}(Ut||(Ut={})),function(e){e.EQUIRECTANGULAR="equirectangular",e.PHOTO2D="photo2D"}(Gt||(Gt={})),function(e){e.AVAILABILITY="availability",e.FLAG="flag",e.QUOTA="quota",e.VALUE="value"}(Ht||(Ht={})),function(e){e.COMPLETE="complete",e.FAILED="failed",e.INPROGRESS="inprogress",e.STAGING="staging"}(Bt||(Bt={})),function(e){e.OPEN="open",e.RESOLVED="resolved"}(zt||(zt={})),function(e){e.ALIGNED="aligned",e.FAILED="failed",e.UNALIGNED="unaligned"}(jt||(jt={})),function(e){e.ANCHOR="anchor",e.ID="id",e.LOCATION="location"}(qt||(qt={})),function(e){e.FACE_BLURRING="face_blurring",e.FIDUCIAL_DETECTION="fiducial_detection",e.FIDUCIAL_REMOVAL="fiducial_removal"}(Wt||(Wt={})),function(e){e.DEMO="demo",e.DISCOVERABLE="discoverable",e.FLAGGED="flagged",e.INACTIVE="inactive"}($t||($t={})),function(e){e.DEFAULT="default",e.DISABLED="disabled",e.ENABLED="enabled"}(Kt||(Kt={})),function(e){e.ASC="asc",e.DESC="desc"}(Xt||(Xt={})),function(e){e.ACCEPTED="accepted",e.DISMISSED="dismissed",e.REJECTED="rejected",e.UNREVIEWED="unreviewed"}(Yt||(Yt={})),function(e){e.HIGH="high",e.LOW="low"}(Zt||(Zt={})),function(e){e.AFTERNOON="afternoon",e.DAWN="dawn",e.DUSK="dusk",e.MORNING="morning",e.NIGHT="night"}(Qt||(Qt={})),function(e){e.FADE_TO_BLACK="fade_to_black",e.INSTANT="instant",e.INTERPOLATE="interpolate"}(Jt||(Jt={})),function(e){e.IMPERIAL="imperial",e.METRIC="metric"}(eo||(eo={})),function(e){e.CREATED="created",e.EMAIL="email",e.FIRST_NAME="first_name",e.LAST_NAME="last_name",e.MODIFIED="modified"}(to||(to={})),function(e){e.DOLLHOUSE="dollhouse",e.FLOORPLAN="floorplan",e.MESH="mesh",e.PANORAMA="panorama"}(oo||(oo={})),function(e){e.BASIC="basic",e.NONE="none",e.TOKEN="token"}(ao||(ao={}));class executor_inject_InjectionExecutor{constructor(e,t){this.mattertagData=e,this.iframeSrcDoc=t,this.idGenerator=new IdGenerator,this.usedSids=new Set}validateInput(e){const t=e.tagId;if(!y(t))throw new TagIdInputException(t);if(!this.mattertagData.getTag(t))throw Error(e.tagId+" is not a valid tagId");if(!e.html||"string"!=typeof e.html)throw Error(e.html+" is not valid html");if(!pe(e.clientId))throw Error("Unexpected error: unable to create iframe");const o=e.options||{};let a="string"==typeof o.windowPath?o.windowPath:"";if(a&&a.split(".").filter((e=>"parent"!==e&&"opener"!==e)).length>0)throw Error(a+" is an unsupported window path");a.length>0&&"."!==a[0]&&(a="."+a);try{if(!Function("return window"+a)().postMessage)throw Error("invalid window")}catch(e){throw Error("problem finding a valid window with path: "+a)}const n={on:"on",off:"off",send:"send",tag:"tag"};o.globalVariableMap&&(y(o.globalVariableMap.on)&&(n.on=o.globalVariableMap.on),y(o.globalVariableMap.off)&&(n.off=o.globalVariableMap.off),y(o.globalVariableMap.send)&&(n.send=o.globalVariableMap.send),y(o.globalVariableMap.tag)&&(n.tag=o.globalVariableMap.tag));const r={w:0,h:0};if(o.size){const e=he(o.size.w+""),t=he(o.size.h+"");isNaN(e)||isNaN(t)||(r.w=e,r.h=t)}return{tagId:t,clientId:e.clientId,html:e.html,options:{size:r,windowPath:a,globalVariableMap:n}}}exec(e,t,o){const a=this.idGenerator.generate();const n=this.getUniqueSid();this.mattertagData.getTag(e.tagId).sandboxAttachments.push({id:n,src:"sandbox-"+n,srcDoc:this.iframeSrcDoc,onLoad:function(o){const n=o.contentWindow;t.return({messengerType:Pe.POSTMESSAGE,iframeId:a}),n.postMessage({type:xe.SETUP,id:a,targetId:e.clientId,customHTML:e.html,windowPath:e.options.windowPath,parentTag:e.tagId,globalVariableMap:e.options.globalVariableMap},"*")},category:_e.SANDBOX,created:new Date,mediaType:ke.RICH,parentType:kt.MATTERTAG,thumbnailUrl:new ExpiringResource("",null),url:new ExpiringResource("",null),height:0,width:0}),this.mattertagData.commit()}getUniqueSid(){const e=Be();return this.usedSids.has(e)?this.getUniqueSid():(this.usedSids.add(e),e)}}class AdaptedRemoveMattertag{constructor(e){this.tagRemove=e}validateInput(e,t){return{ids:this.tagRemove.executor.validateInput({ids:Array.isArray(e.ids)?e.ids:[e.ids]},t).ids}}exec(e,t,o){this.tagRemove.executor.exec({ids:Array.isArray(e.ids)?e.ids:[e.ids]},t,o)}}!function(e){e.NOTE="note",e.TAG="tag",e.OBJECT="object"}(no||(no={})),function(e){e[e.Instant=0]="Instant",e[e.FadeToBlack=1]="FadeToBlack",e[e.Interpolate=2]="Interpolate",e[e.MoveToBlack=3]="MoveToBlack"}(ro||(ro={}));const so={[$.Transition.FLY]:ro.Interpolate,[$.Transition.FADEOUT]:ro.FadeToBlack,[$.Transition.INSTANT]:ro.Instant};class AdaptedNavigateToMattertag{constructor(e,t,o,a){this.FocusOnPinInsideCommand=e,this.SelectAnnotationCommand=t,this.issueCommand=o,this.mattertagData=a}validateInput(e,t){if(!y(e.id)||!this.mattertagData.getTag(e.id))throw Error(`${e.id} does not map to a valid Tag`);if(void 0!==e.transitionType&&!b($.Transition,e.transitionType))throw Error(`${e.transitionType} does not match valid transition type`);return{id:e.id,transitionType:e.transitionType}}async exec(e,t,o){const a=this.mattertagData.getTag(e.id);let n=so[e.transitionType];void 0===n&&(n=ro.Interpolate),await this.issueCommand(new this.FocusOnPinInsideCommand({pinPosition:Object.assign(Object.assign({},a),{stemLength:a.stemHeight,stemNormal:a.stemVector}),transition:n})),await this.issueCommand(new this.SelectAnnotationCommand(e.id,no.TAG)),t.return(e.id)}}class PreventActionAdapater{constructor(e){this.tagAllowAction=e}validateInput(e,t){const o=this.tagAllowAction.executor.validateInput({id:e.tagId,allow:{}},t),a={navigating:!1,opening:!1};return ie(e.prevent)&&(a.navigating=!!e.prevent.navigating,a.opening=!!e.prevent.opening),{tagId:o.id,prevent:a}}exec(e,t,o){this.tagAllowAction.executor.exec({id:e.tagId,allow:{navigating:!e.prevent.navigating,opening:!e.prevent.opening}},t,o)}}function io(e,t,o,a,n,r){e.addEnumToInterface({namespace:"Mattertag",name:"DescriptionChunkType",values:$.DescriptionChunkType}),e.addEnumToInterface({namespace:"Mattertag",name:"Event",values:$.Event}),e.addEnumToInterface({namespace:"Mattertag",name:"LinkType",values:$.LinkType}),e.addEnumToInterface({namespace:"Mattertag",name:"MediaType",values:$.MediaType}),e.addEnumToInterface({namespace:"Mattertag",name:"Transition",values:$.Transition});const s=Object.assign(Object.assign({},o),{mediaConverter:new adapted_MediaConverter(t.MediaType)}),[i,c,d,u,l]=r;Ve(e,t,o),function(e,t,o,a){a.getDependencies().then((([a])=>{const n=["",""],r=e=>{var t;return n[0]=(null===(t=a.billboardAnnotation)||void 0===t?void 0:t.id)||"",n[1]=e.url,n};o.subscribe(t.MattertagLinkOpenedMessage,(t=>{e.broadcast($.Event.LINK_OPEN,r,t)}))}))}(e,t,o,new DependencyFetcher(c)),function(e,t){const o=SdkCommand.create(new DependencyFetcher(t.add,t.editIcon,t.registerAttachment,t.attach),new ClassFactory(AdaptedAddMattertag));e.addAsyncCommandToInterface({namespace:"Mattertag",name:"add",args:["descriptors"]},o)}(e,n),function(e,t,o){const a=SdkCollection.create(o,new collection_data_MattertagSubFactory,new ClassFactory(collection_data_MattertagDataCollection,t));e.addCollectionToInterface({namespace:"Mattertag",name:"data"},a)}(e,s,new DependencyFetcher(i,d,u)),function(e,t,o){const a=SdkCommand.create(new DependencyFetcher(o.getDependencies(),t.editBillboard,t.registerAttachment),new ClassFactory(AdaptedEditBillboard));e.addAsyncCommandToInterface({namespace:"Mattertag",name:"editBillboard",args:["id","properties"]},a)}(e,n,new DependencyFetcher(i,l)),function(e,t){e.addAsyncCommandToInterface({namespace:"Mattertag",name:"editColor",args:["id","color"]},t)}(e,n.editColor),function(e,t){e.addAsyncCommandToInterface({namespace:"Mattertag",name:"editIcon",args:["id","iconId"]},t)}(e,n.editIcon),function(e,t){e.addAsyncCommandToInterface({namespace:"Mattertag",name:"editOpacity",args:["id","opacity"]},t)}(e,n.editOpacity),function(e,t){e.addAsyncCommandToInterface({namespace:"Mattertag",name:"editPosition",args:["id","options"]},t)}(e,n.editPosition),function(e,t){e.addAsyncCommandToInterface({namespace:"Mattertag",name:"editStem",args:["id","stemParams"]},t)}(e,n.editStem),function(e,t,o){const a=SdkCommand.create(o,new ClassFactory(DeprecatedDecorator,new ClassFactory(GetDataExecutor),"`Mattertag.getData` is deprecated; subscribe to `Mattertag.data` instead",t));e.addAsyncCommandToInterface({namespace:"Mattertag",name:"getData",args:[]},a)}(e,s,new DependencyFetcher(i,d,u)),function(e,t){const o=SdkCommand.create(t,new ClassFactory(executor_inject_InjectionExecutor));e.addCommandToInterface(Object.assign({},Re),o)}(e,new DependencyFetcher(i,o.getIframeSrcDoc)),function(e,t,o,a){const n=SdkCommand.create(a,new ClassFactory(AdaptedNavigateToMattertag,t.FocusOnPinInsideCommand,t.SelectAnnotationCommand,o.issueCommand));e.addAsyncCommandToInterface({namespace:"Mattertag",name:"navigateToTag",args:["id","transitionType"]},n)}(e,t,o,new DependencyFetcher(i)),function(e,t){const o=SdkCommand.create(new DependencyFetcher(t),new ClassFactory(PreventActionAdapater));e.addAsyncCommandToInterface({namespace:"Mattertag",name:"preventAction",args:["tagId","prevent"]},o)}(e,n.allowAction),function(e,t){e.addAsyncCommandToInterface({namespace:"Mattertag",name:"registerIcon",args:["textureId","textureSrc"]},t)}(e,a.registerTexture),function(e,t){const o=SdkCommand.create(new DependencyFetcher(t),new ClassFactory(AdaptedRemoveMattertag));e.addAsyncCommandToInterface({namespace:"Mattertag",name:"remove",args:["ids"]},o)}(e,n.remove),function(e,t){e.addAsyncCommandToInterface({namespace:"Mattertag",name:"resetIcon",args:["id"]},t)}(e,n.resetIcon)}class adapted_MediaConverter{constructor(e){this.toSdkMediaMap={[e.IMAGE]:$.MediaType.PHOTO,[e.VIDEO]:$.MediaType.VIDEO,[e.RICH]:$.MediaType.RICH,[e.APPLICATION]:$.MediaType.NONE,[e.AUDIO]:$.MediaType.NONE,[e.MODEL]:$.MediaType.NONE,[e.PDF]:$.MediaType.NONE,[e.TEXT]:$.MediaType.NONE,[e.ZIP]:$.MediaType.NONE}}toSdkMedia(e){return this.toSdkMediaMap[e]}}class GetMeasurementsDataCommand extends Command_Command{constructor(){super(...arguments),this.id="MEASUREMENTS_GET"}}const co=async(e,t)=>{const o=[];for(const a of e.groups()){const e=a.info,n=t.getFloor(e.floorId);for(let t=1;t<a.count-1;t++){const r=a.get(t-1),s=a.get(t);o.push({sid:e.sid,label:e.text,floor:n.index,start:{x:r.x,y:r.y,z:r.z},end:{x:s.x,y:s.y,z:s.z}})}}return o};class MeasurementModeSubFactory{constructor(e){this.CwfMeasuringPhase=e}create(e,t){let o=t.groupCount,a=t.phase;const n=()=>{const n=t.groupCount,r=t.phase;o===n&&a!==this.CwfMeasuringPhase.EDITING||r!==this.CwfMeasuringPhase.IDLE||(e.onChanged(),o=n),a=r};return new AggregateSubscription(t.onPhaseChanged(n),t.onSelectedGroupIndexChanged(n))}}class MeasurementDataCollection{constructor(e){this.measurementModeData=e,this.data={}}update(){for(const e of this.measurementModeData.groups())this.createMeasurement(e);for(const e in this.data){this.measurementModeData.getGroupInfoBySid(e)||delete this.data[e]}}isItemEqual(e,t){return!l(this.data[t],e.data[t])}clear(){this.data={}}createMeasurement(e){const t=e.info.sid,o=this.data[t]||{},a=o.points||[];!function(e,t){let o=0;for(const a of t){const t=e[o]||{};t.x=a.x,t.y=a.y,t.z=a.z,e[o]=t,++o}e.length=o}(a,e),o.sid=t,o.points=a,this.data[t]=o}}class MeasurementPhaseSubFactory{create(e,t){return t.onChanged((()=>e.onChanged()))}}class MeasurementModeObservable{constructor(){this._data={active:!1}}get data(){return this._data}equals(e){return this._data.active===e.data.active}copy(e){this._data.active=e.data.active}update(e){this._data.active=e.modeActive()}}class ToggleMeasureModeCommand extends Command_Command{constructor(e){super(),this.id="SDK_MEASUREMENT_TOGGLE",this.payload={active:e}}}var uo;!function(e){e.CHANGE_START="viewmode.changestart",e.CHANGE_END="viewmode.changeend"}(uo||(uo={}));class ViewmodeActiveTransitionError extends BaseException_BaseException{constructor(e="Tried to start view-mode transition while another transition was active"){super(e),this.name="ViewmodeActiveTransition"}}const lo=new Logger("move-to-mode-command");class MoveToModeCommand extends Command_Command{constructor(e){super(),this.id="MOVE_TO_MODE",this.payload=e}}class MoveToModeValidation{constructor(e,t,o,a){this.THREE=e,this.CmdViewmode=t,this.conversion=o,this.transitionTypeConverter=a}validateMoveToModeInput(e){if(!e)throw Error("Mode.moveTo -> no arguments provided -- mode is required");e.options||(e.options={});const t=e.mode;if(!b(this.CmdViewmode,e.mode))throw Error(`Mode.moveTo -> ${e.mode} is not a valid viewmode`);if(t===this.CmdViewmode.TRANSITIONING)throw Error(`Mode.moveTo -> ${e.mode} is not a valid viewmode`);e.options&&e.options.rotation&&(e.options.rotation.z=e.options.rotation.z||0);const o=this.validatePayloadOptions(e.options);return{mode:t,options:{transition:o.transition,position:o.position,rotation:o.rotation,zoom:o.zoom}}}validatePayloadOptions(e){let t,o,a,n;if(e){if(e.transition&&(a=this.transitionTypeConverter.fromSdkTransition(e.transition),void 0===a))throw Error(`Mode.moveTo -> ${e.transition} is not a valid transition style`);e.rotation&&fe(e.rotation)&&(t=this.conversion.rotationToQuaternion(e.rotation)),e.position&&fe(e.position)&&(o=new this.THREE.Vector3(parseFloat(e.position.x),parseFloat(e.position.y),parseFloat(e.position.z))),e.zoom&&!isNaN(e.zoom)&&(n=F(e.zoom,1,30))}return{rotation:t,position:o,transition:a,zoom:n}}}class ViewmodeCurrentFactory{create(e,t,o){const a=()=>e.onChanged();return new AggregateSubscription(o.onChanged(a),t.onChanged(a))}}class ViewmodeCurrentObservableData{constructor(e,t){this._data=K.Mode.INSIDE,this.viewmodeConverter=t.viewmodeConverter}get data(){return this._data}equals(e){return this._data===e.data}copy(e){this._data=e.data}update(e,t){const o=t.currentSweep&&t.isSweepAligned(t.currentSweep);this._data=this.viewmodeConverter.toSdk(e.currentMode,!!o)}}class GetModelDataCommand extends Command_Command{constructor(){super(...arguments),this.id="GET_MODEL_DATA"}}function po(e,t,o){t.addBinding(GetModelDataCommand,(async()=>{const e=await o.getDependencies();return await async function(e,o,a,n){const r={sid:"",sweeps:[],modelSupportsVr:!1};try{const s=o.getSweepList(),i=e.model;return await t.makeModelData(i.sid,i.options.isVR,s,a,n,r),r}catch(e){throw Error("no model currently loaded")}}(...e)})),e.addCommandCreator({namespace:"Model",name:"getData",args:[]},(()=>new GetModelDataCommand))}class GetModelDetailsCommand extends Command_Command{constructor(){super(...arguments),this.id="GET_MODEL_DETAILS"}}function ho(e,t,o,a){a.getDependencies().then((e=>o.addBinding(GetModelDetailsCommand,(async()=>function(e,o){function a(e,t){if(o.tryGetProperty(e,!0))return t}const n=e.model;return{sid:n.sid,name:a(t.OptionsKey.DetailsModelName,n.details.name),presentedBy:a(t.OptionsKey.PresentedBy,n.details.presentedBy),summary:a(t.OptionsKey.DetailsSummary,n.details.summary),formattedAddress:a(t.OptionsKey.DetailsAddress,n.details.formattedAddress),contactEmail:a(t.OptionsKey.DetailsEmail,n.details.contact.email),contactName:a(t.OptionsKey.DetailsName,n.details.contact.name),phone:a(t.OptionsKey.DetailsPhone,n.details.contact.phone),formattedContactPhone:a(t.OptionsKey.DetailsPhone,n.details.contact.formattedPhone),externalUrl:a(t.OptionsKey.DetailsExternalUrl,n.details.externalUrl)}}(...e))))),e.addCommandCreator({namespace:"Model",name:"getDetails",args:[]},(()=>new GetModelDetailsCommand))}var mo;!function(e){e.MODEL_LOADED="model.loaded"}(mo||(mo={}));function go(e,t){return async function(o,a,n,r,s,i){i.sweeps=[];for(const o of n){const a=o.floorId?r.getFloor(o.floorId).index:-1;i.sweeps.push({uuid:s.getIdForSweep(o),sid:s.getIdForSweep(o),alignmentType:t.toSdkAlignment(o.alignmentType),placementType:t.toSdkPlacement(o.placementType),neighbors:await Promise.all(o.neighbours.map((async e=>await s.getIdFromCwfId(e)))),position:(c=o,null!==c.position?{x:c.position.x,y:c.position.y,z:c.position.z}:null),rotation:e.quaternionToRotation(o.rotation),floor:a})}var c;return i.sid=o,i.modelSupportsVr=a,i}}class UpdateTokenExecutor{constructor(e){this.tokenUpdater=e}validateInput(e){const{token:t}=e;if(!y(t))throw Error();return{token:t}}exec(e,t,o){this.tokenUpdater.setToken(e.token),t.return()}}var fo;!function(e){e.POSTMESSAGE="postmessage",e.DIRECT="direct",e.WEBSOCKET="websocket"}(fo||(fo={}));const wo=["dev-app.matterport.com","dev-app.matterportvr.cn","qa3-app.matterport.com","qa3-app.matterportvr.cn","my.matterport.com","my.matterportvr.cn","static.matterport.com","static.matterportvr.cn","matterport.github.io","localhost"],yo=new Logger("Plugin.load");class LoadExecutor{constructor(e,t){this.pluginRegistry=e,this.sesEnv=t}validateInput(e){if(!ie(e.key))throw Error(e.key+" is not a valid object");if(!T(e.key.applicationKey))throw Error(e.key.applicationKey+" is not a valid string");if(!T(e.path))throw Error(e.path+" is not a valid string");return e}async exec(e,t){const o=`${e.key.applicationKey}-${e.key.pluginId||"default"}`,a=await this.sesEnv.makeSecureEnvironment(o,e.path);if(a){const n=a.compartment.globalThis.plugin;if(n&&n.factory&&"function"==typeof n.factory){yo.debug("global",a.compartment);try{await this.pluginRegistry.load(e.key,n.factory,a.dispose,e.config)}catch(e){t.throw(e)}}else yo.warn(`Ignoring, globalThis.plugin did not contain a factory function for plugin ${o}`)}else yo.warn(`Ignoring, unable to create secure environment for plugin ${o}`);t.return()}}class UnloadExecutor{constructor(e){this.pluginRegistry=e}validateInput(e){if(!ie(e.key))throw Error(e.key+" is not a valid object");if(!T(e.key.applicationKey))throw Error(e.key+" is not a valid string");return e}async exec(e,t){this.pluginRegistry.unload(e.key),t.return()}}var To;!function(e){e.NONE="intersectedobject.none",e.MODEL="intersectedobject.model",e.TAG="intersectedobject.tag",e.SWEEP="intersectedobject.sweep",e.UNKNOWN="intersectedobject.unknown"}(To||(To={}));class PointerSubFactory{create(e,t){return t.onChanged((()=>e.onChanged()))}}class ObservablePointer{constructor(e,t){this.colliderTypes=t,this.ZERO=new e.Vector3(0,0,0),this.tempVec=new e.Vector3,this._data={position:{x:0,y:0,z:0},normal:{x:0,y:0,z:0},object:To.NONE,floorId:void 0,floorIndex:void 0}}get data(){return this._data}equals(e){const t=1e-5,o=e.data.position,a=this._data.position,n=e.data.normal,r=this._data.normal;return N(o,a,t)&&N(n,r,t)&&e.data.object===this._data.object}update(e,t,o,a,n){const r=e.hit;r?(A(this._data.position,r.point),A(this._data.normal,r.face.normal),this._data.floorId=void 0,r.object instanceof this.colliderTypes.ModelColliderTarget?(this._data.object=To.MODEL,this._data.floorId=function(e,t,o,a,n,r){let s;const i=n.floorIdFromObject(e.object);if(i)return s=t.getFloor(i),s.index;r.copy(e.point);const c=a.meshSubGroupsFromPoint(r);if(!c.length)return;const d=o.getByMeshSubgroup(c[0]);if(!d)return;return s=t.getFloor(d.floorId),s.index}(r,t,o,a,n,this.tempVec)):r.object instanceof this.colliderTypes.PinHeadMesh||r.object instanceof this.colliderTypes.InstancedPinHeads?this._data.object=To.TAG:r.object instanceof this.colliderTypes.PuckCollider?this._data.object=To.SWEEP:this._data.object=To.UNKNOWN):(A(this._data.position,this.ZERO),A(this._data.normal,this.ZERO),this._data.object=To.NONE,this._data.floorId=void 0),this._data.floorIndex=this._data.floorId}copy(e){A(this._data.position,e.data.position),A(this._data.normal,e.data.normal),this._data.object=e.data.object,this._data.floorId=e.data.floorId,this._data.floorIndex=e.data.floorIndex}}class EditTextureExecutor{constructor(e,t){this.cursorController=e,this.textureAaps=t}validateInput(e){if(!y(e.textureId))throw Error("textureId is not a valid string");return{textureId:e.textureId}}async exec(e,t,o){const{textureId:a}=e,n=this.textureAaps.get(o.applicationKey).map[a];this.cursorController.setTexture(n),t.return()}}class ResetTextureExecutor{constructor(e){this.cursorController=e}validateInput(e){return e}async exec(e,t,o){this.cursorController.setTexture(null),t.return()}}class SetFadePropsExecutor{constructor(e){this.cursorController=e}validateInput(e){(e=e||{}).props=e.props||{};const t=e.props;if(t.fadeIn){const e=t.fadeIn;if(e.duration&&(!pe(e.duration)||e.duration<=0))throw Error(`Pointer.setFadeProps: fadeIn.duration was specified but was not a valid duration; got ${e.duration}`)}if(t.fadeOut){const e=t.fadeOut;if(e.duration&&(!pe(e.duration)||e.duration<=0))throw Error(`Pointer.setFadeProps: fadeOut.duration was specified but was not a valid duration; got ${e.duration}`);if(e.delay&&(!pe(e.delay)||e.delay<=0))throw Error(`Pointer.setFadeProps: fadeOut.delay was specified but was not a valid delay; got ${e.delay}`)}return e}async exec(e,t,o){this.cursorController.setFadeProps(e.props),t.return()}}class SetVisibleExecutor{constructor(e){this.cursorController=e,this.visible=!0,this.ruleAdded=!1}isVisible(){return this.visible}validateInput(e){if(!ce(e.visible))throw Error(`Pointer.setVisible: visible was specified but was not a valid boolean; got ${e.visible}`);return e}async exec(e,t,o){this.ruleAdded||(this.isVisible=this.isVisible.bind(this),this.cursorController.addVisibilityRule(this.isVisible),this.ruleAdded=!0),this.visible=e.visible,t.return()}}class ScreenCapturer{constructor(e,t){this.captureCamera=e,this.encodeRenderTarget=t}async capture(e,t,o,a){const{camera:n,scene:r}=t.getScene();return n.getWorldPosition(this.captureCamera.position),n.getWorldQuaternion(this.captureCamera.quaternion),this.captureCamera.projectionMatrix.copy(n.projectionMatrix),this.captureCamera.layers.mask=e.visibleObjects.mask,a.setSize(e.resolution.width,e.resolution.height),o.render(a.target,r,this.captureCamera),await this.encodeRenderTarget(a)}}function Io(e){return pe(e)&&e%1==0}const Eo=new Logger("command.takeScreenshot");var Co;!function(e){e.Base64JPG="screenshot.base64.jpg",e.ArrayBufferJPG="screenshot.arraybuffer.jpg"}(Co||(Co={}));class ScreenshotExecutor{constructor(e,t,o,a,n,r){this.canvasData=a,this.rendererModule=n,this.renderToTexture=r,this.RenderLayers=t.RenderLayers,this.screenCapturer=e,this.requestTarget=o.requestTarget,this.getRenderLayer=o.getRenderLayer,this.jpegAsBase64=o.jpegAsBase64}validateInput(e){return{resolution:this.validateResolution(e.resolution,this.canvasData,this.rendererModule),visibleObjects:this.buildVisibilityOptions(e.visibleObjects),returnType:e.returnType===Co.ArrayBufferJPG?Co.ArrayBufferJPG:Co.Base64JPG}}async exec(e,t,o){const a=await this.requestTarget(),n=await this.screenCapturer.capture({resolution:e.resolution,visibleObjects:this.buildVisibilityLayers(e.visibleObjects)},this.rendererModule,this.renderToTexture,a);e.returnType===Co.ArrayBufferJPG&&t.return(n.buffer),t.return(this.jpegAsBase64(n))}validateResolution(e,t,o){const a={width:0,height:0};if(!e)return a.width=t.width,a.height=t.height,a;if(!function(e){const t=e;return!!t&&("number"==typeof t.width&&"number"==typeof t.height)}(e))throw Error('"resolution" provided was not valid. Expected .width and .height to be numbers.');a.width=e.width,a.height=e.height;const n=o.maxTextureSize;if(e.width<=0||e.width>n)throw Error('"resolution.width" provided was outside the valid range of [0, '+n+"]");if(e.height<=0||e.height>n)throw Error('"resolution.height" provided was outside the valid range of [0, '+n+"]");if(!Io(a.width)){const e=Math.round(a.width);Eo.info(`Integer width expected. Rounding from ${a.width} to ${e}`),a.width=e}if(!Io(a.height)){const e=Math.round(a.height);Eo.info(`Integer width expected. Rounding from ${a.height} to ${e}`),a.height=e}return a}buildVisibilityOptions(e){const t=e||{};return{measurements:!!t.measurements,mattertags:!!t.mattertags,sweeps:!!t.sweeps,views:!!t.views}}buildVisibilityLayers(e){const t=this.RenderLayers.ALL;return e.mattertags||t.removeLayers(this.getRenderLayer("pins")),e.measurements||t.removeLayers(this.getRenderLayer("measurements")),e.sweeps||t.removeLayers(this.getRenderLayer("sweep-pucks")),e.views||(t.removeLayers(this.getRenderLayer("sweep-portal-mesh")),t.removeLayers(this.getRenderLayer("sweep-pin-mesh"))),t}}class EquirectangularExecutor{constructor(e,t,o,a,n,r,s,i){this.renderer=a,this.renderToTexture=n,this.viewmodeData=r,this.sweepData=s,this.sweepTextureLoader=i,this.Viewmode=t.Viewmode,this.requestTarget=o.requestTarget,this.encodeRenderTarget=o.encodeRenderTarget,this.jpegAsBase64=o.jpegAsBase64,this.getXmp=o.getXmp,this.getOrientedAngleTo=o.getOrientedAngleTo,this.forward=new e.Vector3(0,0,-1),this.sweepForward=new e.Vector3,this.viewForward=new e.Vector3}validateInput(e){return e}async exec(e,t,o){if(!this.sweepData.currentSweep||this.viewmodeData.currentMode!==this.Viewmode.Panorama)throw new Error("Can only capture equirectangular projections while stationary in a sweep");const a=this.renderer.getScene().camera,n=this.sweepData.getSweep(this.sweepData.currentSweep),r=await this.sweepTextureLoader.load(n);this.sweepForward.copy(this.forward),this.sweepForward.copy(this.forward).applyQuaternion(n.rotation).setY(0);const s=this.getOrientedAngleTo(this.sweepForward,a.getWorldDirection(this.viewForward).setY(0))+Math.PI,i=await this.requestTarget();i.setSize(EquirectangularExecutor.equirectangularRes.width,EquirectangularExecutor.equirectangularRes.height),this.renderToTexture.renderEquirectangular(r,i.target,s);const c=await this.encodeRenderTarget(i,this.getXmp(i.width,i.height,0,0));t.return(this.jpegAsBase64(c))}}EquirectangularExecutor.equirectangularRes={width:4096,height:2048};class WorldToScreen{constructor(e,t){this.issueCommand=t.issueCommand,this.GetScreenPositionCommand=e.GetScreenPositionCommand}validateInput(e){if(!fe(e.worldPosition))throw Error(`Renderer.getScreenPosition: 'worldPosition' was specified but was not a valid Vector3; got ${e.worldPosition}`);return e}async exec(e,t,o){const a=await this.issueCommand(new this.GetScreenPositionCommand(e));t.return(a)}}class WorldPositionExecutor{constructor(e,t,o){this.floorsData=o,this.GetFloorIntersectCommand=e.GetFloorIntersectCommand,this.issueCommand=t.issueCommand}validateInput(e){if(!function(e){if(e&&"object"==typeof e&&"x"in e&&"y"in e){const t=e;return pe(t.x)&&pe(t.y)}return!1}(e.screenPosition))throw Error(`Renderer.getWorldPositionData: 'screenPosition' was not a valid Vector2; got ${e.screenPosition}`);return e}async exec(e,t,o){const a=await this.issueCommand(new this.GetFloorIntersectCommand(e)),n=this.floorsData.getFloorAtIndex(a.floorIndex);n?t.return({position:a.position,floorInfo:{id:n.id,sequence:n.index},floor:a.floorIndex}):t.return({position:a.position,floorInfo:{id:"",sequence:-1},floor:-1})}}class CurrentRoomSubFactory{constructor(){this.wasTransitioning360=!1,this.cameraPosition={x:0,y:0,z:0}}create(e,t,o,a,n){return new AggregateSubscription(a.onChanged((()=>this.throttleCameraPositionChanges(e,a))),n.onChanged((()=>this.throttleSweepChanges(e,n))))}throttleCameraPositionChanges(e,t){const o=t.pose.position;o.x===this.cameraPosition.x&&o.y===this.cameraPosition.y&&o.z===this.cameraPosition.z||(this.cameraPosition.x=o.x,this.cameraPosition.y=o.y,this.cameraPosition.z=o.z,e.onChanged())}throttleSweepChanges(e,t){const o=t.transition;t.transitionActive?(t.isSweepUnaligned(o.from)||t.isSweepUnaligned(o.to))&&(this.wasTransitioning360=!0):this.wasTransitioning360&&!t.isSweepUnaligned(t.currentSweep)&&(e.onChanged(),this.wasTransitioning360=!1)}}class CurrentRoomObservable{constructor(){this.currentRooms={rooms:[]}}get data(){return this.currentRooms}equals(e){return this.data.rooms.length===e.data.rooms.length&&this.currentRooms.rooms.every((t=>e.data.rooms.findIndex((e=>e.id===t.id))>-1))}copy(e){this.currentRooms.rooms.length=e.data.rooms.length,function(e,t){const o=t.length;e.length=o;for(let a=0;a<o;++a)e[a]=t[a]}(this.currentRooms.rooms,e.data.rooms)}update(e,t,o,a,n,r,s,i){if(n.isInside()&&a.isSweepUnaligned(a.currentSweep)||a.transitionActive&&(a.isSweepUnaligned(a.transition.to)||a.isSweepUnaligned(a.transition.from)))return void(this.currentRooms.rooms.length=0);const c=r.meshSubGroupsFromPoint(o.pose.position);this.currentRooms.rooms.length=c.length;for(let o=0;o<c.length;++o){const a=c[o],n=e.getByMeshSubgroup(a),d=r.meshGroups.rooms.get(a);if(!n||!d)continue;const u=this.currentRooms.rooms[o]||{};u.id=s.getIdFromCwfId(n.id),u.bounds=u.bounds||{},u.bounds.min=Oe(d.boundingBox,"min",u.bounds.min),u.bounds.max=Oe(d.boundingBox,"max",u.bounds.max),u.floorInfo=Ne(n.floorId,t,i,u.floorInfo),this.currentRooms.rooms[o]=u}}}class RoomSubFactory{create(e,t){return{renew(){},cancel(){}}}}class RoomCollectionData{constructor(e,t,o,a,n){this.roomData=e,this.floorData=t,this.roomIdMap=o,this.floorIdMap=a,this.meshData=n,this._data={}}get data(){return this._data}isItemEqual(e,t){const o=this.data[t],a=e.data[t];return o.id===a.id&&N(o.bounds.min,a.bounds.min)&&N(o.bounds.max,a.bounds.max)}update(){for(const e of this.roomData.rooms()){const t=this.meshData.meshGroups.rooms.get(e.meshSubgroup);if(!t)continue;const o=this.roomIdMap.getIdFromCwfId(e.id),a=this._data[o]||{};a.id=o,a.bounds=a.bounds||{},a.bounds.min=Oe(t.boundingBox,"min",a.bounds.min),a.bounds.max=Oe(t.boundingBox,"max",a.bounds.max),a.floorInfo=Ne(e.floorId,this.floorData,this.floorIdMap,a.floorInfo),this._data[o]=a}for(const e in this.data){this.roomIdMap.getRoomForId(e)||delete this._data[e]}}clear(){this._data={}}}new Logger("ScenePath");var So,vo,bo;!function(e){e.OUTPUT="output",e.INPUT="input",e.EVENT="event",e.EMIT="emit"}(So||(So={}));!function(e){e.CLICK="INTERACTION.CLICK",e.HOVER="INTERACTION.HOVER",e.DRAG="INTERACTION.DRAG",e.DRAG_BEGIN="INTERACTION.DRAG_BEGIN",e.DRAG_END="INTERACTION.DRAG_END",e.POINTER_MOVE="INTERACTION.POINTER_MOVE",e.POINTER_BUTTON="INTERACTION.POINTER_BUTTON",e.SCROLL="INTERACTION.SCROLL",e.KEY="INTERACTION.KEY",e.LONG_PRESS_START="INTERACTION.LONG_PRESS_START",e.LONG_PRESS_END="INTERACTION.LONG_PRESS_END",e.MULTI_SWIPE="INTERACTION.MULTI_SWIPE",e.MULTI_SWIPE_END="INTERACTION.MULTI_SWIPE_END",e.PINCH="INTERACTION.PINCH",e.PINCH_END="INTERACTION.PINCH_END",e.ROTATE="INTERACTION.ROTATE",e.ROTATE_END="INTERACTION.ROTATE_END"}(vo||(vo={}));class RegisterComponent{constructor(e){this.sceneModule=e}validateInput(e){if(!y(e.name))throw Error(`Scene.register name ${e.name} is not a string`);if(!e.factory||"function"!=typeof e.factory)throw Error("Scene.register factory is not a function");return e}async exec(e,t,o){this.sceneModule.registerFactory({scope:o.applicationKey,name:e.name},e.factory)?t.return({dispose:()=>{this.sceneModule.unregisterFactory(e.name,e.factory)}}):t.throw("There was an error registering the scene component")}}class CreateNode{constructor(e){this.sceneModule=e}validateInput(e){return e}async exec(e,t,o){const a=this.sceneModule.createNode(o.applicationKey).publicFacade();t.return(a)}}class QueryCommand extends Command_Command{constructor(e){super(),this.id="SCENE_QUERY",this.payload=e}}class ConfigureCommand extends Command_Command{constructor(e){super(),this.id="SCENE_CONFIGURE",this.payload=e}}class GetImageCommand extends Command_Command{constructor(e){super(),this.id="SCENE_GETIMAGE",this.payload=e}}class Deserialize{constructor(e){this.sceneModule=e}validateInput(e){return e}async exec(e,t,o){const a=this.sceneModule.deserialize(o.applicationKey,e.text);t.return(a)}}class Serialize{constructor(e){this.sceneModule=e}validateInput(e){return e}async exec(e,t,o){const a=this.sceneModule.serialize(e.objects);t.return(a)}}class CreateNodes{constructor(e){this.sceneModule=e}validateInput(e){if(!pe(e.count))throw Error("count is not a valid number");return e}async exec(e,t,o){const a=[];for(let t=0;t<e.count;t++)a.push(this.sceneModule.createNode(o.applicationKey).publicFacade());t.return(a)}}class RegisterComponents{constructor(e){this.sceneModule=e}validateInput(e){if(!le(e.components,ie))throw Error("Scene.registerComponents array elements must be objects");for(const t of e.components){if(!y(t.name))throw Error(`Scene.registerComponents name ${t.name} is not a string`);if(!t.factory||"function"!=typeof t.factory)throw Error("Scene.registerComponents factory is not a function")}return e}async exec(e,t,o){const a=[];for(const n of e.components){if(!this.sceneModule.registerFactory({scope:o.applicationKey,name:n.name},n.factory))return void t.throw("There was an error registering a scene component");{const e=this.sceneModule,t=function(t,o){return{dispose:function(){e.unregisterFactory(t,o)}}}(n.name,n.factory);a.push(t)}}t.return(a)}}class CreateObjects{constructor(e){this.sceneModule=e}validateInput(e){if(!pe(e.count))throw Error("count is not a valid number");return e}async exec(e,t,o){const a=[];for(let t=0;t<e.count;t++)a.push(this.sceneModule.createObject(o.applicationKey).publicFacade());t.return(a)}}class UnregisterComponentsExecutor{constructor(e){this.sceneModule=e}validateInput(e){if(e=e||{},!Array.isArray(e.components))throw Error("components must be an array");return e.components=e.components||[],e}async exec(e,t,o){for(const t of e.components)this.sceneModule.unregisterFactory(t.name,t.factory);t.return()}}class SensorShowDebugExecutor{constructor(e,t){this.sensorModule=e,this.sensorMap=t}validateInput(e){if(!y(e.sensorId)||!this.sensorMap.has(e.sensorId))throw Error("dev error: this should not occur unless the sdk was not setup properly");if(!ce(e.show))throw Error(`Sensor.showDebug: 'show' was not a boolean; got ${e.show}`);return{sensorId:e.sensorId,show:e.show}}exec(e,t,o){if(e.show){const t=this.sensorMap.get(e.sensorId);this.sensorModule.setDebugSensor(t)}else this.sensorModule.setDebugSensor(null);t.return()}}class SensorReadingCollection{constructor(e){this.sensor=e,this.sourceMap=new Map,this.reverseSourceLookup=new Map,this.sourceId=0,this._data={}}get data(){return this._data}isItemEqual(e,t){return e.data[t].inRange===this.data[t].inRange&&e.data[t].inView===this.data[t].inView}update(){for(const[e,t]of this.sensor.readings){const o=this.addOrGetSourceId(e),a=this._data[o]||{};a.inRange=t.inRange,a.inView=t.inView,a.distanceSquared=t.distanceSq,a.direction=Oe(t,"direction",a.direction),this._data[o]=a}for(const e in this.data){const t=this.reverseSourceLookup.get(e);t&&!this.sensor.readings.get(t)&&(this.sourceMap.delete(t),this.reverseSourceLookup.delete(e),delete this._data[e])}}clear(){this._data={}}addOrGetSourceId(e){const t=this.sourceMap.get(e);if(t)return t;const o="source-"+ ++this.sourceId;return this.sourceMap.set(e,o),this.reverseSourceLookup.set(o,e),o}}!function(e){e.CAMERA="sensor.sensortype.camera"}(bo||(bo={}));const Do={namespace:"Sensor",name:"createSensor",subRoutine:"sensor.create",args:[]};class SensorStateObservable{constructor(){this._data={origin:{x:0,y:0,z:0},forward:{x:0,y:0,z:-1}}}get data(){return this._data}equals(e){const t=1e-5;return N(this.data.origin,e.data.origin,t)&&N(this.data.forward,e.data.forward,t)}copy(e){A(this._data.origin,e.data.origin),A(this._data.forward,e.data.forward)}update(e){A(this._data.origin,e.frustum.origin),A(this._data.forward,e.frustum.forward)}}class CreateSensorExecutor{constructor(e,t,o,a,n){this.sdkModule=e,this.sensorFactories=t,this.sensors=o,this.sensorMap=a,this.removerMap=n}validateInput(e){if(!b(bo,e.type))throw Error(e.type+" is not a valid sensor type");return this.sensorFactories[e.type].validateInput(e)}async exec(e,t,o){const a=this.sensorFactories[e.type].create(e,this.sensors),n="sensor-"+ ++CreateSensorExecutor.nextSensorId;this.sensorMap.set(n,a);const r=SdkObservable.create(new DependencyFetcher(a),new SensorStateSubscriptionFactory,new ClassFactory(SensorStateObservable)),s=this.sdkModule.addObservable(n,r),i=SdkCollection.create(new DependencyFetcher(a),new SensorReadingSubscriptionFactory,new ClassFactory(SensorReadingCollection)),c=this.sdkModule.addCollection(n,i);this.removerMap.set(n,{dispose(){s.dispose(),c.dispose()}}),t.return({sensorId:n})}}CreateSensorExecutor.nextSensorId=0;class CameraSensorFactory{validateInput(e){return e}create(e,t){return t.createCameraBoundSensor()}}class SensorStateSubscriptionFactory{create(e,t){return t.frustum.observe(new DependencyObserverAdaptor(e))}}class SensorReadingSubscriptionFactory{create(e,t){return t.onReadingsUpdated(new DependencyObserverAdaptor(e))}}class DependencyObserverAdaptor{constructor(e){this.dependencyObserver=e}notify(){this.dependencyObserver.onChanged()}}class SensorAddSourceExecutor{constructor(e,t){this.sensorMap=e,this.sourceMap=t}validateInput(e){if(!y(e.sensorId)||!this.sensorMap.has(e.sensorId))throw Error("dev error: this should not occur unless the sdk was not setup properly");if(!le(e.sourceIds,y))throw Error("dev error: this should not occur unless the sdk was not setup properly");for(const t of e.sourceIds)if(!this.sourceMap.has(t))throw Error("dev error: this should not occur unless the sdk was not setup properly");return{sensorId:e.sensorId,sourceIds:e.sourceIds}}exec(e,t,o){const a=this.sensorMap.get(e.sensorId),n=e.sourceIds.map(this.sourceMap.get,this.sourceMap);a.addSource(...n),t.return()}}class DisposeSensorExecutor{constructor(e,t){this.sensorMap=e,this.removerMap=t}validateInput(e){if(!y(e.sensorId)||!this.sensorMap.has(e.sensorId))throw Error("dev error: this should not occur unless the sdk was not setup properly");return{sensorId:e.sensorId}}exec(e,t,o){this.removerMap.get(e.sensorId).dispose();this.sensorMap.get(e.sensorId).dispose(),t.return()}}const Ao={namespace:"Sensor",name:"createSource",subRoutine:"source.create",args:["type","options"]};var Oo;!function(e){e.SPHERE="sensor.sourcetype.sphere",e.BOX="sensor.sourcetype.box",e.CYLINDER="sensor.sourcetype.cylinder"}(Oo||(Oo={}));class SphereSource{constructor(e,t,o){this.radius=1/0,this.type=e.SPHERE,this._volume=t}get origin(){return this._volume.origin}get volume(){return this._volume}describeVolume(){return{origin:this._volume.origin,radius:this._volume.radius}}}const Mo=Math.PI/180;class BoxSource{constructor(e,t,o){this.type=e.BOX,this._volume=t,this.eulerCache=new o.Euler,this.quaternionCache=new o.Quaternion}get origin(){return this._volume.origin}get volume(){return this._volume}describeVolume(){return{center:this._volume.center,size:this._volume.size,orientation:this.convertQuaternionToOrientation(this._volume.orientation)}}updateOrientation(e){this.eulerCache.set(e.pitch*Mo,e.yaw*Mo,e.roll*Mo,"YXZ"),this.quaternionCache.setFromEuler(this.eulerCache),this._volume.updateOrientation(this.quaternionCache)}convertQuaternionToOrientation(e){return this.eulerCache.setFromQuaternion(this.quaternionCache.set(e.x,e.y,e.z,e.w)).reorder("YXZ"),{yaw:this.eulerCache.y*Mo,pitch:this.eulerCache.x*Mo,roll:this.eulerCache.z*Mo}}}class CylinderSource{constructor(e,t,o){this.type=e.CYLINDER,this._volume=t}get origin(){return this._volume.origin}get volume(){return this._volume}describeVolume(){return{basePoint:this._volume.basePoint,height:this._volume.height,radius:this._volume.radius}}}function No(e){if(e&&"object"==typeof e&&"yaw"in e&&"pitch"in e&&"roll"in e){const t=e;return pe(t.yaw)&&pe(t.pitch)&&pe(t.roll)}return!1}class CreateSourceExecutor{constructor(e,t){this.sourceFactories=e,this.sourceMap=t}validateInput(e){if(!b(Oo,e.type))throw Error(e.type+" is not a valid source type");return this.sourceFactories[e.type].validateInput(e)}exec(e,t,o){const a=this.sourceFactories[e.type].create(e),n="source-"+ ++CreateSourceExecutor.nextSourceId;this.sourceMap.set(n,a),t.return({sourceId:n,type:e.type,volume:a.describeVolume()})}}CreateSourceExecutor.nextSourceId=0;class SphereSourceFactory{constructor(e,t,o){this.sourceType=e,this.sphereVolumeFactory=t,this.THREE=o}validateInput(e){if(ie(e.options)){if(e.options.origin&&!fe(e.options.origin))throw Error(`Source.Box: 'origin' was specified but was not a valid Vector3; got ${e.options.origin}`);if(e.options.radius&&(!pe(e.options.radius)||e.options.radius<0))throw Error(`Source.Sphere: 'radius' was specified but was not a positive number or Infinity; got ${e.options.radius}`)}const t=e.options||{};return{type:e.type,options:{origin:t.origin||{x:0,y:0,z:0},radius:t.hasOwnProperty("radius")?t.radius:1/0}}}create(e){const t=new SphereSource(this.sourceType,new this.sphereVolumeFactory,this.THREE),o=t.volume;return o.updateOrigin(e.options.origin),o.updateRadius(e.options.radius),t}}class BoxSourceFactory{constructor(e,t,o){this.sourceType=e,this.boxVolumeFactory=t,this.THREE=o}validateInput(e){if(ie(e.options)){if(e.options.center&&!fe(e.options.center))throw Error(`Source.Box: 'center' was specified but was not a valid Vector3; got ${e.options.center}`);if(e.options.size&&(!fe(e.options.size)||e.options.size.x<0||e.options.size.y<0||e.options.size.z<0))throw Error(`Source.Box: 'size' was specified but was not a valid Vector3; got ${e.options.size}`);if(e.options.orientation&&!No(e.options.orientation))throw Error(`Source.Box: 'orientation' was specified but was not a valid Orientation; got ${e.options.orientation}`)}const t=e.options||{};return{type:e.type,options:{center:t.center||{x:0,y:0,z:0},size:t.size||{x:1/0,y:1/0,z:1/0},orientation:t.orientation||{yaw:0,pitch:0,roll:0}}}}create(e){const t=new BoxSource(this.sourceType,new this.boxVolumeFactory,this.THREE),o=t.volume;return o.updateCenter(e.options.center),o.updateDimensions(e.options.size),t.updateOrientation(e.options.orientation),t}}class CylinderSourceFactory{constructor(e,t,o){this.sourceType=e,this.cylinderVolumeFactory=t,this.THREE=o}validateInput(e){if(ie(e.options)){if(e.options.basePoint&&!fe(e.options.basePoint))throw Error(`Source.Cylinder: 'basePoint' was specified but was not a valid Vector3; got ${e.options.basePoint}`);if(e.options.hasOwnProperty("height")&&!(pe(e.options.height)&&e.options.height>0))throw Error(`Source.Cylinder: 'height' was specified but was not a positive number or Infinity; got ${e.options.height}`);if(e.options.hasOwnProperty("radius")&&!(pe(e.options.radius)&&e.options.radius>0))throw Error(`Source.Cylinder: 'radius' was specified but was not a positive number or Infinity; got ${e.options.radius}`)}const t=e.options||{};return{type:e.type,options:{basePoint:t.basePoint||{x:0,y:0,z:0},height:t.hasOwnProperty("height")?t.height:1/0,radius:t.hasOwnProperty("radius")?t.radius:1/0}}}create(e){const t=new CylinderSource(this.sourceType,new this.cylinderVolumeFactory,this.THREE),o=t.volume;return o.updateBasePoint(e.options.basePoint),o.updateHeight(e.options.height),o.updateRadius(e.options.radius),t}}class UpdateSourceExecutor{constructor(e,t){this.sourceUpdaters=e,this.sourceMap=t}validateInput(e){if(!y(e.sourceId)||!this.sourceMap.has(e.sourceId))throw Error("dev error: this should not occur unless the sdk was not setup properly");const t=this.sourceMap.get(e.sourceId);return this.sourceUpdaters[t.type].validateInput(e)}exec(e,t,o){const a=this.sourceMap.get(e.sourceId);this.sourceUpdaters[a.type].update(e,a),t.return()}}class SphereSourceUpdater{validateInput(e){if(!ie(e.options))throw Error("Source.Sphere.update: invalid options provided to .update");if(!fe(e.options.origin))throw Error(`Source.Sphere.update: 'origin' was specified but was not a valid Vector3; got ${e.options.origin}`);if(!pe(e.options.radius)||e.options.radius<0)throw Error(`Source.Sphere.update: 'radius' was specified but was not a positive number or Infinity; got ${e.options.radius}`);return e}update(e,t){const o=t.volume;o.updateOrigin(e.options.origin),o.updateRadius(e.options.radius),o.notify()}}class BoxSourceUpdater{validateInput(e){if(!ie(e.options))throw Error("Source.Box.update: invalid options provided to .update");if(e.options.center&&!fe(e.options.center))throw Error(`Source.Box.update: 'center' was specified but was not a valid Vector3; got ${e.options.center}`);if(e.options.size&&!(fe(e.options.size)&&e.options.size.x>=0&&e.options.size.y>=0&&e.options.size.z>=0))throw Error(`Source.Box.update: 'size' was specified but was not a valid Vector3; got ${JSON.stringify(e.options.size)} \n        ${"object"==typeof e}`);if(e.options.orientation&&!No(e.options.orientation))throw Error(`Source.Box.update: 'orientation' was specified but was not a valid Orientation; got ${e.options.orientation}`);return e}update(e,t){const o=t.volume;o.updateCenter(e.options.center),o.updateDimensions(e.options.size),t.updateOrientation(e.options.orientation),o.notify()}}class CylinderSourceUpdater{validateInput(e){if(!ie(e.options))throw Error("Source.Cylinder.update: invalid options provided to .update");if(e.options.basePoint&&!fe(e.options.basePoint))throw Error(`Source.Cylinder.update: 'basePoint' was specified but was not a valid Vector3; got ${e.options.basePoint}`);if(e.options.hasOwnProperty("height")&&!pe(e.options.height))throw Error(`Source.Cylinder.update: 'height' was specified but was not a positive number or Infinity; got ${e.options.height}`);if(e.options.hasOwnProperty("radius")&&!pe(e.options.radius))throw Error(`Source.Cylinder: 'radius' was specified but was not a positive number or Infinity; got ${e.options.radius}`);return e}update(e,t){const o=t.volume;o.updateBasePoint(e.options.basePoint),o.updateHeight(e.options.height),o.updateRadius(e.options.radius),o.notify()}}function Ro(e,t,o){const a=new Map,n=new Map;return function(r,s){!function(e,t,o,a){const n=new Map,r=SdkCommand.create(new DependencyFetcher(t,o),new ClassFactory(SensorAddSourceExecutor)),s=SdkCommand.create(new DependencyFetcher(t,n),new ClassFactory(DisposeSensorExecutor)),i=SdkCommand.create(DependencyFetcher.extend(a,t),new ClassFactory(SensorShowDebugExecutor));e.addCommand("Sensor.addSource",r),e.addCommand("sensor.dispose",s),e.addCommand("sensor.showDebug",i);const c={[bo.CAMERA]:new CameraSensorFactory},d=SdkCommand.create(DependencyFetcher.extend(a,t,n),new ClassFactory(CreateSensorExecutor,e,c));e.addCommandToInterface(Object.assign({},Do),d),e.addEnumToInterface({namespace:"Sensor",name:"SensorType",values:bo})}(r,a,n,s),function(e,t,o,a,n){const r=new DependencyFetcher(t),s={[a.SPHERE]:new SphereSourceUpdater,[a.BOX]:new BoxSourceUpdater,[a.CYLINDER]:new CylinderSourceUpdater},i=SdkCommand.create(r,new ClassFactory(UpdateSourceExecutor,s));e.addCommand("Sensor.updateSource",i);const c={[Oo.SPHERE]:new SphereSourceFactory(a,n.sphere,o),[Oo.BOX]:new BoxSourceFactory(a,n.box,o),[Oo.CYLINDER]:new CylinderSourceFactory(a,n.cylinder,o)},d=SdkCommand.create(r,new ClassFactory(CreateSourceExecutor,c));e.addCommandToInterface(Object.assign({},Ao),d),e.addEnumToInterface({namespace:"Sensor",name:"SourceType",values:Oo})}(r,n,e,t,o)}}var xo;!function(e){e.FPS="stat.fps"}(xo||(xo={}));class FpsCalculator{constructor(e,t){this.perfStatInterval=1e3,this.elapsedTime=0,this.frameCount=0,this.lastCalcTime=0,this.fps=[0],this.waitForUpdate=e,this.perfStatInterval=t.tryGetProperty("perfInterval",this.perfStatInterval)}async calcAndBroadcast(e){await this.waitForUpdate();const t=Date.now(),o=t-this.lastCalcTime;this.lastCalcTime=t,this.elapsedTime+=o,this.frameCount++,this.elapsedTime>=this.perfStatInterval&&(this.fps[0]=1e3*this.frameCount/this.elapsedTime,this.elapsedTime=0,this.frameCount=0,e.broadcast(xo.FPS,(()=>this.fps))),this.calcAndBroadcast(e)}}function Po(e,t="",o=""){let a="sdkStorage/";return t&&t.length>0&&(a=a+t+"/"),o&&o.length>0&&(a=a+o+"/"),a+e}class SetItemExecutor{constructor(e){this.modelData=e}validateInput(e){const t=null==e?void 0:e.key;if(!t||"string"!=typeof t)throw Error(t+" is not a valid key");return e}async exec(e,t){localStorage.setItem(Po(e.key,this.modelData.model.sid),JSON.stringify(e.data)),t.return()}}class GetItemExecutor{constructor(e){this.modelData=e}validateInput(e){const t=null==e?void 0:e.key;if(!t||"string"!=typeof t)throw Error(t+" is not a valid key");return{key:e.key}}async exec(e,t){const o=localStorage.getItem(Po(e.key,this.modelData.model.sid)),a=o?JSON.parse(o):null;return t.return(a),a}}class GetAllItemsExecutor{constructor(e){this.modelData=e}validateInput(e){let t=null==e?void 0:e.modelId;if(null==t)t=this.modelData.model.sid;else if("*"===t)t="";else if("string"!=typeof t)throw Error(t+" is not a valid key");return{modelId:t}}async exec(e,t){const o=Po("",e.modelId),a={};for(const[e,t]of Object.entries(localStorage))e.startsWith(o)&&(a[e.slice(o.length)]=JSON.parse(t));return t.return(a),a}}class RemoveItemExecutor{constructor(e){this.modelData=e}validateInput(e){const t=null==e?void 0:e.key;if(!t||"string"!=typeof t)throw Error(t+" is not a valid key");return{key:e.key}}async exec(e,t){localStorage.removeItem(Po(e.key,this.modelData.model.sid)),t.return()}}var Fo,Lo;!function(e){e.ALIGNED="aligned",e.UNALIGNED="unaligned"}(Fo||(Fo={})),function(e){e.UNPLACED="unplaced",e.AUTO="auto",e.MANUAL="manual"}(Lo||(Lo={}));class SweepPlacementConverter{constructor(e,t){this.toSdkAlignmentMap={[e.ALIGNED]:Fo.ALIGNED,[e.UNALIGNED]:Fo.UNALIGNED},this.toSdkPlacementMap={[t.UNPLACED]:Lo.UNPLACED,[t.AUTO]:Lo.AUTO,[t.MANUAL]:Lo.MANUAL}}toSdkAlignment(e){return this.toSdkAlignmentMap[e]}toSdkPlacement(e){return this.toSdkPlacementMap[e]}}const ko=Object.freeze({signedUrlDefaultExpireTime:24e4,signedUrlCheckInterval:1e4,signedUrlRefreshBuffer:15e3,visionTilingStartDate:new Date("8/26/2016"),visionTilingStartVersion:"1.1.407.13667",epsilon:1e-5,skyboxMeshGroup:"_group_skybox_",skysphereMeshGroup:"_group_skysphere_"});class CurrentSweepSubFactory{constructor(){this.currentSweep="",this.sweepTransitionActive=!1,this.currentMode=null,this.modeTransitionActive=!1}create(e,t,o){return new AggregateSubscription(t.onChanged((()=>this.throttleSweepDataChanges(e,t))),o.onChanged((()=>this.throttleViewmodeDataChanges(e,o))))}throttleSweepDataChanges(e,t){const o=t.currentSweep||"",a=t.transition.active&&t.transition.to!==t.transition.from;this.currentSweep===o&&this.sweepTransitionActive===a||(this.currentSweep=o,this.sweepTransitionActive=a,e.onChanged())}throttleViewmodeDataChanges(e,t){const o=t.currentMode,a=t.transition.active;this.currentMode===o&&this.modeTransitionActive===a||(this.currentMode=o,this.modeTransitionActive=a,e.onChanged())}}class CurrentSweepObservable{constructor(e,t){this.currentSweep=Object.assign(Object.assign({},CurrentSweepObservable.empty),{floorInfo:Object.assign({},CurrentSweepObservable.empty.floorInfo),neighbors:[],position:Object.assign({},CurrentSweepObservable.empty.position),rotation:Object.assign({},CurrentSweepObservable.empty.rotation)}),this.Viewmode=e.Viewmode,this.sweepPlacementConverter=t.sweepPlacementConverter}get data(){return this.currentSweep}equals(e){const t=ko.epsilon;return this.currentSweep.id===e.data.id&&this.currentSweep.enabled===e.data.enabled&&this.currentSweep.alignmentType===e.data.alignmentType&&this.currentSweep.placementType===e.data.placementType&&this.currentSweep.floorInfo.id===e.data.floorInfo.id&&this.currentSweep.floorInfo.sequence===e.data.floorInfo.sequence&&this.compareNeighbors(e.currentSweep)&&N(this.currentSweep.position,e.data.position,t)&&N(this.currentSweep.rotation,e.data.rotation,t)}copy(e){this.copySweep(e.data)}update(e,t,o,a,n){const r=e.currentSweepObject;if(!r||e.transition.active||t.transition.active||!t.isInside()&&t.currentMode!==this.Viewmode.Outdoor)return void this.copySweep(CurrentSweepObservable.empty);let s;try{s=o.getFloor(r.floorId||"")}catch(e){s={id:void 0,index:void 0}}const i=a.getIdForSweep(r);this.currentSweep.uuid=r.uuid,this.currentSweep.sid=i,this.currentSweep.id=i,this.currentSweep.enabled=r.enabled,this.currentSweep.alignmentType=this.sweepPlacementConverter.toSdkAlignment(r.alignmentType),this.currentSweep.placementType=this.sweepPlacementConverter.toSdkPlacement(r.placementType),this.currentSweep.neighbors=[...r.neighbours],A(this.currentSweep.position,r.position),A(this.currentSweep.rotation,r.rotation),this.currentSweep.alignmentType===Fo.UNALIGNED&&this.currentSweep.placementType===Lo.UNPLACED?(this.currentSweep.floorInfo.id=void 0,this.currentSweep.floorInfo.sequence=void 0):(this.currentSweep.floorInfo.id=s.id?n.getIdFromCwfId(s.id):s.id,this.currentSweep.floorInfo.sequence=s.index)}copySweep(e){this.currentSweep.uuid=e.uuid,this.currentSweep.sid=e.sid,this.currentSweep.id=e.id,this.currentSweep.enabled=e.enabled,this.currentSweep.alignmentType=e.alignmentType,this.currentSweep.placementType=e.placementType,this.currentSweep.floorInfo.id=e.floorInfo.id,this.currentSweep.floorInfo.sequence=e.floorInfo.sequence,this.currentSweep.neighbors=[...e.neighbors],A(this.currentSweep.position,e.position),A(this.currentSweep.rotation,e.rotation)}compareNeighbors(e){const t=this.currentSweep.neighbors.length;for(let o=0;o<t;++o)if(this.currentSweep.neighbors[o]!==e.neighbors[o])return!1;return t===e.neighbors.length}}var _o,Vo;CurrentSweepObservable.empty={uuid:"",sid:"",id:"",enabled:!1,alignmentType:Fo.ALIGNED,placementType:Lo.UNPLACED,floorInfo:{id:void 0,sequence:void 0},neighbors:[],position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0}},function(e){e.ENTER="sweep.enter",e.EXIT="sweep.exit"}(_o||(_o={}));class MoveToSweepExecutor{constructor(e,t,o,a){this.sweepData=o,this.sweepIdMap=a,this.NavigateToSweepCommand=e.NavigateToSweepCommand,this.issueCommand=t.issueCommand,this.cameraTransitionConverter=t.cameraTransitionConverter,this.conversion=t.conversionUtils}validateInputSweepId(e,t,o){if(!e||!y(e))throw Error(`Sweep.moveTo: 'sweep' was not a valid sweep id; got ${e}`);const a=o.getSweepForId(e);if(!a)throw Error(e+" does not map to a valid sweep in this model");return a.id}validateInputRotation(e){if(!e)return;const t=Error(`Sweep.moveTo: 'options.rotation' was specified but was not a valid Rotation; got ${e}`);if(e&&!ie(e))throw t;const o=e||{},a={x:he(o.x),y:he(o.y)};if(o.z&&(a.z=he(o.z)),!function(e){const t=e;return!!t&&!("object"!=typeof t||"z"in t&&!pe(t.z))&&pe(t.x)&&pe(t.y)}(a))throw t;return a}validateTransitionTime(e){if(!e)return;const t=Error(`Sweep.moveTo: options.transitionTime was specified but was not a valid, positive time; got ${e}`);if(!pe(e)&&!y(e))throw t;const o="number"==typeof e?e:he(e);if(!pe(o)||o<=0)throw t;return o}validateInput(e){const t=this.validateInputSweepId(e.sweep,this.sweepData,this.sweepIdMap),o=e.options||{},a=this.validateInputRotation(o.rotation),r=this.validateTransitionTime(o.transitionTime);if(o.transition&&!b(n,o.transition))throw Error(`Sweep.moveTo: options.transition was specified but was not a valid transition type; got ${o.transition}`);return{sweep:t,options:{rotation:a,transition:o.transition,transitionTime:r}}}async exec(e,t,o){const a=e.options.rotation?this.conversion.rotationToQuaternion(e.options.rotation):void 0,n=e.options.transition,r=e.options.transition?this.cameraTransitionConverter.fromSdkTransition(n):void 0,s=e.options.transitionTime,i=await this.issueCommand(new this.NavigateToSweepCommand({sweep:e.sweep,rotation:a,transition:r,transitionTime:s}));t.return(i)}}class SweepSubFactory{create(e,t){return t.onChanged((()=>e.onChanged()))}}class SweepDataCollection{constructor(e,t,o,a,n,r){this.sweepData=o,this.floorsData=a,this.sweepIdMap=n,this.floorIdMap=r,this._data={},this.conversionUtils=e,this.sweepPlacementConverter=t}get data(){return this._data}isItemEqual(e,t){return!l(this.data[t],e.data[t])}update(){for(const e of this.sweepData.sweeps()){const{id:t,index:o}=e.floorId?this.floorsData.getFloor(e.floorId):{id:"",index:-1},a=t?this.floorIdMap.getIdFromCwfId(t):void 0,n=this.sweepIdMap.getIdFromCwfId(e.id),r=this.data[n]||{};r.uuid=e.uuid,r.sid=n,r.id=n,r.enabled=e.enabled,r.alignmentType=this.sweepPlacementConverter.toSdkAlignment(e.alignmentType),r.neighbors=e.neighbours.map((e=>this.sweepIdMap.getIdFromCwfId(e))),r.position=Uo(e,r.position),r.rotation=this.conversionUtils.quaternionToRotation(e.rotation,r.rotation),r.floorInfo=a?{id:a,sequence:o}:{id:"",sequence:-1},this.data[r.id]=r}for(const e in this.data){this.sweepIdMap.getSweepForId(e)||delete this.data[e]}}clear(){this._data={}}}function Uo(e,t){return(t=t||{}).x=e.position.x,t.y=e.position.y,t.z=e.position.z,t}class EnableExecutor{constructor(e,t,o){this.sweepData=e,this.sweepViewData=t,this.sweepIdMap=o}validateInput(e){return{sweepIds:Go(e.sweepIds,this.sweepData,this.sweepIdMap)}}exec(e,t,o){for(const t of e.sweepIds)Ho(t,!0,this.sweepData,this.sweepViewData);t.return()}}class DisableExecutor{constructor(e,t,o){this.sweepData=e,this.sweepViewData=t,this.sweepIdMap=o}validateInput(e){return{sweepIds:Go(e.sweepIds,this.sweepData,this.sweepIdMap)}}exec(e,t,o){for(const t of e.sweepIds)Ho(t,!1,this.sweepData,this.sweepViewData);t.return()}}function Go(e,t,o){if(!Array.isArray(e))throw Error();return e.map((e=>function(e,t,o){if(!y(e))throw Error(e+" is not a valid string input");const a=o.getSweepForId(e);if(!a)throw Error(e+" does not map to a valid sweep in this model");return a.id}(e,0,o)))}function Ho(e,t,o,a){a.setVisible(e,t);const n=o.getSweep(e);n.enabled=t,n.commit()}class AttachmentSubFactory{create(e,t){return t.onChanged({notify(){e.onChanged()}})}}class AttachmentCollection{constructor(e){this.attachmentRegistry=e,this._data={}}get data(){return this._data}isItemEqual(e,t){return this.data[t].id===e.data[t].id&&this.data[t].src===e.data[t].src&&this.data[t].type===e.data[t].type}update(){for(const[,e]of this.attachmentRegistry.descriptors()){const t=this._data[e.id]||{};t.id=e.id,t.src=e.src,t.type=e.type,this._data[e.id]=t}for(const e in this.data){this.attachmentRegistry.has(e)||delete this._data[e]}}clear(){this._data={}}}class AttachAttachmentExecutor{constructor(e,t){this.mattertagData=e,this.attachmentRegistry=t,this.attachmentCounts=new Map}validateInput(e,t){y(e.tagId)||this.throw(f("tagId","string",e.tagId)),this.mattertagData.getTag(e.tagId)||this.throw(`${e.tagId} does not map to a valid tag`),le(e.attachmentIds,y)||this.throw(f("attachmentId","string or strings",e.tagId));for(const o of e.attachmentIds)this.attachmentRegistry.get(t.applicationKey,o)||this.throw(`${o} does not map to a valid attachment`);return{tagId:e.tagId,attachmentIds:e.attachmentIds}}async exec(e,t,o){for(const a of e.attachmentIds){const n=this.attachmentRegistry.get(o.applicationKey,a);if(!n)return void t.throw(`Tag.attach: ${a} does not map to a valid attachment`);const r=this.attachmentCounts.get(n)||0;this.attachmentCounts.set(n,r+1);const s=this.mattertagData.getTag(e.tagId);n.category===_e.UPLOAD?s.fileAttachments.push(n):n.category===_e.EXTERNAL?s.externalAttachments.push(n):n.category===_e.SANDBOX&&s.sandboxAttachments.push(Object.assign(Object.assign({},n),{src:n.src+`?id=${n.id}&parent=${e.tagId}&${r}`}))}this.mattertagData.commit(),t.return()}throw(e){throw Error("Tag.attach: "+e)}}class DetachAttachmentExecutor{constructor(e,t){this.mattertagData=e,this.attachmentRegistry=t}validateInput(e,t){y(e.tagId)||this.throw(f("tagId","string",e.tagId)),this.mattertagData.getTag(e.tagId)||this.throw(`${e.tagId} does not map to a valid tag`),le(e.attachmentIds,y)||this.throw(f("attachmentId","string or strings",e.tagId));for(const o of e.attachmentIds)this.attachmentRegistry.get(t.applicationKey,o)||this.throw(`${o} does not map to a valid attachment`);return{tagId:e.tagId,attachmentIds:e.attachmentIds}}async exec(e,t,o){for(const a of e.attachmentIds){const n=this.attachmentRegistry.get(o.applicationKey,a);if(!n)return void t.throw(`Tag.attach: ${a} does not map to a valid attachment`);const r=this.mattertagData.getTag(e.tagId);n.category===_e.UPLOAD?Bo(r.fileAttachments,n.id):n.category===_e.EXTERNAL?Bo(r.externalAttachments,n.id):n.category===_e.SANDBOX&&Bo(r.sandboxAttachments,n.id)}this.mattertagData.commit(),t.return()}throw(e){throw Error("Tag.detach: "+e)}}function Bo(e,t){const o=e.findIndex((e=>e.id===t));o>=0&&e.splice(o,1)}class RegisterAttachmentExecutor{constructor(e){this.attachmentRegistry=e,this.log=new Logger("tag.registerAttachment")}validateInput(e,t){const o=e.srcs;return le(o,T)||(le(o,this.validateDescriptor)&&this.log.warn("Using attachment descriptors is deprecated and will be removed when Early Access closes."),this.throw(f("descriptors","Array of AttachmentDescriptors or strings",o))),{srcs:o}}validateDescriptor(e,t){return ie(e)||this.throw(`descriptor #${t} is not an object`),y(e.src)||this.throw(`descriptor[${t}].src is not a string`),b(ee.AttachmentType,e.type)&&e.type!==ee.AttachmentType.UNKNOWN||this.throw(`descriptor[${t}].type is not a valid attachment type`),e.type===ee.AttachmentType.SANDBOX&&this.throw(`descriptor[${t}] has type ${ee.AttachmentType.SANDBOX} and should be registered using 'Tag.addSandbox' instead`),!0}async exec(e,t,o){const a=[];for(const t of e.srcs){const e="string"==typeof t?await this.attachmentRegistry.addBySrc(o.applicationKey,t):this.attachmentRegistry.add(o.applicationKey,t);a.push(e)}t.return(a)}throw(e){throw Error("Tag.registerAttachment: "+e)}}class TagSubFactory{create(e,t){return t.onChanged((()=>e.onChanged()))}}class TagDataCollection{constructor(e,t,o,a,n){this.THREE=e,this.mattertagData=t,this.roomIdMap=o,this.roomData=a,this.meshData=n,this._data={}}get data(){return this._data}isItemEqual(e,t){return!l(this.data[t],e.data[t])}update(){const e=e=>{const t=(new this.THREE.Vector3).set(e.x,e.y,e.z);for(const e of this.roomData.rooms()){const o=this.meshData.meshGroups.rooms.get(e.meshSubgroup);if(o&&o.boundingBox.containsPoint(t))return e}};for(const t of this.mattertagData.getTagList()){const o=this.mattertagData.getTag(t),a=this.data[o.sid]||{};if(a.id=o.sid,a.anchorPosition=Oe(o,"anchorPosition",a.anchorPosition),a.stemVector=Oe(o,"stemVector",a.stemVector),a.stemVisible=o.stemVisible,a.label=o.label,a.description=o.description,a.color=Me(o,"color",a.color),o.roomId)a.roomId=this.roomIdMap.getIdFromCwfId(o.roomId);else{const t=e(a.anchorPosition);t&&t.id&&(a.roomId=this.roomIdMap.getIdFromCwfId(t.id))}const n=o.fileAttachments.map((e=>e.id)),r=o.externalAttachments.map((e=>e.id)),s=o.sandboxAttachments.map((e=>e.id));a.attachments=[...n,...r,...s],this._data[o.sid]=a}for(const e in this.data){this.mattertagData.getTag(e)||delete this._data[e]}}clear(){this._data={}}}class TagAddExecutor{constructor(e,t,o,a,n,r,s){this.THREE=e,this.AddMattertagCommand=t.AddMattertagCommand,this.issueCommand=o.issueCommand,this.floorsData=n,this.roomData=r,this.meshData=s}validateInput(e,t){const{descriptors:o}=e;return le(o,((e,t)=>this.validateDescriptor(e,t)))||this.throw("descriptors is not an array"),{descriptors:o}}validateDescriptor(e,t){return ie(e)||this.throw(`descriptor #${t} is not an object`),fe(e.anchorPosition)||this.throw(`descriptor[${t}].anchorPosition is not vector`),fe(e.stemVector)||this.throw(`descriptor[${t}].stemVector is not vector`),void 0===e.stemVisible||ce(e.stemVisible)||this.throw(`descriptor[${t}].stemVisible is not a boolean`),void 0===e.label||T(e.label)||this.throw(`descriptor[${t}].label is not a string`),void 0===e.description||T(e.description)||this.throw(`descriptor[${t}].description is not a string`),void 0===e.attachments||le(e.attachments,T)||this.throw(`descriptor[${t}].attachments is not an array of strings`),void 0===e.color||we(e.color)||this.throw(`descriptor[${t}].color is not a Color`),!0}async exec(e,t,o){const a=[],n=new this.THREE.Vector3,r=new this.THREE.Vector3;for(const o of e.descriptors){n.set(o.anchorPosition.x,o.anchorPosition.y,o.anchorPosition.z),r.set(o.stemVector.x,o.stemVector.y,o.stemVector.z);const e=r.length();r.normalize();const s=Ie(n,this.floorsData,this.roomData,this.meshData),i=this.floorsData.getFloorAtIndex(s);if(!i)return void t.throw(`Could not add Mattertag on invalid floor with index: ${s}`);const c=await this.issueCommand(new this.AddMattertagCommand({position:n,normal:r,floorId:i.id},{label:o.label,description:o.description,stemVisible:o.stemVisible,stemHeight:e,color:o.color}));a.push(c)}t.return(a)}throw(e){throw Error("Tag.add: "+e)}}class AddSandboxExecutor{constructor(e,t,o){this.mattertagData=e,this.attachmentRegistry=t,this.registerSandbox=o}validateInput(e,t){const o=e.tagId;if(!y(o))throw new TagIdInputException(o);if(!this.mattertagData.getTag(o))throw Error(e.tagId+" is not a valid tagId");return Object.assign({tagId:o},this.registerSandbox.executor.validateInput(e,t))}exec(e,t,o){this.registerSandbox.executor.exec(e,{return:a=>{const n=this.attachmentRegistry.get(o.applicationKey,a.attachmentId);this.mattertagData.getTag(e.tagId).sandboxAttachments.push(n),this.mattertagData.commit(),t.return({iframeId:a.iframeId,messengerType:a.messengerType})},throw(e){t.throw(e)}},o)}}class RegisterSandboxExecutor{constructor(e,t){this.attachmentRegistry=e,this.iframeSrcDoc=t,this.idGenerator=new IdGenerator}validateInput(e){if(!e.html||"string"!=typeof e.html)throw Error(e.html+" is not valid html");if(!pe(e.clientId))throw Error("Unexpected error: unable to create iframe");const t=e.options||{},o={on:"on",off:"off",send:"send",tag:"tag"};return t.globalVariableMap&&(y(t.globalVariableMap.on)&&(o.on=t.globalVariableMap.on),y(t.globalVariableMap.off)&&(o.off=t.globalVariableMap.off),y(t.globalVariableMap.send)&&(o.send=t.globalVariableMap.send),y(t.globalVariableMap.tag)&&(o.tag=t.globalVariableMap.tag)),{clientId:e.clientId,html:e.html,options:{name:t.name||"",globalVariableMap:o}}}exec(e,t,o){const a=this.idGenerator.generate();const[n]=this.attachmentRegistry.addSandbox(o.applicationKey,{name:e.options.name,srcDoc:this.iframeSrcDoc,sandboxLoadedHandler:function(t,o){t.contentWindow.postMessage({type:xe.SETUP,id:a,targetId:e.clientId,customHTML:e.html,windowPath:"",parentTag:o,globalVariableMap:e.options.globalVariableMap},"*")}});t.return({messengerType:Pe.POSTMESSAGE,iframeId:a,attachmentId:n})}}class command_allowAction_PreventActionExecutor{constructor(e,t,o){this.pinViewData=e,this.tagsViewData=t,this.annoationsViewData=o}validateInput(e,t){const o=e.id;y(o)&&this.pinViewData.getPin(o)||this.throw(`${e.id} does not map to a valid tag`);const a={opening:!1,navigating:!1};return ie(e.allow)&&(a.opening=!!e.allow.opening,a.navigating=!!e.allow.navigating),{id:o,allow:a}}exec(e,t,o){const a=this.pinViewData.getPin(e.id);if(a){{const t={hover:!!e.allow.opening,click:!!e.allow.navigating};this.annoationsViewData.updateCapabilities(a.id,{dock:!0,preview:t.hover,select:t.click}),this.tagsViewData.updateCapabilities(a.id,{focus:!!e.allow.navigating})}t.return()}else t.throw(`Tag.allowAction: ${e.id} does not map to a valid tag`)}throw(e){throw Error("Tag.allowAction: "+e)}}class TagEditBillboardExecutor{constructor(e,t,o){this.mattertagData=o,this.EditMattertagCommand=e.EditMattertagCommand,this.issueCommand=t.issueCommand}validateInput(e,t){const{id:o}=e;return y(o)||this.throw(f("id","string",o)),this.mattertagData.getTag(o)||this.throw(`${o} does not map to a valid tag`),{id:o,properties:this.validateProperties(e.properties)}}validateProperties(e){ie(e)||this.throw("'properties' input is not an object");const{label:t,description:o}=e;return void 0===t||T(t)||this.throw(f("label","string (or undefined)",t)),void 0===o||T(o)||this.throw(f("description","string (or undefined)",o)),{label:t,description:o}}async exec(e,t,o){try{await this.issueCommand(new this.EditMattertagCommand(e.id,{label:e.properties.label,description:e.properties.description})),t.return()}catch(e){t.throw("Tag.editBillboard: "+e)}}throw(e){throw Error("Tag.editBillboard: "+e)}}class TagEditColorExecutor{constructor(e,t,o,a){this.THREE=e,this.EditMattertagCommand=t.EditMattertagCommand,this.issueCommand=o.issueCommand,this.mattertagData=a}validateInput(e,t){return y(e.id)||this.throw(f("id","string",e.id)),this.mattertagData.getTag(e.id)||this.throw(`${e.id} does not map to a valid tag`),we(e.color)||this.throw(f("color","Color",e.color)),{id:e.id,color:e.color}}async exec(e,t,o){try{const t=(new this.THREE.Color).setRGB(e.color.r,e.color.g,e.color.b);await this.issueCommand(new this.EditMattertagCommand(e.id,{color:t}))}catch(e){t.throw(e)}t.return()}throw(e){throw Error("Tag.editColor: "+e)}}class TagEditIconExecutor{constructor(e,t,o,a){this.THREE=e,this.mattertagData=t,this.mattertagMeshes=o,this.iconMaps=a}validateInput(e,t){return y(e.id)||this.throw(f("id","string",e.id)),this.mattertagData.getTag(e.id)||this.throw(`${e.id} does not map to a valid tag`),y(e.iconId)||this.throw(f("iconId","string",e.iconId)),{id:e.id,iconId:e.iconId}}async exec(e,t,o){const{id:a,iconId:n}=e,r=this.iconMaps.get(o.applicationKey);let s;try{s=await r.imagePromise[n]}catch(e){return void t.throw(e)}const i=r.map[n],c=s.naturalWidth/s.naturalHeight,d=new this.THREE.Vector3;c>1?d.set(c,1,1):d.set(1,1/c,1),this.mattertagMeshes.setOverrideMaterial(a,i,d),t.return()}throw(e){throw Error("Tag.editIcon: "+e)}}class EditStemExecutor{constructor(e,t,o){this.cwfTypes=e,this.mattertagData=o,this.issueCommand=t.issueCommand}validateInput(e,t){T(e.id)&&this.mattertagData.getTag(e.id)||this.throw(`${e.id} does not map to a valid tag`),e.stemParams&&ie(e.stemParams)||this.throw("invalid stem parameters objeect");const{stemHeight:o,stemVisible:a}=e.stemParams;return void 0===o||pe(o)||this.throw(f("stemHeight","number",e.id)),void 0===a||ce(a)||this.throw(f("stemVisibility","boolean",e.id)),{id:e.id,stemParams:{stemHeight:o,stemVisible:a}}}async exec(e,t){const{stemHeight:o,stemVisible:a}=e.stemParams,n={};void 0!==o&&(n.stemHeight=o),void 0!==a&&(n.stemVisible=a),await this.issueCommand(new this.cwfTypes.EditMattertagCommand(e.id,n)),t.return()}throw(e){throw Error("Tag.editStem: "+e)}}class command_editOpacity_EditOpacityExecutor{constructor(e,t,o){this.ChangePinOpacityCommand=e.ChangePinOpacityCommand,this.PinType=e.PinType,this.issueCommand=t.issueCommand,this.mattertagData=o}validateInput(e,t){return y(e.id)||this.throw(f("id","string",e.id)),this.mattertagData.getTag(e.id)||this.throw(`${e.id} does not map to a valid tag`),(!pe(e.opacity)||e.opacity<0||e.opacity>1)&&this.throw("'opacity' should be a number in the range of [0, 1]"),{id:e.id,opacity:e.opacity}}async exec(e,t,o){try{await this.issueCommand(new this.ChangePinOpacityCommand(e.id,this.PinType.MATTERTAG,e.opacity))}catch(e){t.throw(e)}t.return()}throw(e){throw Error("Tag.editOpacity: "+e)}}class TagEditPositionExecutor{constructor(e,t,o,a){this.mattertagData=o,this.roomIdMap=a,this.cwfTypes=e,this.issueCommand=t.issueCommand}validateInput(e){return y(e.id)&&this.mattertagData.getTag(e.id)||this.throw(`${e.id} does not map to a valid tag`),{id:e.id,options:this.validateOptions(e.options)}}validateOptions(e){return e&&ie(e)||this.throw("invalid options provided"),{anchorPosition:this.validateVector3(e.anchorPosition,"`anchorPosition` was provided but not a valid Vector3"),stemVector:this.validateVector3(e.stemVector,"`stemVector` was provided, but not a valid Vector3"),roomId:this.validateRoomId(e.roomId)}}validateVector3(e,t){return void 0===e||fe(e)||this.throw(t),e}validateRoomId(e){return void 0===e||y(e)||this.throw(f("roomId","string (or undefined)",e)),e&&!this.roomIdMap.getRoomForId(e)&&this.throw(`${e} does not map to a valid room`),e}async exec(e,t){const{anchorPosition:o,stemVector:a}=e.options,n=this.mattertagData.getTag(e.id),r=e.options.roomId&&this.roomIdMap.getRoomForId(e.options.roomId),s=r?r.floorId:n.floorId,i=o?n.anchorPosition.clone().set(o.x,o.y,o.z):n.anchorPosition,c=a?n.stemVector.clone().set(a.x,a.y,a.z):n.stemVector,d=a?c.length():n.stemHeight;c.normalize();const u={stemHeight:d},l={position:i,normal:c,floorId:s};await this.issueCommand(new this.cwfTypes.EditMattertagCommand(e.id,u,void 0,l)),t.return()}throw(e){throw Error("Tag.editPosition: "+e)}}class TagRemoveExecutor{constructor(e,t){this.cwfTypes=e,this.issueCommand=t.issueCommand}validateInput(e){const t=e.ids;return le(t,y)||this.throw("'ids' is expected to be a series of strings"),{ids:t}}async exec(e,t){const o=[];for(const t of e.ids)await this.issueCommand(new this.cwfTypes.CloseAnnotationCommand(t,no.TAG)),await this.issueCommand(new this.cwfTypes.RemoveMattertagCommand(t)),o.push(t);t.return(o)}throw(e){throw Error("Tag.remove: "+e)}}class TagResetIconExecutor{constructor(e,t){this.mattertagData=e,this.mattertagMeshes=t}validateInput(e,t){return y(e.id)||this.throw(f("id","string",e.id)),this.mattertagData.getTag(e.id)||this.throw(`${e.id} does not map to a valid tag`),{id:e.id}}exec(e,t,o){const{id:a}=e;this.mattertagMeshes.setOverrideMaterial(a,null,null),t.return()}throw(e){throw Error(`Tag.resetIcon: ${e}`)}}function zo(e,t,o,a,n,r,s,i){const{mattertagData:c,mattertagMeshModule:d,meshData:u,floorData:l,pinViewData:p,annotationsViewData:h,tagsViewData:m,roomData:g,roomIdMap:f}=i;e.addEnumToInterface({namespace:"Tag",name:"AttachmentType",values:ee.AttachmentType});const w=function(e,t){const o=SdkCollection.create(t,new AttachmentSubFactory,new ClassFactory(AttachmentCollection));return e.addCollectionToInterface({namespace:"Tag",name:"attachments"},o),o}(e,new DependencyFetcher(r)),y=function(e,t){const o=SdkCommand.create(t,new ClassFactory(RegisterAttachmentExecutor));return e.addAsyncCommandToInterface({namespace:"Tag",name:"registerAttachment",args:["srcs"],varArg:!0},o),o}(e,new DependencyFetcher(r)),T=function(e,t){const o=SdkCommand.create(t,new ClassFactory(AttachAttachmentExecutor));return e.addAsyncCommandToInterface({namespace:"Tag",name:"attach",args:["tagId","attachmentIds"],varArg:!0},o),o}(e,new DependencyFetcher(c,r)),I=function(e,t){const o=SdkCommand.create(t,new ClassFactory(DetachAttachmentExecutor));return e.addAsyncCommandToInterface({namespace:"Tag",name:"detach",args:["tagId","attachmentIds"],varArg:!0},o),o}(e,new DependencyFetcher(c,r)),E=function(e,t,o){const a=SdkCollection.create(o,new TagSubFactory,new ClassFactory(TagDataCollection,t));return e.addCollectionToInterface({namespace:"Tag",name:"data"},a),a}(e,t,new DependencyFetcher(c,f,g,u)),C=function(e,t,o,a,n){const r=SdkCommand.create(n,new ClassFactory(TagAddExecutor,t,o,a));return e.addAsyncCommandToInterface({namespace:"Tag",name:"add",args:["descriptors"],varArg:!0},r),r}(e,t,o,a,new DependencyFetcher(c,l,g,u)),S=function(e,t){const o=SdkCommand.create(t,new ClassFactory(command_allowAction_PreventActionExecutor));return e.addAsyncCommandToInterface({namespace:"Tag",name:"allowAction",args:["id","allow"]},o),o}(e,new DependencyFetcher(p,m,h)),v=function(e,t,o,a){const n=SdkCommand.create(a,new ClassFactory(TagEditBillboardExecutor,t,o));return e.addAsyncCommandToInterface({namespace:"Tag",name:"editBillboard",args:["id","properties"]},n),n}(e,o,a,new DependencyFetcher(c)),b=function(e,t,o,a,n){const r=SdkCommand.create(n,new ClassFactory(TagEditColorExecutor,t,o,a));return e.addAsyncCommandToInterface({namespace:"Tag",name:"editColor",args:["id","color"]},r),r}(e,t,o,a,new DependencyFetcher(c)),D=function(e,t,o){const a=SdkCommand.create(o,new ClassFactory(TagEditIconExecutor,t));return e.addAsyncCommandToInterface({namespace:"Tag",name:"editIcon",args:["id","iconId"]},a),a}(e,t,new DependencyFetcher(c,d,n)),A=function(e,t,o,a){const n=SdkCommand.create(a,new ClassFactory(command_editOpacity_EditOpacityExecutor,t,o));return e.addAsyncCommandToInterface({namespace:"Tag",name:"editOpacity",args:["id","opacity"]},n),n}(e,o,a,new DependencyFetcher(c)),O=function(e,t,o,a){const n=SdkCommand.create(a,new ClassFactory(EditStemExecutor,t,o));return e.addAsyncCommandToInterface({namespace:"Tag",name:"editStem",args:["id","stemParams"]},n),n}(e,o,a,new DependencyFetcher(c)),M=function(e,t,o,a){const n=SdkCommand.create(a,new ClassFactory(TagEditPositionExecutor,t,o));return e.addAsyncCommandToInterface({namespace:"Tag",name:"editPosition",args:["id","options"]},n),n}(e,o,a,new DependencyFetcher(c,f)),N=function(e,t,o,a){const n=SdkCommand.create(a,new ClassFactory(TagRemoveExecutor,t,o));return e.addAsyncCommandToInterface({namespace:"Tag",name:"remove",args:["ids"],varArg:!0},n),n}(e,o,a,new DependencyFetcher),R=function(e,t){const o=SdkCommand.create(t,new ClassFactory(TagResetIconExecutor));return e.addAsyncCommandToInterface({namespace:"Tag",name:"resetIcon",args:["id"]},o),o}(e,new DependencyFetcher(c,d)),x=function(e,t){const o=SdkCommand.create(t,new ClassFactory(RegisterSandboxExecutor));return e.addAsyncCommandToInterface({namespace:"Tag",name:"registerSandbox",args:["html","options"],subRoutine:"tag.registerSandbox"},o),o}(e,new DependencyFetcher(r,s));return{attachments:w,addSandbox:function(e,t){const o=SdkCommand.create(t,new ClassFactory(DeprecatedDecorator,new ClassFactory(AddSandboxExecutor),"`Tag.addSandbox` deprecated, use `Tag.registerSandbox` instead"));return e.addAsyncCommandToInterface({namespace:"Tag",name:"addSandbox",args:["tagId","html","options"],subRoutine:"mattertag.inject"},o),o}(e,new DependencyFetcher(c,r,x)),registerAttachment:y,registerSandbox:x,attach:T,detach:I,data:E,add:C,allowAction:S,editBillboard:v,editColor:b,editIcon:D,editOpacity:A,editStem:O,editPosition:M,remove:N,resetIcon:R}}class TestExecutor{validateInput(e){if(!y(e.arg0))throw Error(`Stat.test: arg0 was specified but was not a valid string; got ${e.arg0}`);return e}async exec(e,t,o){t.return(e.arg0)}}class command_sdkTypes_TestExecutor{validateInput(e){return e}async exec(e,t,o){t.return()}}!function(e){e.ENUM1="test.enum1",e.ENUM2="test.enum2"}(Vo||(Vo={}));const jo=new Logger("Subscription");class Subscription{constructor(e,t,o=!1,a=""){this.startSubscription=e,this.endSubscription=t,this.id=a,this.isSubbed=!1,o&&this.renew()}renew(){this.isSubbed?jo.debugWarn(`Duplicate subscription renew ${this.id}`):(this.startSubscription(),this.isSubbed=!0)}cancel(){this.isSubbed&&(this.endSubscription(),this.isSubbed=!1)}get active(){return this.isSubbed}}function qo(e,t,o=!0,a=""){return new Subscription(e,t,o,a)}class CollectionSubFactory{create(){return qo((()=>{}),(()=>{}))}}class TestDataCollection{constructor(){this._data={}}get data(){return this._data}isItemEqual(e,t){const o=this.data[t],a=e.data[t];return o.test===a.test}update(){}clear(){this._data={}}}class TestSubFactory{create(e){return qo((()=>{}),(()=>{}))}}class TestObservableData{constructor(){this._data={testString:"hello"}}get data(){return this._data}equals(e){return this._data.testString===e.data.testString}copy(e){this._data.testString=e.data.testString}update(){}}var Wo;!function(e){e.STARTED="tour.started",e.STOPPED="tour.stopped",e.ENDED="tour.ended",e.STEPPED="tour.stepped"}(Wo||(Wo={}));const $o=new Logger("sdk: tours");class TourStartExecutor{constructor(e,t){this.tourControls=e,this.tourData=t}validateInput(e){return void 0!==e.index&&isNaN(e.index)&&($o.warn(e.index,"is not a valid number"),e.index=void 0),void 0!==e.steps&&isNaN(e.steps)&&($o.warn(e.steps,"is not a valid number"),e.steps=void 0),e}exec(e,t,o){if(0===this.tourData.getSnapshotCount())throw Error("No tour data found");if(!this.tourControls.canChangeTourLocation())throw Error("TourStart ignored, cannot change location at this time, another transition is active");try{this.tourControls.startTour(e.index,e.steps,e.loop),t.return()}catch(e){t.throw(`Error occurred while starting tour - ${e}`)}}}class TourStopExecutor{constructor(e){this.tourControls=e}validateInput(e){return e}exec(e,t,o){this.tourControls.stopTour().then((()=>t.return())).catch((e=>{t.throw(`Error occurred while stopping tour - ${e}`)}))}}class TourStepExecutor{constructor(e,t){this.tourControls=e,this.tourData=t}validateInput(e){const t=e.index;if(!pe(t))throw Error(t+" is not a valid tour snapshot index");if(t<0||t>this.tourData.getSnapshotCount())throw Error(`${t} is outside of the range of tour snapshots: [0 , ${this.tourData.getSnapshotCount()-1}]`);return{index:t}}exec(e,t,o){if(0===this.tourData.getSnapshotCount())throw Error("No tour data found");if(!this.tourControls.canChangeTourLocation())throw Error("TourStep ignored, cannot change location at this time, another transition is active");this.tourControls.tourGoTo(e.index).then((()=>t.return())).catch((e=>{t.throw(`Error occurred while jumping to new tour location - ${e}`)}))}}class TourStepRelativeExecutor{constructor(e,t,o){this.forward=e,this.tourControls=t,this.tourData=o}validateInput(e){return e}exec(e,t,o){if(0===this.tourData.getSnapshotCount())throw Error("No tour data found");if(!this.tourControls.canChangeTourLocation())throw Error("TourStep ignored, cannot change location at this time, another transition is active");(this.forward?this.tourControls.tourGoNext(!1):this.tourControls.tourGoPrevious(!1)).then((()=>t.return())).catch((e=>{t.throw(`Error while trying to travel to the next tour snapshot - ${e}`)}))}}function Ko(e,t,o,a){!function(e,t,o){t.addBinding(GetTourDataCommand,(async()=>o.getDependencies().then((async([o,a])=>{const n=await Promise.all(a.getEnabledSnapshots().map((o=>async function(e,t,o){const a=!e.is360,n=o.viewmodeConverter.toSdk(e.metadata.cameraMode,a);if(!n||n===o.commandModeConverter.toSdk(t.CommandViewmode.TRANSITIONING))throw Error("Failed to convert snapshot, invalid viewmode");return{sid:e.sid,thumbnailUrl:await e.thumbnailUrl.get(),imageUrl:await e.imageUrl.get(),is360:e.is360,name:e.name,mode:n,zoom:e.metadata.ssZoom,position:e.metadata.cameraPosition,rotation:o.conversionUtils.quaternionToRotation(e.metadata.cameraQuaternion)}}(o,e,t))));if(0===n.length)throw Error("No tour data found");return n}))))}(t,o,a),e.addCommandCreator({namespace:"Tour",name:"getData",args:[]},(()=>new GetTourDataCommand));const n=a,r=SdkCommand.create(n,new ClassFactory(TourStartExecutor)),s=SdkCommand.create(n,new ClassFactory(TourStopExecutor)),i=SdkCommand.create(n,new ClassFactory(TourStepExecutor)),c=SdkCommand.create(n,new ClassFactory(TourStepRelativeExecutor,!0)),d=SdkCommand.create(n,new ClassFactory(TourStepRelativeExecutor,!1));e.addAsyncCommandToInterface({namespace:"Tour",name:"start",args:["index"]},r),e.addCommandToInterface({namespace:"Tour",name:"stop",args:[]},s),e.addCommandToInterface({namespace:"Tour",name:"step",args:["index"]},i),e.addCommandToInterface({namespace:"Tour",name:"prev",args:[]},c),e.addCommandToInterface({namespace:"Tour",name:"next",args:[]},d)}class GetTourDataCommand extends Command_Command{constructor(){super(...arguments),this.id="GET_TOUR_DATA"}}class TourCurrentStepSubFactory{create(e,t){return t.onChanged((()=>e.onChanged()))}}class TourCurrentStepObservableData{constructor(){this._data={step:null}}get data(){return this._data}equals(e){return this._data.step===e.data.step}copy(e){this._data.step=e.data.step}update(e){var t;this._data.step=e.isTourActive()&&null!==(t=e.getTourCurrentSnapshotSid())&&void 0!==t?t:null}}class TourCurrentStateFactory{create(e,t){return t.onChanged((()=>e.onChanged()))}}class TourStateObservableData{constructor(e){this._data={current:te.PlayState.INACTIVE},this.tourStateConverter=e.tourStateConverter}get data(){return this._data}equals(e){return this._data.current===e.data.current}copy(e){this._data.current=e.data.current}update(e){this._data.current=this.tourStateConverter.toSdkTourState(e.getTourState())}}class TourStateConverter{constructor(e){this.toSdkTourStateMap={[e.Inactive]:te.PlayState.INACTIVE,[e.Active]:te.PlayState.ACTIVE,[e.StopScheduled]:te.PlayState.STOP_SCHEDULED}}toSdkTourState(e){return this.toSdkTourStateMap[e]}}class TourTransitionSubFactory{create(e,t){return t.onChanged((()=>e.onChanged()))}}class TourTransitionObservableData{constructor(){this._data={from:null,to:null}}get data(){return this._data}equals(e){return this._data.from===e.data.from&&this._data.to===e.data.to}copy(e){this._data.from=e.data.from,this._data.to=e.data.to}update(e){const t=this.hasEnded;if(this.hasEnded=e.tourEnded,!t&&this.hasEnded)return this._data.from=null,void(this._data.to=null);const o=-1===e.tourCurrentSnapshot?null:e.getTourSnapshotSid(e.tourCurrentSnapshot),a=-1===e.transition.toIndex?null:e.getTourSnapshotSid(e.transition.toIndex);null!==a&&(o===a?(this._data.from=null,this._data.to=null):(this._data.from=o,this._data.to=a))}}class ViewmodeTransitionSubFactory{create(e,t,o){const a=()=>e.onChanged();return new AggregateSubscription(o.onChanged(a),t.onChanged(a))}}class ViewmodeTransitionObservableData{constructor(e){this._data={from:null,to:null},this.viewmodeConverter=e.viewmodeConverter}get data(){return this._data}equals(e){return this._data.from===e._data.from&&this._data.to===e._data.to}copy(e){this._data={from:e._data.from,to:e._data.to}}update(e,t){const o=t.currentSweep&&t.isSweepAligned(t.currentSweep),a=t.transition.to&&t.isSweepAligned(t.transition.to);this._data=e.transition.active?{from:this.viewmodeConverter.toSdk(e.transition.from,!!o),to:this.viewmodeConverter.toSdk(e.transition.to,!!a)}:{from:null,to:null}}}class PureObservable{constructor(){this.observers=new Set}observe(e){this.observers.add(e);const t=this;return{renew(){t.observers.add(e)},cancel(){t.removeObserver(e)}}}removeObserver(e){this.observers.delete(e)}notify(){for(const e of this.observers)e.notify()}}var Xo,Yo;!function(e){e.Behance="behance",e.DailyMotion="dailymotion",e.FaceBook="facebook",e.Flickr="flickr",e.Giphy="giphy",e.GoogleMaps="google maps",e.Instagram="instagram",e.LinkedIn="linkedin",e.Matterport="matterport",e.MixCloud="mixcloud",e.Pinterest="pinterest",e.Reddit="reddit",e.SoundCloud="soundcloud",e.SketchFab="sketchfab",e.Spotify="spotify",e.Tenor="tenor",e.TikTok="tiktok",e.Twitch="twitch",e.Twitter="twitter",e.Tumblr="tumblr",e.Vimeo="vimeo",e.YouTube="youtube"}(Xo||(Xo={})),function(e){e.PHOTO="photo",e.VIDEO="video",e.LINK="link",e.RICH="rich"}(Yo||(Yo={}));Error;Xo.GoogleMaps;Xo.Behance,Xo.FaceBook,Xo.GoogleMaps,Xo.Instagram,Xo.LinkedIn,Xo.MixCloud,Xo.Pinterest,Xo.Reddit,Xo.TikTok,Xo.Twitter,Xo.Twitch;var Zo;!function(e){e.IMAGE="tag.attachment.image",e.RICH="tag.attachment.rich",e.VIDEO="tag.attachment.video"}(Zo||(Zo={}));class AttachmentRegistry{constructor(e,t){this.globalAttachments=new Map,this.perClientAttachments=new Map,this.clientAttachments=new Map,this.clientIds=new Set,this.attachmentDescriptors=new Map,this.observable=new PureObservable,this.oEmbed=t;for(const t of e.getTagList()){const o=e.getTag(t);for(const e of o.fileAttachments)this.globalAttachments.set(e.id,e),this.autoRefreshExpiringAttachment(e);for(const e of o.externalAttachments)this.globalAttachments.set(e.id,e),this.setDescriptorUrl(e,e.src)}}get(e,t){return this.globalAttachments.get(t)||this.clientAttachments.get(t)}add(e,t){const o=this.createIAttachment({src:t.src,type:t.type});return this.clientAttachments.set(o.id,o),this.setDescriptorUrl(o,t.src),this.clientIds.add(o.id),this.observable.notify(),o.id}async addBySrc(e,t){const o=await this.createOEmbedIAttachment(t);return this.clientAttachments.set(o.id,o),this.setDescriptorUrl(o,t),this.clientIds.add(o.id),this.observable.notify(),o.id}addSandbox(e,t){const o=this.getUniqueId(),a=t.name||"sandbox-"+o,n={id:o,src:a,srcDoc:t.srcDoc,onLoad:t.sandboxLoadedHandler,category:_e.SANDBOX,mediaType:ke.RICH,parentType:kt.MATTERTAG,thumbnailUrl:new ExpiringResource("",null),url:new ExpiringResource("",null),created:new Date,height:0,width:0};return this.clientAttachments.set(o,n),this.setDescriptorUrl(n,a),this.clientIds.add(o),this.observable.notify(),[o,n]}has(e){return this.globalAttachments.has(e)||this.clientIds.has(e)}*[Symbol.iterator](e){for(const e of this.globalAttachments)yield e;for(const e of this.clientAttachments)yield e;if(e){const t=this.perClientAttachments.get(e)||[];for(const e of t)yield e}}*descriptors(){for(const e of this.attachmentDescriptors)yield e}onChanged(e){return this.observable.observe(e)}getUniqueId(){const e=Be(10);return this.globalAttachments.has(e)||this.clientIds.has(e)?this.getUniqueId():e}async autoRefreshExpiringAttachment(e){const t=e.url,o=async()=>{if(t.validUntil){const a=Date.now()-t.validUntil.getMilliseconds(),n=a<=0;if(n){const o=await t.get();this.setDescriptorUrl(e,o),this.observable.notify()}setTimeout(o,n?0:a)}},a=await t.get();this.setDescriptorUrl(e,a),o(),this.observable.notify()}setDescriptorUrl(e,t){this.attachmentDescriptors.set(e.id,{id:e.id,src:t,type:this.getAttachmentType(e.mediaType)})}getAttachmentType(e){return{[ke.APPLICATION]:ee.AttachmentType.APPLICATION,[ke.AUDIO]:ee.AttachmentType.AUDIO,[ke.IMAGE]:ee.AttachmentType.IMAGE,[ke.MODEL]:ee.AttachmentType.MODEL,[ke.PDF]:ee.AttachmentType.PDF,[ke.RICH]:ee.AttachmentType.RICH,[ke.TEXT]:ee.AttachmentType.TEXT,[ke.VIDEO]:ee.AttachmentType.VIDEO,[ke.ZIP]:ee.AttachmentType.ZIP}[e]}createIAttachment(e){const t={[Zo.IMAGE]:ke.IMAGE,[Zo.RICH]:ke.RICH,[Zo.VIDEO]:ke.VIDEO};return{id:this.getUniqueId(),mediaType:t[e.type],category:_e.EXTERNAL,src:e.src,parentType:kt.MATTERTAG,created:new Date,height:0,width:0,thumbnailUrl:new ExpiringResource("",null),url:new ExpiringResource("",null),mimeType:""}}async createOEmbedIAttachment(e){const t={[Yo.PHOTO]:ke.IMAGE,[Yo.RICH]:ke.RICH,[Yo.VIDEO]:ke.VIDEO},o=this.getUniqueId(),a=t[(await this.oEmbed.getOEmbedData(e)).type];if(!a)throw Error("unable to determine media type");return{id:o,mediaType:a,category:_e.EXTERNAL,src:e,parentType:kt.MATTERTAG,created:new Date,height:0,width:0,thumbnailUrl:new ExpiringResource("",null),url:new ExpiringResource("",null),mimeType:""}}}class PluginSubFactory{create(e,t){return t.onChanged((()=>e.onChanged()))}}class PluginCollectionData{constructor(e){this.pluginData=e,this._data={}}get data(){return this._data}isItemEqual(e,t){const o=this.data[t],a=e.data[t];return o.applicationKey===a.applicationKey&&o.pluginId===a.pluginId}update(){for(const e of this.pluginData.plugins.entries())this._data[e[0]]={applicationKey:e[1].applicationKey,pluginId:e[1].pluginId};for(const e in this.data)this.pluginData.plugins.has(e)||delete this._data[e]}clear(){this._data={}}}function Qo(o,a,d,u,l,p){const{THREE:h}=a,{appPhaseModule:m,applicationData:g,cameraData:f,canvasData:w,deepLinks:y,floorData:T,floorViewData:I,labelData:D,mattertagData:A,mattertagViewData:O,measurementModeData:M,meshData:N,modelData:x,annotationsViewData:P,raycasterData:F,roomData:L,settingsData:k,sweepData:H,sweepViewData:B,tourData:z,viewmodeData:j,commonControlsModule:q,floorCasterModule:K,mattertagDataModule:X,mattertagMeshModule:Y,mattertagViewDataModule:Q,meshQuery:J,modelDataModule:ee,modelMeshModule:ie,navigationModule:de,plugin:ue,renderToTextureModule:le,sceneModule:he,sensorModule:me,settingsModule:ge,tourControlsModule:fe,webglRendererModule:we,zoomControlModule:Te,sweepTextureLoader:Ee,cursorController:Ae,pluginData:Oe,ses:Me}=l;p.idOption=p.idOption||r.LEGACY;const Ne=new Conversion(h),xe=new ViewmodeConverter(d.Viewmode),Pe=function(e){return async function(t,o){const a=o.rotationSpeed;let n=0;const r=Math.abs(o.xAngle),s=Math.abs(o.yAngle),i=Math.max(r,s);if(i>=Math.PI){const e=i/Math.PI,t=Math.floor(e),o=r/e,a=s/e,c=r-o*t,d=s-a*t;n=Math.acos(Math.cos(o)*Math.cos(a))*t+Math.acos(Math.cos(c)*Math.cos(d))}else n=Math.acos(Math.cos(Math.abs(o.xAngle))*Math.cos(Math.abs(o.yAngle)));if(n){const r=new e.Vector2(-o.xAngle,o.yAngle);return r.multiplyScalar(a/n),t.startRotateTransition(n/a,r,!1)}}}(h),Fe=new SweepPlacementConverter(d.SweepAlignmentType,d.SweepPlacementType),Le=Object.assign(Object.assign({},u),{conversionUtils:new Conversion(h),directionConverter:new DirectionConverter(d.Vectors),getPose:_(h,xe),rotateCamera:Pe,orientCamera:R(h,d.Viewmode,Pe),appPhaseConverter:new AppPhaseConverter(d.AppPhase),applicationConverter:new ApplicationConverter(d.Application),mediaConverter:new MediaConverter(d.MattertagMediaType,d.TagDescriptionChunkType),chunkTypeConverter:new ChunkTypeConverter(d.TagDescriptionChunkType),linkTypeConverter:new LinkTypeConverter(d.TagLinkType),sweepPlacementConverter:Fe,viewmodeConverter:xe,commandModeConverter:new CommandModeConverter(d.CommandViewmode),cameraTransitionConverter:new CameraTransitionConverter(d.CameraTransitionType),makeLabelData:se(h,u.worldToScreenPosition),makeModelData:go(Ne,Fe),sweepUtils:new SweepUtils(d.SweepAlignmentType),tourStateConverter:new TourStateConverter(d.TourState)}),ke=async function(e,t){const o=await e;return t===r.LEGACY?new LegacySweepIdMap(o):new SweepIdMap(o)}(H,p.idOption),_e=async function(e,t){const o=await e;return t===r.LEGACY?new LegacyFloorIdMap(o):new FloorIdMap(o)}(T,p.idOption),Ue=async function(e,t,o){const a=await e,n=await t;return o===r.LEGACY?new LegacyRoomIdMap(a,n):new RoomIdMap(a)}(L,T,p.idOption),Ge=async function(e,t){const o=await e;return new AttachmentRegistry(o,t)}(A,a.oEmbed),He=new Map;var Be;(Be=o).addEnumToInterface({namespace:"App",name:"Phase",values:c}),Be.addEnumToInterface({namespace:"App",name:"Event",values:s}),Be.addEnumToInterface({namespace:"App",name:"Application",values:i}),function(e,t,o){const a=[void 0],n=e=>(a[0]=o.appPhaseConverter.toSdkAppPhase(e.phase),a);o.subscribe(t.AppPhaseChangeMessage,(t=>{e.broadcast(s.PHASE_CHANGE,n,t)}))}(o,d,Le),function(e,t,o){o.getDependencies().then((([e])=>{t.addBinding(GetAppStateCommand,(async()=>{try{const o=e.getData();return{phase:t.appPhaseConverter.toSdkAppPhase(o.phase),application:t.applicationConverter.toSdkApplication(o.application)}}catch(e){throw Error("Error: Can't get application data at this time")}}))})),e.addCommandCreator({namespace:"App",name:"getState",args:[]},(()=>new GetAppStateCommand))}(o,Le,new DependencyFetcher(m)),function(e,t,o){t.addBinding(GetAppPhaseTimesCommand,(async()=>{const e={[c.WAITING]:null,[c.LOADING]:null,[c.STARTING]:null,[c.PLAYING]:null,[c.ERROR]:null},[a]=await o.getDependencies();for(const o in a.phaseTimes){const n=Number(o);e[t.appPhaseConverter.toSdkAppPhase(n)]=a.phaseTimes[n]}return e})),e.addCommandCreator({namespace:"App",name:"getLoadTimes",args:[]},(()=>new GetAppPhaseTimesCommand))}(o,Le,new DependencyFetcher(g)),function(e,t,o,a){const n=SdkObservable.create(a,new AppStateSubFactory,new ClassFactory(AppStateObservable,t,o));e.addObservableToInterface({namespace:"App",name:"state"},n)}(o,d,Le,new DependencyFetcher(g));const ze=E(o,h,Le,{iconMaps:He});!function(e,o,a){a.getDependencies().then((([e,a,n,r])=>{const s={position:{x:0,y:0,z:0},rotation:{x:0,y:0},projection:new Float32Array(16),sweep:"",mode:t.TRANSITIONING};o.addBinding(GetPoseCommand,(async()=>o.getPose(s,e,a,n,r)))})),e.addCommandCreator({namespace:"Camera",name:"getPose",args:[]},(()=>new GetPoseCommand))}(o,Le,new DependencyFetcher(f,H,j,ke)),function(e,t,o,a){a.getDependencies().then((([e,a,n])=>{o.addBinding(LookAtScreenCoordsCommand,(async function(r={}){if(!n.isInside())throw Error("Camera.lookAtScreenCoords must be called from Inside mode");const s=o.screenPositionToNDC(r.x,r.y,a.width,a.height),i=new t.Vector3(0,0,-1).applyQuaternion(a.pose.rotation),c=o.ndcToWorldPosition(a,new t.Vector2(s.x,s.y),1).normalize(),d=i.clone().setY(0).angleTo(c.clone().setY(0)),u=Math.asin(c.y-i.y),l=d*Math.sign(s.x),p=u;return o.rotateCamera(e,{xAngle:l,yAngle:p,zAngle:0,rotationSpeed:C})}))})),e.addCommandCreator({namespace:"Camera",name:"lookAtScreenCoords",args:["x","y"]},(function(e={}){if(e.x=e.x||0,e.y=e.y||0,isNaN(e.x)||isNaN(e.y))throw new Error(`${JSON.stringify(e)} does not contain valid screen coordinates`);return new LookAtScreenCoordsCommand({x:e.x,y:e.y})}))}(o,h,Le,new DependencyFetcher(q,f,j)),function(e,o,a){a.getDependencies().then((([a,n,r,s])=>{const i=[{position:{x:0,y:0,z:0},rotation:{x:0,y:0},projection:new Float32Array(16),sweep:"",mode:t.TRANSITIONING}],c=(()=>{let t=0,d=!1;const u=()=>(o.getPose(i[0],a,n,r,s),i);return()=>{const o=Date.now(),a=t+100;if(o>a){d=!1,t=o;try{e.broadcast(S.MOVE,u)}catch(e){v.debug("failed to broadcast pose, one of the module dependencies are probably not loaded yet")}}else d||(setTimeout((()=>c()),a-o),d=!0)}})();a.onChanged(c),r.onChanged(c)})),e.addEnumToInterface({namespace:"Camera",name:"Event",values:S})}(o,Le,new DependencyFetcher(f,H,j,ke)),function(t,o,a){a.getDependencies().then((([t])=>o.addBinding(MoveDirectionCommand,(async a=>{const n=a.direction;if(!b(e,a.direction))throw new Error(`${a.direction} is not a valid direction`);await t.navigateInLocalDirection(o.directionConverter.toVector(n))})))),t.addEnumToInterface({namespace:"Camera",name:"Direction",values:e}),t.addCommandCreator({namespace:"Camera",name:"moveInDirection",args:["direction"]},(e=>new MoveDirectionCommand(e||{})))}(o,Le,new DependencyFetcher(de)),function(e,t,o,a){a.getDependencies().then((([e,a])=>{o.addBinding(PanCommand,(async o=>{const n=a.pose.position,r=o.x-n.x,s=o.z-n.z,i=new t.Vector2(r,s),c=i.length();i.setLength(.005),await e.startTranslateTransition(c/.005,i,!1)}))})),e.addCommandCreator({namespace:"Camera",name:"pan",args:["position"]},(e=>{if((e=e||{}).position=e.position||{},e.position.x=e.position.x-0,e.position.z=e.position.z-0,isNaN(e.position.x)||isNaN(e.position.z))throw new Error(`${JSON.stringify(e)} does not contain a valid position to pan`);return new PanCommand({x:e.position.x,z:e.position.z})}))}(o,h,Le,new DependencyFetcher(q,f)),function(e,t,o,a){const n=SdkObservable.create(a,new PoseSubFactory,new ClassFactory(ObservablePose,t,o.viewmodeConverter));e.addObservableToInterface({namespace:"Camera",name:"pose"},n)}(o,h,Le,new DependencyFetcher(f,H,j,ke)),function(e,t,o,a){const n=t.MathUtils.degToRad(80)/1e3;a.getDependencies().then((([e,t,a])=>{o.addBinding(RotateCommand,(async t=>await o.rotateCamera(e,t))),o.addBinding(SetOrientationCommand,(async n=>await o.orientCamera(t,e,a,n)))}));const r=e=>{const o=(e=e||{}).options||{},a=t.MathUtils.degToRad(e.xAngle||0),r=t.MathUtils.degToRad(e.yAngle||0),s=t.MathUtils.degToRad(e.zAngle||0);let i=n;if(o.speed){if(isNaN(o.speed)||o.speed<=0)throw new Error(`${JSON.stringify(o)} does not contain valid rotation speed`);i=t.MathUtils.degToRad(o.speed)/1e3}if(isNaN(a)||isNaN(r)||isNaN(s))throw new Error(`${JSON.stringify(e)} does not contain valid rotation angles`);return{xAngle:a,yAngle:r,zAngle:s,rotationSpeed:i}};e.addCommandCreator({namespace:"Camera",name:"rotate",args:["xAngle","yAngle","options"]},(e=>new RotateCommand(r(e)))),e.addCommandCreator({namespace:"Camera",name:"setRotation",args:["rotation","options"]},(e=>{const t=(e=e||{}).rotation||{};return new SetOrientationCommand(r({xAngle:t.x,yAngle:t.y,zAngle:t.z,options:e.options}))}))}(o,h,Le,new DependencyFetcher(q,f,j)),function(e,t,o,a){const n=a,r=SdkCommand.create(n,new ClassFactory(ZoomToExecutor,t,o)),s=SdkCommand.create(n,new ClassFactory(ZoomByExecutor,t,o)),i=SdkCommand.create(n,new ClassFactory(ZoomResetExecutor,t,o));e.addCommandToInterface({namespace:"Camera",name:"zoomTo",args:["zoomPct"]},r),e.addCommandToInterface({namespace:"Camera",name:"zoomBy",args:["zoomDelta"]},s),e.addCommandToInterface({namespace:"Camera",name:"zoomReset",args:[]},i)}(o,d,Le,new DependencyFetcher(f,j,Te)),function(e,t,o){const a=SdkObservable.create(o,new ZoomSubFactory,new ClassFactory(ZoomObservableData,t));e.addObservableToInterface({namespace:"Camera",name:"zoom"},a)}(o,d,new DependencyFetcher(f,j)),function(e,t,o){const a=SdkObservable.create(o,new FloorSubFactory,new ClassFactory(CurrentFloorObservableData,t));e.addObservableToInterface({namespace:"Floor",name:"current"},a)}(o,d,new DependencyFetcher(I,H,f,_e)),function(e,t,o,a){e.addEnumToInterface({namespace:"Floor",name:"Event",values:V}),a.getDependencies().then((([a])=>{const n=[-1,-1];function r(e){if(a){const t=e.to?a.getFloor(e.to):null,o=e.from?a.getFloor(e.from):null;t&&(n[0]=t.index),o&&(n[1]=o.index)}return n}const s=[-1,""];function i(e){if(a){const t=e.floorId?a.getFloor(e.floorId):null;t&&(s[0]=t.index)}return s[1]=e.floorName,s}o.subscribe(t.StartMoveToFloorMessage,(t=>e.broadcast(V.CHANGE_START,r,t))),o.subscribe(t.EndMoveToFloorMessage,(t=>e.broadcast(V.CHANGE_END,i,t)))}))}(o,d,Le,new DependencyFetcher(T)),function(e,t){const o=SdkCollection.create(t,new collection_data_FloorSubFactory,new ClassFactory(FloorDataCollection));e.addCollectionToInterface({namespace:"Floor",name:"data"},o)}(o,new DependencyFetcher(T,_e)),function(e,t,o){t.addBinding(GetFloorsDataCommand,(async()=>{const[e]=await o.getDependencies();return U(e)})),e.addCommandCreator({namespace:"Floor",name:"getData",args:[]},(()=>new GetFloorsDataCommand))}(o,Le,new DependencyFetcher(I)),function(e,t,o,a){a.getDependencies().then((([e])=>o.addBinding(ChangeFloorCommand,(async a=>{if("number"!=typeof a.floorIndex||a.floorIndex<0)throw Error("floor index must be a non-negative number");try{const n="boolean"==typeof a.moveCamera&&!a.moveCamera,r=n?250:void 0;await o.issueCommand(new t.MoveToFloorIndexCommand(a.floorIndex,n,r));const s=e.currentFloor;return s?s.index:-1}catch(e){throw Error(`Could not move to floor at index ${a.floorIndex}`)}})))),e.addCommandCreator({namespace:"Floor",name:"moveTo",args:["floorIndex","moveCamera"]},(e=>new ChangeFloorCommand(e)))}(o,d,Le,new DependencyFetcher(I)),function(e,t,o,a){const n=SdkCommand.create(a,new ClassFactory(ShowAllFloorsExecutor,t,o));e.addCommandToInterface({namespace:"Floor",name:"showAll",args:["moveCamera"]},n)}(o,d,Le,new DependencyFetcher(I)),function(e,t,o){t.addBinding(LabelGetCommand,(async()=>t.makeLabelData(...await o.getDependencies()))),e.addCommandCreator({namespace:"Label",name:"getData",args:[]},(()=>new LabelGetCommand))}(o,Le,new DependencyFetcher(f,T,D,_e)),function(e,t,o,a){e.addEnumToInterface({namespace:"Label",name:"Event",values:G}),a.getDependencies().then((([a,n,r,s,i])=>{const c=()=>[o.makeLabelData(a,r,n,i)];a.onChanged((o=>{s.currentMode===t.Viewmode.Floorplan&&e.broadcast(G.POSITION_UPDATED,c,o)}))}))}(o,d,Le,new DependencyFetcher(f,D,T,j,_e)),function(e,t){const o=SdkCollection.create(t,new LabelSubFactory,new ClassFactory(LabelCurrentCollection));e.addCollectionToInterface({namespace:"Label",name:"data"},o)}(o,new DependencyFetcher(D,T,_e)),function(e,t){const o=SdkCommand.create(t,new ClassFactory(CreateLinkExecutor));e.addAsyncCommandToInterface({namespace:"Link",name:"createLink",args:[]},o)}(o,new DependencyFetcher(y)),function(e,t){const o=SdkCommand.create(t,new ClassFactory(CreateDeepLinkExecutor));e.addAsyncCommandToInterface({namespace:"Link",name:"createDeepLink",args:[]},o)}(o,new DependencyFetcher(y)),function(e,t){const o=SdkCommand.create(t,new ClassFactory(ModelLinkPolicyExecutor,e)),a=SdkCommand.create(t,new ClassFactory(NavigationLinkPolicyExecutor,e)),n=SdkCommand.create(t,new ClassFactory(SameOriginLinkPolicyExecutor,e)),r=SdkCommand.create(t,new ClassFactory(ExternalLinkPolicyExecutor,e));e.addEnumToInterface({namespace:"Link",name:"OpenPolicy",values:W.OpenPolicy}),e.addAsyncCommandToInterface({namespace:"Link",name:"setModelLinkPolicy",args:["policy","baseHref"],subRoutine:"link.setopenpolicy"},o),e.addAsyncCommandToInterface({namespace:"Link",name:"setNavigationLinkPolicy",args:["policy","baseHref"],subRoutine:"link.setopenpolicy"},a),e.addAsyncCommandToInterface({namespace:"Link",name:"setSameOriginLinkPolicy",args:["policy"]},n),e.addAsyncCommandToInterface({namespace:"Link",name:"setExternalLinkPolicy",args:["openInNewWindow"]},r)}(o,new DependencyFetcher(y)),function(e,t){const o=SdkCommand.create(t,new ClassFactory(SetSharePolicyExecutor));e.addEnumToInterface({namespace:"Link",name:"CreationPolicy",values:W.CreationPolicy}),e.addAsyncCommandToInterface({namespace:"Link",name:"setShareLinkPolicy",args:["policy","baseHref","options"],subRoutine:"link.setsharepolicy"},o)}(o,new DependencyFetcher(y));const je=async function(){const e=p.sandboxPath;return(await fetch(e)).text()}();if(p.useNewTags){const e=zo(o,h,d,Le,He,Ge,je,Object.assign(Object.assign({},l),{roomIdMap:Ue}));io(o,d,Object.assign(Object.assign({},Le),{getIframeSrcDoc:je}),ze,e,[A,P,T,_e,Ge])}else{!function(e){e.addEnumToInterface({namespace:"Mattertag",name:"DescriptionChunkType",values:ne}),e.addEnumToInterface({namespace:"Mattertag",name:"Event",values:oe}),e.addEnumToInterface({namespace:"Mattertag",name:"LinkType",values:re}),e.addEnumToInterface({namespace:"Mattertag",name:"MediaType",values:ae}),e.addEnumToInterface({namespace:"Mattertag",name:"Transition",values:n})}(o);const e=function(e,t,o,a,n){const r=SdkCommand.create(n,new ClassFactory(EditIcon,t,a)),s=SdkCommand.create(n,new ClassFactory(ResetIcon,t,a));return e.addAsyncCommandToInterface({namespace:"Mattertag",name:"registerIcon",args:["textureId","textureSrc"]},o.registerTexture),e.addAsyncCommandToInterface({namespace:"Mattertag",name:"editIcon",args:["tagId","iconId"]},r),e.addAsyncCommandToInterface({namespace:"Mattertag",name:"resetIcon",args:["tagId"]},s),{editIcon:r}}(o,h,ze,Le.loadImage,new DependencyFetcher(He,Y,A));Ce(o,h,d,Le,new DependencyFetcher(T,L,N,X,e.editIcon)),function(e,t,o,a){o.addBinding(GetMattertagDataCommand,(async()=>a.getDependencies().then((([e,t,a])=>{try{const n=[];return e.iterate((e=>{const{id:r,index:s}=t.getFloor(e.floorId),i=a.getIdFromCwfId(r),c=e.mediaSrc,d=o.mediaConverter.fromTagChunkType(e.mediaType);n.push({sid:e.sid,label:e.label,description:e.description,parsedDescription:Se(e.parsedDescription,o.chunkTypeConverter,o.linkTypeConverter),mediaSrc:c,mediaType:d,media:{type:d,src:c},anchorPosition:{x:e.anchorPosition.x,y:e.anchorPosition.y,z:e.anchorPosition.z},anchorNormal:{x:e.anchorNormal.x,y:e.anchorNormal.y,z:e.anchorNormal.z},color:{r:e.color.r,g:e.color.g,b:e.color.b},enabled:e.enabled,floorId:s,floorIndex:s,floorInfo:{id:i,sequence:s},stemVector:{x:e.stemVector.x,y:e.stemVector.y,z:e.stemVector.z},stemHeight:e.stemHeight,stemVisible:e.stemVisible})})),n}catch(e){throw Error("problem getting tag data")}})))),e.addCommandCreator({namespace:"Mattertag",name:"getData",args:[]},(()=>new GetMattertagDataCommand))}(o,0,Le,new DependencyFetcher(A,T,_e)),function(e,t,o,a,n){const r={[ae.NONE]:o.TagDescriptionChunkType.none,[ae.PHOTO]:o.TagDescriptionChunkType.photo,[ae.VIDEO]:o.TagDescriptionChunkType.video,[ae.RICH]:o.TagDescriptionChunkType.rich};n.getDependencies().then((()=>{a.addBinding(EditBillboardCommand,(async e=>{const t=e.tagId;if(!ve(t))throw new TagIdInputException(t);if(!e.properties)return;const n=e.properties[De.LABEL],s=e.properties[De.MEDIA],i=e.properties[De.DESCRIPTION];if(null!=n&&"string"!=typeof n)throw Error("Mattertag.editBillboard only accepts a string for the title field");if(null!=i&&"string"!=typeof i)throw Error("Mattertag.editBillboard only accepts a string for the description field");if(null!=s){if("string"!=typeof s.src)throw Error("Mattertag.editBillboard only accepts a string for the media.src field");if(!b(ae,s.type))throw Error("Mattertag.editBillboard only accepts a value from Mattertag.MediaType for the media.type field")}let c;s&&(c={mediaType:r[s.type],mediaSrc:s.src});const d={label:n,description:i};await a.issueCommand(new o.EditMattertagCommand(e.tagId,d,c))})),a.addBinding(EditColorCommand,(async e=>{const n=e.color;if(null!=n&&!ye(n,be))throw Error("Mattertag.editColor only accepts a Color object of the form {r, g, b} for the color field");const r={color:(new t.Color).setRGB(n.r,n.g,n.b)};await a.issueCommand(new o.EditMattertagCommand(e.tagId,r))})),a.addBinding(EditStemCommand,(async e=>{const t=e.stemHeight,n=e.stemVisible;if(null!=t&&!pe(t))throw Error("Mattertag.editStem only accepts a numeric value for stemHeight");if(null!=n&&!ce(n))throw Error("Mattertag.editStem only accepts a boolean value for stemVisible");const r={};void 0!==t&&(r.stemHeight=t),void 0!==n&&(r.stemVisible=n),await a.issueCommand(new o.EditMattertagCommand(e.tagId,r))}))})),e.addCommandCreator({namespace:"Mattertag",name:"editBillboard",args:["tag","values"]},(e=>new EditBillboardCommand(e.tag,e.values))),e.addCommandCreator({namespace:"Mattertag",name:"editColor",args:["tag","color"]},(e=>new EditColorCommand(e.tag,e.color))),e.addCommandCreator({namespace:"Mattertag",name:"editStem",args:["tag","stemParams"]},(e=>new EditStemCommand(e.tag,e.stemParams)))}(o,h,d,Le,new DependencyFetcher(A)),function(e,t){const o=SdkCommand.create(t,new ClassFactory(EditOpacityExecutor));e.addCommandToInterface({namespace:"Mattertag",name:"editOpacity",args:["sid","opacity"]},o)}(o,new DependencyFetcher(A,Y)),function(e,t,o){const a=SdkCollection.create(o,new MattertagSubFactory,new ClassFactory(MattertagDataCollection,t));e.addCollectionToInterface({namespace:"Mattertag",name:"data"},a)}(o,Le,new DependencyFetcher(A,T,_e)),function(e,t){const o=SdkCommand.create(t,new ClassFactory(InjectionExecutor));e.addCommandToInterface(Object.assign({},Re),o)}(o,new DependencyFetcher(A,je)),function(e,t,o,a){let n;e.addCommandCreator({namespace:"Mattertag",name:"editPosition",args:["sid","options"]},(e=>{if(!n)throw Error("Edit command not bound yet");return n(e)}));const r=new t.Vector3,s=new t.Vector3;a.getDependencies().then((function([e,t,a,i]){n=({sid:n,options:c})=>{const{stemVector:d,anchorPosition:u}=c,l={};if(!ve(n))throw new TagIdInputException(n);const p=e.getTag(n);if(!p)throw Error(`${n} was not found in the mattertag data`);if(u&&(!pe(u.x)||!pe(u.y)||!pe(u.z)))throw Error(`${u} is not a valid Vector3`);if(d&&(!pe(d.x)||!pe(d.y)||!pe(d.z)))throw Error(`${d} is not a valid Vector3`);let h=t.getFloor(p.floorId);s.copy(p.anchorPosition),r.copy(p.anchorNormal),d&&(r.set(d.x,d.y,d.z),l.stemHeight=r.length(),r.normalize()),u&&(s.set(u.x,u.y,u.z),h=t.getFloorAtIndex(Ie(s,t,a,i)));const m=void 0!==c.floorIndex?c.floorIndex:c.floorId;if(void 0!==m&&(h=t.getFloorAtIndex(m)),!h)throw new Error(`Could not move Mattertag to invalid floor with index: ${m}`);return new o.EditMattertagCommand(n,l,void 0,{floorId:h.id,normal:r,position:s})}}))}(o,h,d,new DependencyFetcher(A,T,L,N)),function(e,t,o){e.addCommandCreator({namespace:"Mattertag",name:"navigateToTag",args:["sid","transitionType"]},(e=>{const a=e.transitionType?o.cameraTransitionConverter.fromSdkTransition(e.transitionType):t.CameraTransitionType.Interpolate;return new MattertagNavigateCommand(e.sid,a)})),o.addBinding(MattertagNavigateCommand,(async e=>{try{return await o.issueCommand(new t.NavigateToMattertagCommand(e.sid,e.transition)),e.sid}catch(t){throw Error(`Could not move to tag with sid ${e.sid}`)}}))}(o,d,Le),function(e,t){const o=SdkCommand.create(t,new ClassFactory(PreventActionExecutor));e.addCommandToInterface({namespace:"Mattertag",name:"preventAction",args:["sid","prevent"]},o)}(o,new DependencyFetcher(O)),function(e,t,o){e.addCommandCreator({namespace:"Mattertag",name:"remove",args:["tags"]},(function(e){const o=[];if(!e.tags)throw Error("invalid list of tags to remove");if(Array.isArray(e.tags)){const a=e.tags,n=a.length;o.length=n;for(let e=0;e<n;++e)o[e]=new t.RemoveMattertagCommand(a[e])}else o.push(new t.RemoveMattertagCommand(e.tags));return new BatchRemoveMattertagCommand(o)})),o.addBinding(BatchRemoveMattertagCommand,(async e=>{const t=[],a=e.removeCommands;for(const e of a){const a=await o.issueCommand(e);a&&t.push(a)}return t}))}(o,d,Le),Ve(o,d,Le),function(e,t,o,a){a.getDependencies().then((([a])=>{const n=["",""],r=e=>(n[0]=a.openTag,n[1]=e.url,n);o.subscribe(t.MattertagLinkOpenedMessage,(t=>{e.broadcast($.Event.LINK_OPEN,r,t)}))}))}(o,d,Le,new DependencyFetcher(O)),function(e,t,o){e.addCommandCreator({namespace:"Mattertag",name:"closeBillboards",args:["tag"]},(e=>new MattertagCloseCommand(e.tag))),o.getDependencies().then((([e])=>{t.addBinding(MattertagOpenCommand,(async t=>{const o=t.tag;if(!ve(o))throw new TagIdInputException(o);e.openBillboard(o)}))})),o.getDependencies().then((([e])=>{t.addBinding(MattertagCloseCommand,(async t=>{const o=t.tag;if(!ve(o))throw new TagIdInputException(o);e.closeBillboard(t.tag)}))}))}(o,Le,new DependencyFetcher(Q))}!function(e,t,o){t.addBinding(GetMeasurementsDataCommand,(async()=>{const[e,t]=await o.getDependencies();return co(e,t)})),e.addCommandCreator({namespace:"Measurements",name:"getData",args:[]},(()=>new GetMeasurementsDataCommand))}(o,Le,new DependencyFetcher(M,T)),function(e,t,o){const a=SdkCollection.create(o,new MeasurementModeSubFactory(t.MeasuringPhase),new ClassFactory(MeasurementDataCollection));e.addCollectionToInterface({namespace:"Measurements",name:"data"},a)}(o,d,new DependencyFetcher(M)),function(e,t){const o=SdkObservable.create(t,new MeasurementPhaseSubFactory,new ClassFactory(MeasurementModeObservable));e.addObservableToInterface({namespace:"Measurements",name:"mode"},o)}(o,new DependencyFetcher(M)),function(e,t,o){o.addBinding(ToggleMeasureModeCommand,(async e=>o.issueCommand(new t.ToggleToolCommand(t.Tools.MEASUREMENTS,e.active)))),e.addCommandCreator({namespace:"Measurements",name:"toggleMode",args:["active"]},(e=>new ToggleMeasureModeCommand(e.active)))}(o,d,Le),function(e,t,o,a){e.addEnumToInterface({namespace:"Mode",name:"Event",values:uo}),a.getDependencies().then((([a,n])=>{const r=[void 0,void 0],s=e=>{const t=n.currentMode,s=o.sweepUtils.isSweepAligned(a,e.fromSweep),i=o.sweepUtils.isSweepAligned(a,e.toSweep);return r[0]=o.viewmodeConverter.toSdk(t,s),r[1]=o.viewmodeConverter.toSdk(t,i),r};o.subscribe(t.EndMoveToSweepMessage,(t=>{o.sweepUtils.isSweepAligned(a,t.fromSweep)!==o.sweepUtils.isSweepAligned(a,t.toSweep)&&e.broadcast(uo.CHANGE_END,s,t)}));const i=[void 0,void 0],c=e=>{const t=o.sweepUtils.isCurrentSweepAligned(a);return i[0]=o.viewmodeConverter.toSdk(e.fromMode,t),i[1]=o.viewmodeConverter.toSdk(e.toMode,t),i};o.subscribe(t.BeginSwitchViewmodeMessage,(t=>e.broadcast(uo.CHANGE_START,c,t)));const d=[void 0,void 0],u=e=>{const t=o.sweepUtils.isCurrentSweepAligned(a);return d[0]=o.viewmodeConverter.toSdk(e.fromMode,t),d[1]=o.viewmodeConverter.toSdk(e.toMode,t),d};o.subscribe(t.EndSwitchViewmodeMessage,(t=>e.broadcast(uo.CHANGE_END,u,t)))}))}(o,d,Le,new DependencyFetcher(H,j)),function(e,t,o,a,r){a.addBinding(MoveToModeCommand,(async e=>{try{e.options=e.options||{};let t=o.CameraTransitionType.Interpolate;const n=e.options.transition;return void 0===n||isNaN(n)||(t=n),await a.issueCommand(new o.ChangeViewmodeCommand(e.mode,t,{position:e.options.position,rotation:e.options.rotation,zoom:e.options.zoom})),e.mode}catch(t){const o=t instanceof ViewmodeActiveTransitionError?`Mode.moveTo -> Cannot move to ${e.mode} during a mode transition`:`Mode.moveTo -> Could not move to ${e.mode}`;if(lo.error(t,o),t instanceof ViewmodeActiveTransitionError)throw Error(`Mode.moveTo -> Cannot move to ${e.mode} during a mode transition`);throw Error(`Mode.moveTo -> Could not move to ${e.mode}`)}}));const s=new MoveToModeValidation(t,o.CommandViewmode,a.conversionUtils,a.cameraTransitionConverter);e.addCommandCreator({namespace:"Mode",name:"moveTo",args:["mode","options"]},(e=>new MoveToModeCommand(s.validateMoveToModeInput(e)))),e.addEnumToInterface({namespace:"Mode",name:"Mode",values:o.CommandViewmode}),e.addEnumToInterface({namespace:"Mode",name:"TransitionType",values:n})}(o,h,d,Le,new DependencyFetcher),function(e,t,o,a){const n=SdkObservable.create(a,new ViewmodeCurrentFactory,new ClassFactory(ViewmodeCurrentObservableData,t,o));e.addObservableToInterface({namespace:"Mode",name:"current"},n)}(o,d,Le,new DependencyFetcher(j,H)),function(e,t,o){const a=SdkObservable.create(o,new ViewmodeTransitionSubFactory,new ClassFactory(ViewmodeTransitionObservableData,t));e.addObservableToInterface({namespace:"Mode",name:"transition"},a)}(o,Le,new DependencyFetcher(j,H)),po(o,Le,new DependencyFetcher(x,H,T,ke)),ho(o,d,Le,new DependencyFetcher(x,k)),function(e,t,o,a){e.addEnumToInterface({namespace:"Model",name:"Event",values:mo});const n={sid:"",sweeps:[],modelSupportsVr:!1},r=[n];a.getDependencies().then((a=>{o.subscribe(t.ModelDataLoadedMessage,(async t=>{const[s,i,c]=a;await o.makeModelData(t.sid,t.vrSupported,s.getSweepList(),i,c,n),e.broadcast(mo.MODEL_LOADED,(()=>r))}))}))}(o,d,Le,new DependencyFetcher(H,T,ke)),function(e,t){const o=SdkCommand.create(t,new ClassFactory(UpdateTokenExecutor));e.addCommand("OAuth.updateToken",o)}(o,new DependencyFetcher(d.MpSdkAuthentication)),function(e,t){const o=SdkCollection.create(t,new PluginSubFactory,new ClassFactory(PluginCollectionData));e.addCollectionToInterface({namespace:"Plugin",name:"data",sdkTypes:[fo.POSTMESSAGE],origins:wo},o)}(o,new DependencyFetcher(Oe)),function(e,t){const o=SdkCommand.create(t,new ClassFactory(LoadExecutor));e.addAsyncCommandToInterface({namespace:"Plugin",name:"load",args:["key","path","config"],varArg:!1,sdkTypes:[fo.POSTMESSAGE],origins:wo},o)}(o,new DependencyFetcher(ue,Me)),function(e,t){const o=SdkCommand.create(t,new ClassFactory(UnloadExecutor));e.addAsyncCommandToInterface({namespace:"Plugin",name:"unload",args:["key"],varArg:!1,sdkTypes:[fo.POSTMESSAGE],origins:wo},o)}(o,new DependencyFetcher(ue)),function(e,t,o,a){const n=SdkObservable.create(a,new PointerSubFactory,new ClassFactory(ObservablePointer,t,o));e.addEnumToInterface({namespace:"Pointer",name:"Colliders",values:To}),e.addObservableToInterface({namespace:"Pointer",name:"intersection"},n)}(o,h,d,new DependencyFetcher(F,T,L,N,J)),function(e,t,o){const a=SdkCommand.create(o,new ClassFactory(EditTextureExecutor)),n=SdkCommand.create(o,new ClassFactory(ResetTextureExecutor));e.addCommandToInterface({namespace:"Pointer",name:"registerTexture",args:["textureId","textureSrc"],varArg:!1},t),e.addCommandToInterface({namespace:"Pointer",name:"editTexture",args:["textureId"],varArg:!1},a),e.addCommandToInterface({namespace:"Pointer",name:"resetTexture",args:[],varArg:!1},n)}(o,ze.registerTexture,new DependencyFetcher(Ae,He)),function(e,t){const o=SdkCommand.create(t,new ClassFactory(SetFadePropsExecutor));e.addCommandToInterface({namespace:"Pointer",name:"setFadeProps",args:["props"],varArg:!1},o)}(o,new DependencyFetcher(Ae)),function(e,t){const o=SdkCommand.create(t,new ClassFactory(SetVisibleExecutor));e.addCommandToInterface({namespace:"Pointer",name:"setVisible",args:["visible"],varArg:!1},o)}(o,new DependencyFetcher(Ae)),function(e,t,o,a,n){const r=new ScreenCapturer(new t.Camera,a.encodeRenderTarget),s=new ClassFactory(ScreenshotExecutor,r,o,a),i=SdkCommand.create(n,s),c=SdkCommand.create(n,new ClassFactory(DeprecatedDecorator,s,"`Camera.takeScreenshot` is deprecated; use `Renderer.takeScreenshot` instead"));e.addCommandToInterface({namespace:"Renderer",name:"takeScreenShot",args:["resolution","visibleObjects","returnType"]},i),e.addCommandToInterface({namespace:"Camera",name:"takeScreenShot",args:["resolution","visibleObjects","returnType"]},c)}(o,h,d,Le,new DependencyFetcher(w,we,le)),function(e,t,o,a,n){const r=SdkCommand.create(n,new ClassFactory(EquirectangularExecutor,t,o,a));e.addCommandToInterface({namespace:"Renderer",name:"takeEquirectangular",args:[]},r)}(o,h,d,Le,new DependencyFetcher(we,le,j,H,Ee)),function(e,t,o,a){const n=SdkCommand.create(a,new ClassFactory(WorldToScreen,t,o));e.addCommandToInterface({namespace:"Renderer",name:"getScreenPosition",args:["worldPosition"]},n)}(o,d,Le,new DependencyFetcher(we)),function(e,t,o,a){const n=SdkCommand.create(a,new ClassFactory(WorldPositionExecutor,t,o));e.addCommandToInterface({namespace:"Renderer",name:"getWorldPositionData",args:["screenPosition","height","includeHiddenFloors"]},n)}(o,d,Le,new DependencyFetcher(T,K)),function(e,t){const o=SdkObservable.create(t,new CurrentRoomSubFactory,new ClassFactory(CurrentRoomObservable));e.addObservableToInterface({namespace:"Room",name:"current",objectFactory:"current.room"},o)}(o,new DependencyFetcher(L,T,f,H,j,N,Ue,_e)),function(e,t){const o=SdkCollection.create(t,new RoomSubFactory,new ClassFactory(RoomCollectionData));e.addCollectionToInterface({namespace:"Room",name:"data",elementFactory:"collection.room"},o)}(o,new DependencyFetcher(L,T,Ue,_e,N)),function(e,t,o,a,n,r,s){!function(e){e.addEnumToInterface({namespace:"Scene",name:"InteractionType",values:vo}),e.addEnumToInterface({namespace:"Scene",name:"Component",values:Z.ComponentType}),e.addEnumToInterface({namespace:"Scene",name:"PathType",values:So})}(e),function(e,t){const o=SdkCommand.create(t,new ClassFactory(RegisterComponent));e.addAsyncCommandToInterface({namespace:"Scene",name:"register",args:["name","factory"],sdkTypes:[fo.DIRECT]},o),t.getDependencies().then((([t])=>{e.addEnumToInterface({namespace:"Scene",name:"Component",values:t.componentMap(),sdkTypes:[fo.DIRECT]})}))}(e,new DependencyFetcher(a)),function(e,t){const o=SdkCommand.create(t,new ClassFactory(CreateNode));e.addAsyncCommandToInterface({namespace:"Scene",name:"createNode",args:[],varArg:!1,sdkTypes:[fo.DIRECT]},o)}(e,new DependencyFetcher(a)),function(e,t,o){t.addBinding(QueryCommand,(async e=>{const[t]=await o.getDependencies();return t.sceneTags().getObjects(e.tags)})),e.addCommandCreator({namespace:"Scene",name:"query",args:["tags"],sdkTypes:[fo.DIRECT]},(e=>new QueryCommand(e)))}(e,t,new DependencyFetcher(a,n)),function(e,t,o,a){a.getDependencies().then((([e])=>{o.addBinding(ConfigureCommand,(async o=>{o.callback(e.threeRenderer,t,e.getScene().effectComposer)}))})),e.addCommandCreator({namespace:"Scene",name:"configure",args:["callback"],sdkTypes:[fo.DIRECT]},(e=>new ConfigureCommand(e)))}(e,o,t,new DependencyFetcher(r)),function(e,t,o){o.getDependencies().then((([e])=>{t.addBinding(GetImageCommand,(async t=>e.getSignedUrls().getImageBitmap(t.path,t.width,t.height,t.options)))})),e.addCommandCreator({namespace:"Scene",name:"getImage",args:["path","width","height","options"],sdkTypes:[fo.DIRECT]},(e=>new GetImageCommand(e)))}(e,t,new DependencyFetcher(s)),function(e,t){const o=SdkCommand.create(t,new ClassFactory(Deserialize));e.addAsyncCommandToInterface({namespace:"Scene",name:"deserialize",args:["text"],varArg:!1,sdkTypes:[fo.DIRECT]},o)}(e,new DependencyFetcher(a)),function(e,t){const o=SdkCommand.create(t,new ClassFactory(Serialize));e.addCommandToInterface({namespace:"Scene",name:"serialize",args:["objects"],varArg:!1,sdkTypes:[fo.DIRECT]},o)}(e,new DependencyFetcher(a)),function(e,t){const o=SdkCommand.create(t,new ClassFactory(CreateNodes));e.addAsyncCommandToInterface({namespace:"Scene",name:"createNodes",args:["count","userContext"],varArg:!1,sdkTypes:[fo.DIRECT]},o)}(e,new DependencyFetcher(a)),function(e,t){const o=SdkCommand.create(t,new ClassFactory(RegisterComponents));e.addAsyncCommandToInterface({namespace:"Scene",name:"registerComponents",args:["components"],sdkTypes:[fo.DIRECT]},o)}(e,new DependencyFetcher(a)),function(e,t){const o=SdkCommand.create(t,new ClassFactory(CreateObjects));e.addAsyncCommandToInterface({namespace:"Scene",name:"createObjects",args:["count"],varArg:!1,sdkTypes:[fo.DIRECT]},o)}(e,new DependencyFetcher(a)),function(e,t,o){const a=SdkCommand.create(o,new ClassFactory(UnregisterComponentsExecutor));e.addCommandToInterface({namespace:"Scene",name:"unregisterComponents",args:["components"],varArg:!1},a)}(e,0,new DependencyFetcher(a))}(o,Le,h,he,ie,we,ee),Ro(h,d.SourceType,d.sensorVolumes)(o,new DependencyFetcher(me)),function(e,t,o,a){o.addBinding(t.SettingGetCommand,(async e=>{const[t]=await a.getDependencies();return t.tryGetProperty(e.key,void 0)})),e.addCommandCreator({namespace:"Settings",name:"get",args:["key"]},(e=>new t.SettingGetCommand(e.key)))}(o,d,Le,new DependencyFetcher(ge)),function(e,t,o,a){o.addBinding(t.SettingUpdateCommand,(async e=>{if(!e.key||"string"!=typeof e.key)throw Error("Settings: invalid key");const[t]=await a.getDependencies();return t.updateSetting(e.key,e.value),t.tryGetProperty(e.key,void 0)})),e.addCommandCreator({namespace:"Settings",name:"update",args:["key","value"]},(e=>new t.SettingUpdateCommand(e.key,e.value)))}(o,d,Le,new DependencyFetcher(ge)),function(e,t,o){o.getDependencies().then((([o])=>{new FpsCalculator(t.waitForUpdate,o).calcAndBroadcast(e)})),e.addEnumToInterface({namespace:"Stat",name:"Event",values:xo})}(o,Le,new DependencyFetcher(k)),function(e,t){const o=SdkCommand.create(t,new ClassFactory(SetItemExecutor));e.addAsyncCommandToInterface({namespace:"XStorage",name:"setItem",args:["key","data"],origins:wo},o)}(o,new DependencyFetcher(x)),function(e,t){const o=SdkCommand.create(t,new ClassFactory(GetItemExecutor));e.addAsyncCommandToInterface({namespace:"XStorage",name:"getItem",args:["key"],origins:wo},o)}(o,new DependencyFetcher(x)),function(e,t){const o=SdkCommand.create(t,new ClassFactory(GetAllItemsExecutor));e.addAsyncCommandToInterface({namespace:"XStorage",name:"getAllItems",args:["modelId"],origins:wo},o)}(o,new DependencyFetcher(x)),function(e,t){const o=SdkCommand.create(t,new ClassFactory(RemoveItemExecutor));e.addAsyncCommandToInterface({namespace:"XStorage",name:"removeItem",args:["key"],origins:wo},o)}(o,new DependencyFetcher(x)),function(e){e.addEnumToInterface({namespace:"Sweep",name:"Transition",values:n}),e.addEnumToInterface({namespace:"Sweep",name:"Alignment",values:Fo}),e.addEnumToInterface({namespace:"Sweep",name:"Placement",values:Lo})}(o),function(e,t,o,a){const n=SdkObservable.create(a,new CurrentSweepSubFactory,new ClassFactory(CurrentSweepObservable,t,o));e.addObservableToInterface({namespace:"Sweep",name:"current"},n)}(o,d,Le,new DependencyFetcher(H,j,T,ke,_e)),function(e,t,o,a){e.addEnumToInterface({namespace:"Sweep",name:"Event",values:_o});const n=["",""],r=()=>n;o.subscribe(t.BeginMoveToSweepMessage,(async t=>{const o=await a;t.fromSweep&&t.fromSweep!==t.toSweep&&(n[0]=t.fromSweep?o.getIdFromCwfId(t.fromSweep):t.fromSweep,n[1]=o.getIdFromCwfId(t.toSweep),e.broadcast(_o.EXIT,r,t))})),o.subscribe(t.BeginSwitchViewmodeMessage,(o=>{o.fromMode===t.Viewmode.Panorama&&o.toMode!==t.Viewmode.Panorama&&(n[0]=s[1],n[1]=void 0,e.broadcast(_o.EXIT,r))}));const s=["",""],i=()=>s;o.subscribe(t.EndMoveToSweepMessage,(async t=>{const o=await a;s[0]=t.fromSweep?o.getIdFromCwfId(t.fromSweep):t.fromSweep,s[1]=o.getIdFromCwfId(t.toSweep),e.broadcast(_o.ENTER,i)}))}(o,d,Le,ke),function(e,t,o,a){const r=SdkCommand.create(a,new ClassFactory(MoveToSweepExecutor,t,o));e.addEnumToInterface({namespace:"Sweep",name:"Transition",values:n}),e.addCommandToInterface({namespace:"Sweep",name:"moveTo",args:["sweep","options"]},r)}(o,d,Le,new DependencyFetcher(H,ke,de)),function(e,t,o){const a=SdkCollection.create(o,new SweepSubFactory,new ClassFactory(SweepDataCollection,t.conversionUtils,t.sweepPlacementConverter));e.addCollectionToInterface({namespace:"Sweep",name:"data"},a)}(o,Le,new DependencyFetcher(H,T,ke,_e)),function(e,t){const o=SdkCommand.create(t,new ClassFactory(EnableExecutor)),a=SdkCommand.create(t,new ClassFactory(DisableExecutor));e.addCommandToInterface({namespace:"Sweep",name:"enable",args:["sweepIds"],varArg:!0},o),e.addCommandToInterface({namespace:"Sweep",name:"disable",args:["sweepIds"],varArg:!0},a)}(o,new DependencyFetcher(H,B,ke)),function(e){(function(e,t){const o=SdkCommand.create(t,new ClassFactory(TestExecutor));e.addCommandToInterface({namespace:"Test",name:"echo",args:["arg0"],varArg:!1,origins:wo},o)})(e,new DependencyFetcher),function(e,t){const o=SdkCommand.create(t,new ClassFactory(command_sdkTypes_TestExecutor));e.addCommandToInterface({namespace:"Test",name:"directCommand",args:[],sdkTypes:[fo.DIRECT],varArg:!1,origins:wo},o),e.addCommandToInterface({namespace:"Test",name:"postMessageCommand",args:[],sdkTypes:[fo.POSTMESSAGE],varArg:!1,origins:wo},o)}(e,new DependencyFetcher),function(e){e.addEnumToInterface({namespace:"Test",name:"directEnum",values:Vo,sdkTypes:[fo.DIRECT],origins:wo}),e.addEnumToInterface({namespace:"Test",name:"postMessageEnum",values:Vo,sdkTypes:[fo.POSTMESSAGE],origins:wo})}(e),function(e,t){const o=SdkCollection.create(t,new CollectionSubFactory,new ClassFactory(TestDataCollection));e.addCollectionToInterface({namespace:"Test",name:"directCollection",sdkTypes:[fo.DIRECT],origins:wo},o),e.addCollectionToInterface({namespace:"Test",name:"postMessageCollection",sdkTypes:[fo.POSTMESSAGE],origins:wo},o)}(e,new DependencyFetcher),function(e,t){const o=SdkObservable.create(t,new TestSubFactory,new ClassFactory(TestObservableData));e.addObservableToInterface({namespace:"Test",name:"directObservable",sdkTypes:[fo.DIRECT],origins:wo},o),e.addObservableToInterface({namespace:"Test",name:"postMessageObservable",sdkTypes:[fo.POSTMESSAGE],origins:wo},o)}(e,new DependencyFetcher)}(o),function(e){e.addEnumToInterface({namespace:"Tour",name:"PlayState",values:te.PlayState})}(o),function(e,t,o){e.addEnumToInterface({namespace:"Tour",name:"Event",values:Wo}),o.subscribe(t.TourStartedMessage,(()=>e.broadcast(Wo.STARTED))),o.subscribe(t.TourStoppedMessage,(()=>e.broadcast(Wo.STOPPED))),o.subscribe(t.TourEndedMessage,(()=>e.broadcast(Wo.ENDED)));const a=[-1],n=e=>(a[0]=e.index,a);o.subscribe(t.TourSteppedMessage,(t=>e.broadcast(Wo.STEPPED,n,t)))}(o,d,Le),Ko(o,d,Le,new DependencyFetcher(fe,z)),function(e,t){const o=SdkObservable.create(t,new TourCurrentStepSubFactory,new ClassFactory(TourCurrentStepObservableData));e.addObservableToInterface({namespace:"Tour",name:"currentStep"},o)}(o,new DependencyFetcher(z)),function(e,t,o){const a=SdkObservable.create(o,new TourCurrentStateFactory,new ClassFactory(TourStateObservableData,t));e.addObservableToInterface({namespace:"Tour",name:"state"},a)}(o,Le,new DependencyFetcher(z)),function(e,t){const o=SdkObservable.create(t,new TourTransitionSubFactory,new ClassFactory(TourTransitionObservableData));e.addObservableToInterface({namespace:"Tour",name:"transition"},o)}(o,new DependencyFetcher(z))}})(),a})()}));