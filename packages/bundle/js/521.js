(self.webpackChunkmp_webgl=self.webpackChunkmp_webgl||[]).push([[521],{40212:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>u});var l=a(89758),n=a(14877),r=a(56483),i=a(92450),o=a(23251),s=a(83229);const u=async function(e){const t=await e.getModuleBySymbol(n.y.SETTINGS),a=t.addPanel(l.s.TITLE,l.s.HOTKEYS,{width:350});await t.loadPromise.then((()=>{const l="meshtextures";[{panel:a,header:l,setting:"disableTextureStreamBelowLod",initialValue:()=>-1,onChange:e=>{e>-1&&(0,s.qT)().limitStreamingBelow(e)},urlParam:!0,rangePrecision:0,range:[-1,7]},{panel:a,header:l,setting:"textureStreamPause",initialValue:()=>r.ZP.debugPauseTexStream,onChange:e=>{r.ZP.debugPauseTexStream=e},urlParam:!0},{panel:a,header:l,setting:"textureStreamRaycastHits",initialValue:()=>r.ZP.debugLOD,onChange:e=>{r.ZP.debugLOD=e,e||(0,o.d)()},urlParam:!0},{panel:a,header:l,setting:"debugRTTQuality",initialValue:()=>r.ZP.debugRttQuality,onChange:t=>{r.ZP.debugRttQuality=t,t||e.commandBinder.issueCommand(new i.u({color:null},{style:i.u.selectBy.all}))},urlParam:!0},{panel:a,header:l,setting:"debugRTTScores",initialValue:()=>r.ZP.debugRttScores,onChange:t=>{r.ZP.debugRttScores=t,t||e.commandBinder.issueCommand(new i.u({color:null},{style:i.u.selectBy.all}))},urlParam:!0}].forEach((e=>t.registerMenuEntry(e)))}))}},96286:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>f,tiledMeshDebugMenu:()=>S});var l=a(5477),n=a(14877),r=a(81402),i=a(89142),o=a(28124),s=a(89758),u=a(68013),d=a(56483),c=a(70446),g=a(84428),m=a(83229),h=a(91183);function p(e,t=16){let a;const l=(0,h.k1)((()=>a=window.setInterval((()=>e()),t)),(()=>{a&&clearInterval(a)}));return l.cancel(),l}var y=a(87100);const T=new l.Z("tiled-mesh"),b={hideMenu:"1"!==(0,y.eY)("dmenu","0"),debug:"1"===(0,y.eY)("debugTiles","0"),statsTiles:!1,statsTileset:!0,statsTextures:!1,statsTextureStream:!1};let v=null;function M(e,t,a){v||(v=document.createElement("div"),v.style.color="#FFFFFF",v.style.fontFamily="Roboto",v.style.fontWeight="300",v.style.fontSize="12px",v.style.position="absolute",v.style.top="50px",v.style.width="500px",v.style.pointerEvents="none",v.style.whiteSpace="pre",v.style.zIndex="99999",v.style.textShadow="0 0 1px black, 0 0 1px black, 0 0 1px black, 0 0 1px black",document.body.appendChild(v));let l=b.statsTileset?function(e){var t,a,l;const n=e.tilesRenderer,r=Object.values(null!==(t=n.tileSets)&&void 0!==t?t:[])[0];return`\ntileset: version: ${null==r?void 0:r.asset.tilesetVersion}, depth: ${null===(a=null==r?void 0:r.asset.extras)||void 0===a?void 0:a.depth}, preset: ${null===(l=null==r?void 0:r.asset.extras)||void 0===l?void 0:l.preset}\n`}(e):"";l+=b.statsTiles?function(e,t){const a=e.tilesRenderer,l=a.visibleTiles,n={};l.forEach((e=>{var t;const a=`lod${null===(t=e.extras)||void 0===t?void 0:t.level}`,l=n[a]||0;n[a]=l+1}));const r=t.threeRenderer.info,{stats:i,downloadQueue:o,parseQueue:s,lruCache:u}=a,{active:d,downloading:c,inFrustum:g,parsing:m,used:h,visible:p}=i;return`\nthree:\n    drawCalls: ${r.render.calls}\n    geometries: ${r.memory.geometries}\n    textures: ${r.memory.textures}\n    triangles: ${r.render.triangles}\n    memory allocated (megs): ${Math.floor(t.estimatedGPUMemoryAllocated()/2**20)}\ntiles:\n    tiles in frustum: ${g}\n    visible: ${p}`+Object.keys(n).sort().map((e=>`\n     ${e} tiles: ${n[e]||0}`)).join()+`\n    downloading gltf: ${c}\n    parsing gltf: ${m}\n    active: ${d}\n    used: ${h}\n    queues:\n      download: ${o.currJobs} running, ${o.items.length} waiting\n      parse: ${s.currJobs} running, ${s.items.length} waiting\n    lruCache: ${u.itemSet.size}\n`}(e,a):"",l+=b.statsTextureStream?function(e){const t="downloaded:\n"+Object.keys(e.totalTextures).map((t=>`    ${t}: ${e.totalTextures[t]} `)).join("\n")+"\n";return`textureStreaming:\n    downloadingTiles: ${e.downloadingTiles} / ${e.totalTiles}\n    downloadingTextures: ${e.loadingTextures}\n`+t}(t):"",v.textContent=l}let x=null;async function S(e){if(!b.debug)return;const t=await e.getModuleBySymbol(n.y.SETTINGS),a=await e.getModuleBySymbol(n.y.INPUT),l=await e.getModuleBySymbol(n.y.WEBGL_RENDERER),c=l.getScene(),g=await e.getModuleBySymbol(n.y.MODEL_MESH),h=g.modelTextureLoader,y=g.modelMesh.tileLoader,v=t.tryGetProperty(d.iT,!1);function S(){x||(x=setInterval((()=>M(y,h,l)),150))}const w=t.addPanel(s.s.TITLE,s.s.HOTKEYS,{width:350}),f={viz:"visualize",stats:"stats",tile:"tileset",log:"log"},O=function(e,t,a,l,n){const r=C(a,n,((e,t)=>e.setWireframe(t))),s=function(e,t){const a={scale:1},l=(t,l)=>{if(!t)return;const n=e.container.tilesByChunkId.get(t.id),r=(null==n?void 0:n.__error)||1e-4,i=t.lod!==u.t.maxLOD&&r>u.t.errorTarget?1:.5,o=Math.max(0,Math.min(1,1-a.scale/r)),s=l?P(t.lod,o,i):null;t.setColorOverlay(s)},n=C(e,t,l),r=p((()=>n.colorize(e.container.chunks)));return{toggle:e=>{e?r.renew():r.cancel(),n.toggle(e)},colorize:n.colorize,subscription:r,config:a}}(a,n),d=C(a,n,((e,t)=>{e.setColorOverlay(t?P(e.lod,1,.5):null)})),c=C(a,n,((e,t)=>{e.setColorOverlay(t?(0,o.G1)(.5,e.id||0):null)})),g=C(a,n,((e,t)=>{var l;const n=a.container.tilesByChunkId.get(e.id);e.setColorOverlay(t?(0,o.G1)(.5,(0,i.un)((null===(l=null==n?void 0:n.content)||void 0===l?void 0:l.uri)||"missing")||0):null)})),h=C(a,n,((e,t)=>{e.setColorOverlay(t?(0,o.G1)(.5,(e.meshGroup<<16)+e.meshSubgroup||0):null)})),y=C(a,n,((e,t)=>{e.setColorOverlay(t?(0,o.G1)(.5,e.meshSubgroup||0):null)})),b=C(a,n,((e,t)=>{e.setColorOverlay(t?(0,o.G1)(.5,e.meshGroup||0):null)})),v=C(a,n,((e,t)=>{e.setColorOverlay(t?(0,o.G1)(.5,(0,i.un)(e.textureName)||0):null)})),M=C(a,n,((e,t)=>{const l=a.container.tilesByChunkId.get(e.id);e.setColorOverlay(t?(0,o.G1)(.5,(null==l?void 0:l.geometricError)||0):null)})),x=l.slots,S=(0,m.qT)(),w=C(a,n,((e,t)=>{const a=x.find((t=>t.textureName===e.textureName));if(a){const l=a.loading?1:a.quality>S.min(e.lod)?.7:.3,n=S.maxTexelSize/S.get(a.quality).texelSize;e.setColorOverlay(t?P(e.lod,n,l):null)}})),f=p((()=>w.colorize(a.container.chunks)));let O="none";const E={none:void 0,byError:s,byGeometricError:M,byTile:g,bySubgroup:y,byMeshgroup:b,bySubAndMeshgroup:h,byTexture:v,byStreamedTextures:{subscription:f,toggle:e=>{e?f.renew():f.cancel(),e&&T.info("colorize=byStreamedTextures solid color: loading, dark color: streamed, light color: basis"),w.toggle(e)}},byChunk:c,byLod:d};return[{panel:e,header:t.viz,setting:"disableTileUpdates",initialValue:()=>u.t.disableTileUpdates,onChange:e=>{u.t.disableTileUpdates=e},urlParam:!0},{panel:e,header:t.viz,setting:"wireframe",initialValue:()=>!1,onChange:r.toggle,urlParam:!0},{panel:e,header:t.viz,setting:"colorize",initialValue:()=>"none",onChange:e=>{var t,a;null===(t=E[O])||void 0===t||t.toggle(!1),null===(a=E[e])||void 0===a||a.toggle(!0),O=e},options:Object.keys(E),urlParam:!0},{panel:e,header:t.viz,setting:"colorizeByErrorScale",initialValue:()=>1,onChange:e=>{s.config.scale=e},range:[0,6],rangePrecision:3,urlParam:!0}]}(w,f,y,h,e),E=[{panel:w,header:f.stats,setting:"tilesetStatsOverlay",initialValue:()=>b.statsTileset,onChange:e=>{b.statsTileset=e,e&&S()},urlParam:!0},{panel:w,header:f.stats,setting:"tileStatsOverlay",initialValue:()=>b.statsTiles,onChange:e=>{b.statsTiles=e,e&&S()},urlParam:!0},{panel:w,header:f.stats,setting:"textureStatsOverlay",initialValue:()=>b.statsTextures,onChange:e=>{b.statsTextures=e,e&&S()},urlParam:!0},{panel:w,header:f.stats,setting:"textureStreamingOverlay",initialValue:()=>b.statsTextureStream,onChange:e=>{b.statsTextureStream=e,e&&S()},urlParam:!0}],V=[{panel:w,header:f.log,buttonName:"Log: App State",callback:()=>{T.warn(g),T.warn(a),T.warn(c),T.warn(t)}}];v&&(b.hideMenu||await(0,r.gw)(1e3).then((()=>{t.getSettingsGui().loadGuiPackage().then((()=>{t.getSettingsGui().toggle(t.getMainPanelId()),t.getSettingsGui().toggle(t.getMainPanelId())}))})),await(0,r.gw)(16),O.forEach((e=>t.registerMenuEntry(e))),await(0,r.gw)(16),function(e,t){return[{panel:e,header:t.tile,setting:"maxLOD",initialValue:()=>u.t.maxLOD,onChange:e=>{u.t.maxLOD=e},range:[0,3],rangePrecision:0,urlParam:!0},{panel:e,header:t.tile,setting:"errorTarget",initialValue:()=>u.t.errorTarget,onChange:e=>{u.t.errorTarget=e},range:[0,20],rangePrecision:1,urlParam:!0},{panel:e,header:t.tile,setting:"displayActiveTiles",initialValue:()=>u.t.displayActiveTiles,onChange:e=>{u.t.displayActiveTiles=e},urlParam:!0},{panel:e,header:t.tile,setting:"loadSiblings",initialValue:()=>u.t.loadSiblings,onChange:e=>{u.t.loadSiblings=e},urlParam:!0},{panel:e,header:t.tile,setting:"autoDisableRendererCulling",initialValue:()=>u.t.autoDisableRendererCulling,onChange:e=>{u.t.autoDisableRendererCulling=e},urlParam:!0},{panel:e,header:t.tile,setting:"stopAtEmptyTiles",initialValue:()=>u.t.stopAtEmptyTiles,onChange:e=>{u.t.stopAtEmptyTiles=e},urlParam:!0},{panel:e,header:t.tile,setting:"disableTileUpdates",initialValue:()=>u.t.disableTileUpdates,onChange:e=>{u.t.disableTileUpdates=e},urlParam:!0},{panel:e,header:t.tile,setting:"disposeModel",initialValue:()=>u.t.disposeModel,onChange:e=>{u.t.disposeModel=e},urlParam:!0},{panel:e,header:t.tile,setting:"limitMemoryUsage",initialValue:()=>u.t.limitMemoryUsage,onChange:e=>{u.t.limitMemoryUsage=e},urlParam:!0},{panel:e,header:t.tile,setting:"allocatedMegsBeforeLimitingLod",initialValue:()=>u.t.allocatedMegsBeforeLimitingLod,onChange:e=>{u.t.allocatedMegsBeforeLimitingLod=e},urlParam:!0,range:[100,1e3]},{panel:e,header:t.tile,setting:"lruMinExtraTiles",initialValue:()=>u.t.lruMinExtraTiles,onChange:e=>{u.t.lruMinExtraTiles=e},urlParam:!0,range:[0,2e3]},{panel:e,header:t.tile,setting:"lruMaxTiles",initialValue:()=>u.t.lruMaxTiles,onChange:e=>{u.t.lruMaxTiles=e},urlParam:!0,range:[0,2e3]},{panel:e,header:t.tile,setting:"lruUnloadPercent",initialValue:()=>u.t.lruUnloadPercent,onChange:e=>{u.t.lruUnloadPercent=e},urlParam:!0,range:[0,1]},{panel:e,header:"Priority",setting:"errorMultiplierRaycastOcclusion",initialValue:()=>u.t.errorMultiplierRaycastOcclusion,onChange:e=>{u.t.errorMultiplierRaycastOcclusion=e},urlParam:!0,range:[.001,1],rangePrecision:2},{panel:e,header:"Priority",setting:"errorMultiplierHiddenFloors",initialValue:()=>u.t.errorMultiplierHiddenFloors,onChange:e=>{u.t.errorMultiplierHiddenFloors=e},urlParam:!0,range:[.001,1],rangePrecision:2}]}(w,f).forEach((e=>t.registerMenuEntry(e))),E.forEach((e=>t.registerMenuEntry(e))),V.forEach((e=>t.registerMenuButton(e))))}function C(e,t,a){let l=!1;const n=e=>{t.after(c.A.End).then((()=>{e.forEach((e=>{e&&a(e,l)}))}))},r=e.notifyOnChunksLoaded(n);r.cancel();return{toggle:t=>{t?r.renew():r.cancel(),t!==l&&(l=t,n([...e.container.chunks]))},colorize:n,subscription:r}}const w={0:new g.Vector4(1,0,0,1),1:new g.Vector4(0,1,0,1),2:new g.Vector4(0,0,1,1),3:new g.Vector4(1,1,1,1),4:new g.Vector4(1,0,1,1),5:new g.Vector4(0,1,1,1),6:new g.Vector4(1,1,0,1),7:new g.Vector4(0,0,0,1)};function P(e,t,a){var l,n;const r=null!==(n=null===(l=w[e])||void 0===l?void 0:l.clone())&&void 0!==n?n:new g.Vector4;return r.multiplyScalar(t),r.setW(a),r}const f=S},89758:(e,t,a)=>{"use strict";a.d(t,{s:()=>l});const l={TITLE:"streamed-mesh (T)",HOTKEYS:[a(43985).R.T]}},92450:(e,t,a)=>{"use strict";a.d(t,{u:()=>SetMeshOverlayCommand});var l,n,r=a(93037);!function(e){e.all="all",e.byMeshGroup="byMeshGroup",e.byMeshSubGroup="byMeshSubGroup"}(l||(l={})),function(e){e.explicit="explicit",e.random="random"}(n||(n={}));class SetMeshOverlayCommand extends r.m{constructor(e,t){super(),this.id="SET_MESH_OVERLAY_COLOR",this.payload={selectBy:(null==t?void 0:t.style)||l.all,colorStyle:(null==e?void 0:e.style)||n.explicit,color:(null==e?void 0:e.color)||null,alpha:(null==e?void 0:e.alpha)||.5,index:null==t?void 0:t.index}}}SetMeshOverlayCommand.selectBy=l,SetMeshOverlayCommand.colorBy=n,SetMeshOverlayCommand.COLOR_DIM={x:0,y:0,z:0,w:.3}},68013:(e,t,a)=>{"use strict";a.d(t,{t:()=>o});var l=a(87100),n=a(17403),r=a(2252),i=a(60050);const o={urlTemplateToken:"<file>",initialMaxLOD:i.V.Min,nonMeshMaxLOD:i.V.Standard,maxLOD:i.V.High,loadSiblings:!0,displayActiveTiles:!1,autoDisableRendererCulling:!0,optimizeRaycast:!1,stopAtEmptyTiles:!1,errorTarget:Number((0,l.eY)("errorTarget",(0,r.tq)()?6:4)),disableTileUpdates:!1,errorMultiplierRaycastOcclusion:.1,errorMultiplierHiddenFloors:.01,disposeModel:!1,limitMemoryUsage:(0,r.tq)(),allocatedMegsBeforeLimitingLod:350,lruMinExtraTiles:(0,r.tq)()?0:100,lruMaxTiles:800,lruUnloadPercent:.05,tileAssetRequestPriority:n.RequestPriority.MEDIUM,downloadQueueConcurrency:8,parseQueueConcurrency:10,snappingMaxLOD:i.V.Standard}},23251:(e,t,a)=>{"use strict";a.d(t,{e:()=>s,d:()=>u});var l=a(84428);const n=a(56483).ZP.sightingMaxAge,r=new l.Color;let i,o=-1;const s=(e,t)=>{i||(i=new l.InstancedMesh(new l.SphereBufferGeometry(.005,8,4),new l.MeshBasicMaterial,n),d(i));const a=new l.Matrix4;return({point:l,distance:s})=>{a.makeScale(s,s,s).setPosition(l),i.setMatrixAt(++o%n,a),i.instanceMatrix.needsUpdate=!0;for(let t=n;t--;)i.setColorAt((o-t+n)%n,r.set(e).multiplyScalar(1-t/n));i.instanceColor&&(i.instanceColor.needsUpdate=!0),i.parent||t.scene.add(i)}},u=()=>{var e;i&&(null===(e=i.parent)||void 0===e||e.remove(i),d(i))};function d(e){const t=(new l.Matrix4).makeScale(0,0,0);for(let a=0;a<n;a++)e.setMatrixAt(a,t)}}}]);